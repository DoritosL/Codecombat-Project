{"version":3,"sources":["app/lib/scripts/ScriptModule.coffee"],"names":[],"mappings":";AAAA;EAAA;;;;AAAA,YAAY,QAAQ,gBAAR;;AAEZ,MAAM,CAAC,OAAP,GAAuB;AAErB;;;;EAAA,gBAAgB;;EAChB,eAAe;;EAEF,sBAAC,SAAD;AACX;IADY,IAAC,aAAD;IACZ;IACA,IAAG,CAAI,IAAC,UAAS,CAAC,QAAlB;MACE,IAAC,iBAAD,CAAkB,IAAC,UAAnB;;YACU,CAAC,QAAS;;MACpB,IAAC,UAAS,CAAC,QAAX,GAAsB,KAHxB;;EAFW;;EASb,YAAC,UAAD,GAAY;WAAG;EAAH;;yBACZ,aAAY;WAAG;EAAH;;yBACZ,WAAU;WAAG;EAAH;;yBACV,YAAW;WAAG,IAAC,SAAD;EAAH;;yBAIX,mBAAkB;AAEhB;IAAA,IAAC,aAAD,GAAgB,IAAC,qBAAD,CAAsB,IAAC,UAAvB;WAChB,IAAC,cAAD,+EAA2C,CAAE,2BAA5B,IAAwC;EAHzC;;yBAKlB,uBAAsB;AACpB;IAAA,OAAO;AACP;AAAA;;MACE,IAAgB,mBAAhB;AAAA;;;QACA,aAAmB;;MACnB,IAAK,OAAM,CAAC,EAAP,CAAL,IAAmB,MAAM,CAAC,IAAI,CAAC;AAHjC;IAIA;;AAAQ;WAAA;qBAAA,IAAK;AAAL;;;WACR,IAAI,CAAC,GAAL,aAAS,EAAG,0BAAZ;EAPoB;;yBAStB,wBAAuB,SAAC,IAAD;WACrB,IAAI,CAAC,KAAL,GAAa,CAAC,IAAC,cAAD,GAAiB,IAAC,aAAnB,KAAoC;EAD5B;;;;GAnCmB","file":"public/javascripts/app/lib/scripts/ScriptModule.js","sourcesContent":["CocoClass = require 'core/CocoClass'\n\nmodule.exports = class ScriptModule extends CocoClass\n\n  scrubbingTime = 0\n  movementTime = 0\n\n  constructor: (@noteGroup) ->\n    super()\n    if not @noteGroup.prepared\n      @analyzeNoteGroup(@noteGroup)\n      @noteGroup.notes ?= []\n      @noteGroup.prepared = true\n\n  # subclass should overwrite these\n\n  @neededFor: -> false\n  startNotes: -> []\n  endNotes: -> []\n  skipNotes: -> @endNotes()\n\n  # common logic\n\n  analyzeNoteGroup: ->\n    # some notes need to happen after others. Calculate the delays\n    @movementTime = @calculateMovementMax(@noteGroup)\n    @scrubbingTime = @noteGroup.playback?.scrub?.duration or 0\n\n  calculateMovementMax: ->\n    sums = {}\n    for sprite in @noteGroup.sprites\n      continue unless sprite.move?\n      sums[sprite.id] ?= 0\n      sums[sprite.id] += sprite.move.duration\n    sums = (sums[k] for k of sums)\n    Math.max(0, sums...)\n\n  maybeApplyDelayToNote: (note) ->\n    note.delay = (@scrubbingTime + @movementTime) or 0\n"]}