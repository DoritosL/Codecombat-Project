{"version":3,"sources":["app/schemas/models/level_session.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/schemas/models/level_session.js","sourcesContent":["c = require './../schemas'\n\nLevelSessionPlayerSchema = c.object\n  id: c.objectId\n    links: [\n      {\n        rel: 'extra'\n        href: '/db/user/{($)}'\n      }\n    ]\n  time:\n    type: 'Number'\n  changes:\n    type: 'Number'\n\nLevelSessionLevelSchema = c.object {required: ['original', 'majorVersion'], links: [{rel: 'db', href: '/db/level/{(original)}/version/{(majorVersion)}'}]},\n  original: c.objectId({})\n  majorVersion:\n    type: 'integer'\n    minimum: 0\n\nLevelSessionSchema = c.object\n  title: 'Session'\n  description: 'A single session for a given level.'\n  default:\n    codeLanguage: 'python'\n    submittedCodeLanguage: 'python'\n    playtime: 0\n\n_.extend LevelSessionSchema.properties,\n  # denormalization\n  browser:\n    type: 'object'\n  creatorName:\n    type: 'string'\n  levelName:\n    type: 'string'\n  levelID:\n    type: 'string'\n  creator: c.objectId\n    links:\n      [\n        {\n          rel: 'extra'\n          href: '/db/user/{($)}'\n        }\n      ]\n  created: c.date\n    title: 'Created'\n    readOnly: true\n\n  changed: c.date\n    title: 'Changed'\n    readOnly: true\n\n  dateFirstCompleted: {} # c.stringDate\n#    title: 'Completed'\n#    readOnly: true\n\n  team: c.shortString()\n  level: LevelSessionLevelSchema\n\n  heroConfig: c.HeroConfigSchema\n\n  state: c.object {},\n    complete:\n      type: 'boolean'\n    scripts: c.object {},\n      ended:\n        type: 'object'\n        additionalProperties:\n          type: 'number'\n      currentScript:\n        type: [\n          'null'\n          'string'\n        ]\n      currentScriptOffset:\n        type: 'number'\n\n    selected:  # Not tracked any more, delete with old level types\n      type: [\n        'null'\n        'string'\n      ]\n    playing:\n      type: 'boolean'  # Not tracked any more, delete with old level types\n    frame:\n      type: 'number'  # Not tracked any more, delete with old level types\n    thangs:   # ... what is this? Is this used?\n      type: 'object'\n      additionalProperties:\n        title: 'Thang'\n        type: 'object'\n        properties:\n          methods:\n            type: 'object'\n            additionalProperties:\n              title: 'Thang Method'\n              type: 'object'\n              properties:\n                metrics:\n                  type: 'object'\n                source:\n                  type: 'string'\n    goalStates:\n      type: 'object'\n      description: 'Maps Goal ID on a goal state object'\n      additionalProperties:\n        title: 'Goal State'\n        type: 'object'\n        properties:\n          status: enum: ['failure', 'incomplete', 'success']\n    submissionCount:\n      description: 'How many times the session has been submitted for real-time playback (can affect the random seed).'\n      type: 'integer'\n      minimum: 0\n    difficulty:\n      description: 'The highest difficulty level beaten, for use in increasing-difficulty replayable levels.'\n      type: 'integer'\n      minimum: 0\n    lastUnsuccessfulSubmissionTime: c.date\n      description: 'The last time that real-time submission was started without resulting in a win.'\n    flagHistory:\n      description: 'The history of flag events during the last real-time playback submission.'\n      type: 'array'\n      items: c.object {required: ['player', 'color', 'time', 'active']},\n        player: {type: 'string'}\n        team: {type: 'string'}\n        color: {type: 'string', enum: ['green', 'black', 'violet']}\n        time: {type: 'number', minimum: 0}\n        active: {type: 'boolean'}\n        pos: c.object {required: ['x', 'y']},\n          x: {type: 'number'}\n          y: {type: 'number'}\n        source: {type: 'string', enum: ['click']}  # Do not store 'code' flag events in the session.\n    topScores: c.array {},\n      c.object {},\n        type: c.shortString('enum': ['time', 'damage-taken', 'damage-dealt', 'gold-collected', 'difficulty'])\n        date: c.date\n          description: 'When the submission achieving this score happened.'\n        score: {type: 'number'}  # Store 'time' and 'damage-taken' as negative numbers so the index works.\n\n  code:\n    type: 'object'\n    additionalProperties:\n      type: 'object'\n      additionalProperties:\n        type: 'string'\n        format: 'code'\n\n  codeLogs:\n    type: 'array'\n\n  codeLanguage:\n    type: 'string'\n\n  playtime:\n    type: 'number'\n    title: 'Playtime'\n    description: 'The total playtime on this session in seconds'\n\n  teamSpells:\n    type: 'object'\n    additionalProperties:\n      type: 'array'\n\n  players:\n    type: 'object'\n\n  chat:\n    type: 'array'\n\n  ladderAchievementDifficulty:\n    type: 'integer'\n    minimum: 0\n    description: 'What ogre AI difficulty, 0-4, this human session has beaten in a multiplayer arena.'\n\n  meanStrength:\n    type: 'number'\n\n  standardDeviation:\n    type: 'number'\n    minimum: 0\n\n  totalScore:\n    type: 'number'\n\n  submitted:\n    type: 'boolean'\n\n  submitDate: c.date\n    title: 'Submitted'\n\n  submittedCode:\n    type: 'object'\n    additionalProperties:\n      type: 'object'\n      additionalProperties:\n        type: 'string'\n        format: 'code'\n\n  submittedCodeLanguage:\n    type: 'string'\n\n  isRanking:\n    type: 'boolean'\n    description: 'Whether this session is still in the first ranking chain after being submitted.'\n\n  randomSimulationIndex:\n    type: 'number'\n    description: 'A random updated every time the game is randomly simulated for a uniform random distribution of simulations (see #2448).'\n    minimum: 0\n    maximum: 1\n\n  unsubscribed:\n    type: 'boolean'\n    description: 'Whether the player has opted out of receiving email updates about ladder rankings for this session.'\n\n  numberOfWinsAndTies:\n    type: 'number'\n\n  numberOfLosses:\n    type: 'number'\n\n  scoreHistory:\n    type: 'array'\n    title: 'Score History'\n    description: 'A list of objects representing the score history of a session'\n    items:\n      title: 'Score History Point'\n      description: 'An array with the format [unix timestamp, totalScore]'\n      type: 'array'\n      items:\n        type: 'number'\n\n  matches:\n    type: 'array'\n    title: 'Matches'\n    description: 'All of the matches a submitted session has played in its current state.'\n    items:\n      type: 'object'\n      properties:\n        date: c.date\n          title: 'Date computed'\n          description: 'The date a match was computed.'\n        playtime:\n          title: 'Playtime so far'\n          description: 'The total seconds of playtime on this session when the match was computed. Not currently tracked.'\n          type: 'number'\n        metrics:\n          type: 'object'\n          title: 'Metrics'\n          description: 'Various information about the outcome of a match.'\n          properties:\n            rank:\n              title: 'Rank'\n              description: 'A 0-indexed ranking representing the player\\'s standing in the outcome of a match'\n              type: 'number'\n        opponents:\n          type: 'array'\n          title: 'Opponents'\n          description: 'An array containing information about the opponents\\' sessions in a given match.'\n          items:\n            type: 'object'\n            properties:\n              sessionID:\n                title: 'Opponent Session ID'\n                description: 'The session ID of an opponent.'\n                type: ['object', 'string', 'null']\n              userID:\n                title: 'Opponent User ID'\n                description: 'The user ID of an opponent'\n                type: ['object', 'string', 'null']\n              name:\n                title: 'Opponent name'\n                description: 'The name of the opponent'\n                type: ['string', 'null']\n              totalScore:\n                title: 'Opponent total score'\n                description: 'The totalScore of a user when the match was computed'\n                type: ['number', 'string', 'null']\n              metrics:\n                type: 'object'\n                properties:\n                  rank:\n                    title: 'Opponent Rank'\n                    description: 'The opponent\\'s ranking in a given match'\n                    type: 'number'\n              codeLanguage:\n                type: ['string', 'null']  # 'null' in case an opponent session got corrupted, don't care much here\n                description: 'What submittedCodeLanguage the opponent used during the match'\n        simulator: {type: 'object', description: 'Holds info on who simulated the match, and with what tools.'}\n        randomSeed: {description: 'Stores the random seed that was used during this match.'}\n\n  leagues:\n    c.array {description: 'Multiplayer data for the league corresponding to Clans and CourseInstances the player is a part of.'},\n      c.object {},\n        leagueID: {type: 'string', description: 'The _id of a Clan or CourseInstance the user belongs to.'}\n        stats: c.object {description: 'Multiplayer match statistics corresponding to this entry in the league.'}\n        lastOpponentSubmitDate: c.date {description: 'The submitDate of the last league session we selected to play against (for playing through league opponents in order).'}\n\n  isForClassroom:\n    type: 'boolean'\n    title: 'Is For Classroom'\n    description: 'The level session was created for a user inside a course'\n\nLevelSessionSchema.properties.leagues.items.properties.stats.properties = _.pick LevelSessionSchema.properties, 'meanStrength', 'standardDeviation', 'totalScore', 'numberOfWinsAndTies', 'numberOfLosses', 'scoreHistory', 'matches'\n\nc.extendBasicProperties LevelSessionSchema, 'level.session'\nc.extendPermissionsProperties LevelSessionSchema, 'level.session'\n\nmodule.exports = LevelSessionSchema\n"]}