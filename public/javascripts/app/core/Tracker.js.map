{"version":3,"sources":["app/core/Tracker.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/core/Tracker.js","sourcesContent":["{me} = require 'core/auth'\nSuperModel = require 'models/SuperModel'\nutils = require 'core/utils'\nCocoClass = require 'core/CocoClass'\n\ndebugAnalytics = false\ntargetInspectJSLevelSlugs = ['cupboards-of-kithgard']\n\nmodule.exports = class Tracker extends CocoClass\n  subscriptions:\n    'application:service-loaded': 'onServiceLoaded'\n\n  constructor: ->\n    super()\n    if window.tracker\n      console.error 'Overwrote our Tracker!', window.tracker\n    window.tracker = @\n    @isProduction = document.location.href.search('codecombat.com') isnt -1\n    @trackReferrers()\n    @identify()\n    @supermodel = new SuperModel()\n    @updateRole() if me.get 'role'\n\n  enableInspectletJS: (levelSlug) ->\n    # InspectletJS loading is delayed and targeting specific levels for more focused investigations\n    return @disableInspectletJS() unless levelSlug in targetInspectJSLevelSlugs\n\n    scriptLoaded = =>\n      # Identify and track pageview here, because inspectlet is loaded too late for standard Tracker calls\n      @identify()\n      # http://www.inspectlet.com/docs#virtual_pageviews\n      window.__insp?.push(['virtualPage'])\n    window.__insp = [['wid', 2102699786]]\n    insp = document.createElement('script')\n    insp.type = 'text/javascript'\n    insp.async = true\n    insp.id = 'inspsync'\n    insp.src = (if 'https:' == document.location.protocol then 'https' else 'http') + '://cdn.inspectlet.com/inspectlet.js'\n    insp.onreadystatechange = -> scriptLoaded() if insp.readyState is 'complete'\n    insp.onload = scriptLoaded\n    x = document.getElementsByTagName('script')[0]\n    @inspectletScriptNode = x.parentNode.insertBefore insp, x\n\n  disableInspectletJS: ->\n    if @inspectletScriptNode\n      x = document.getElementsByTagName('script')[0]\n      x.parentNode.removeChild(@inspectletScriptNode)\n      @inspectletScriptNode = null\n    delete window.__insp\n\n  trackReferrers: ->\n    elapsed = new Date() - new Date(me.get('dateCreated'))\n    return unless elapsed < 5 * 60 * 1000\n    return if me.get('siteref') or me.get('referrer')\n    changed = false\n    if siteref = utils.getQueryVariable '_r'\n      me.set 'siteref', siteref\n      changed = true\n    if referrer = document.referrer\n      me.set 'referrer', referrer\n      changed = true\n    me.patch() if changed\n\n  identify: (traits={}) ->\n    return unless me\n\n    # Save explicit traits for internal tracking\n    @explicitTraits ?= {}\n    @explicitTraits[key] = value for key, value of traits\n\n    for userTrait in ['email', 'anonymous', 'dateCreated', 'hourOfCode', 'name', 'referrer', 'testGroupNumber', 'gender', 'lastLevel', 'siteref', 'ageRange', 'schoolName', 'coursePrepaidID', 'role']\n      traits[userTrait] ?= me.get(userTrait) if me.get(userTrait)?\n    if me.isTeacher()\n      traits.teacher = true\n    traits.host = document.location.host\n\n    console.log 'Would identify', me.id, traits if debugAnalytics\n    @trackEventInternal('Identify', {id: me.id, traits}) unless me?.isAdmin() and @isProduction\n    return unless @isProduction and not me.isAdmin()\n\n    # Errorception\n    # https://errorception.com/docs/meta\n    _errs?.meta = traits\n\n    # Inspectlet\n    # https://www.inspectlet.com/docs#identifying_users\n    __insp?.push ['identify', me.id]\n    __insp?.push ['tagSession', traits]\n\n    # Mixpanel\n    # https://mixpanel.com/help/reference/javascript\n    mixpanel?.identify(me.id)\n    mixpanel?.register(traits)\n\n    if me.isTeacher() and @segmentLoaded\n      traits.createdAt = me.get 'dateCreated'  # Intercom, at least, wants this\n      analytics.identify me.id, traits\n\n  trackPageView: (includeIntegrations=[]) ->\n    includeMixpanel = (name) ->\n      mixpanelIncludes = []\n      name in mixpanelIncludes or /courses|students|teachers/ig.test(name)\n\n    name = Backbone.history.getFragment()\n    url = \"/#{name}\"\n    console.log \"Would track analytics pageview: #{url} Mixpanel=#{includeMixpanel(name)}\" if debugAnalytics\n    @trackEventInternal 'Pageview', url: name, href: window.location.href unless me?.isAdmin() and @isProduction\n    return unless @isProduction and not me.isAdmin()\n\n    # Google Analytics\n    # https://developers.google.com/analytics/devguides/collection/analyticsjs/pages\n    ga? 'send', 'pageview', url\n    ga?('codeplay.send', 'pageview', url) if features.codePlay\n    window.snowplow 'trackPageView'\n    # Mixpanel\n    mixpanel?.track('page viewed', 'page name' : name, url : url) if includeMixpanel(name)\n\n    if me.isTeacher() and @segmentLoaded\n      options = {}\n      if includeIntegrations?.length\n        options.integrations = All: false\n        for integration in includeIntegrations\n          options.integrations[integration] = true\n      analytics.page url, {}, options\n\n  trackEvent: (action, properties={}, includeIntegrations=[]) =>\n    console.log 'Tracking external analytics event:', action, properties, includeIntegrations if debugAnalytics\n    return unless me and @isProduction and not me.isAdmin()\n\n    @trackEventInternal action, _.cloneDeep properties    \n    @trackSnowplow action, _.cloneDeep properties\n\n\n\n    # Google Analytics\n    # https://developers.google.com/analytics/devguides/collection/analyticsjs/events\n    gaFieldObject =\n      hitType: 'event'\n      eventCategory: properties.category ? 'All'\n      eventAction: action\n    gaFieldObject.eventLabel = properties.label if properties.label?\n    gaFieldObject.eventValue = properties.value if properties.value?\n    ga? 'send', gaFieldObject\n    ga? 'codeplay.send', gaFieldObject if features.codePlay\n    \n    # Inspectlet\n    # http://www.inspectlet.com/docs#tagging\n    __insp?.push ['tagSession', action: action, properies: properties]\n\n    # Mixpanel\n    # Only log explicit events for now\n    mixpanel?.track(action, properties) if 'Mixpanel' in includeIntegrations\n\n    if me.isTeacher() and @segmentLoaded\n      options = {}\n      if includeIntegrations\n        # https://segment.com/docs/libraries/analytics.js/#selecting-integrations\n        options.integrations = All: false\n        for integration in includeIntegrations\n          options.integrations[integration] = true\n      analytics?.track action, {}, options\n\n  trackSnowplow: (event, properties) =>\n\n    return if event in ['Simulator Result', 'Started Level Load', 'Finished Level Load']\n    # Trimming properties we don't use internally\n    # TODO: delete properites.level for 'Saw Victory' after 2/8/15.  Should be using levelID instead.\n    if event in ['Clicked Start Level', 'Inventory Play', 'Heard Sprite', 'Started Level', 'Saw Victory', 'Click Play', 'Choose Inventory', 'Homepage Loaded', 'Change Hero']\n      delete properties.label\n\n    # SnowPlow\n    snowplowAction = event.toLowerCase().replace(/[^a-z0-9]+/ig, '_')\n    properties.user = me.id\n    delete properties.category\n    #console.log \"SnowPlow\", snowplowAction, properties\n    window.snowplow 'trackUnstructEvent',\n      schema: 'iglu:com.codecombat/' + snowplowAction + '/jsonschema/1-0-0'\n      data: properties\n\n  trackEventInternal: (event, properties) =>\n    return unless @supermodel?\n    # Skipping heavily logged actions we don't use internally\n    return if event in ['Simulator Result', 'Started Level Load', 'Finished Level Load', 'View Load']\n    # Trimming properties we don't use internally\n    # TODO: delete properites.level for 'Saw Victory' after 2/8/15.  Should be using levelID instead.\n    if event in ['Clicked Start Level', 'Inventory Play', 'Heard Sprite', 'Started Level', 'Saw Victory', 'Click Play', 'Choose Inventory', 'Homepage Loaded', 'Change Hero']\n      delete properties.category\n      delete properties.label\n    else if event in ['Loaded World Map', 'Started Signup', 'Finished Signup', 'Login', 'Facebook Login', 'Google Login', 'Show subscription modal']\n      delete properties.category\n\n    properties[key] = value for key, value of @explicitTraits if @explicitTraits?\n    console.log 'Tracking internal analytics event:', event, properties if debugAnalytics\n\n    request = @supermodel.addRequestResource {\n      url: '/db/analytics.log.event/-/log_event'\n      data: {event: event, properties: properties}\n      method: 'POST'\n    }, 0\n    request.load()\n\n  trackTiming: (duration, category, variable, label) ->\n    # https://developers.google.com/analytics/devguides/collection/analyticsjs/user-timings\n    return console.warn \"Duration #{duration} invalid for trackTiming call.\" unless duration >= 0 and duration < 60 * 60 * 1000\n    console.log 'Would track timing event:', arguments if debugAnalytics\n    return unless me and @isProduction and not me.isAdmin()\n    ga? 'send', 'timing', category, variable, duration, label\n\n  updateRole: ->\n    return if me.isAdmin()\n    return unless me.isTeacher()\n    return require('core/services/segment')() unless @segmentLoaded\n    @identify()\n    #analytics.page()  # It looks like we don't want to call this here because it somehow already gets called once in addition to this.\n    # TODO: record any events and pageviews that have built up before we knew we were a teacher.\n\n  onServiceLoaded: (e) ->\n    return unless e.service is 'segment'\n    @segmentLoaded = true\n    @updateRole()\n"]}