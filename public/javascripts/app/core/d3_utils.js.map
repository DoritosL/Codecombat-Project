{"version":3,"sources":["app/core/d3_utils.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/core/d3_utils.js","sourcesContent":["# Caller needs require 'vendor/d3'\n\nmodule.exports.createContiguousDays = (timeframeDays, skipToday=true) ->\n  # Return list of last 'timeframeDays' contiguous days in yyyy-mm-dd format\n  days = []\n  currentDate = new Date()\n  currentDate.setUTCDate(currentDate.getUTCDate() - timeframeDays + 1)\n  currentDate.setUTCDate(currentDate.getUTCDate() - 1) if skipToday\n  for i in [0...timeframeDays]\n    currentDay = currentDate.toISOString().substr(0, 10)\n    days.push(currentDay)\n    currentDate.setUTCDate(currentDate.getUTCDate() + 1)\n  days\n\nmodule.exports.createLineChart = (containerSelector, chartLines, containerWidth) ->\n  # Creates a line chart within 'containerSelector' based on chartLines\n  return unless chartLines?.length > 0 and containerSelector\n\n  margin = 20\n  keyHeight = 20\n  xAxisHeight = 20\n  yAxisWidth = 40\n  containerWidth = $(containerSelector).width() unless containerWidth\n  containerHeight = $(containerSelector).height()\n\n  yScaleCount = 0\n  yScaleCount++ for line in chartLines when line.showYScale\n  svg = d3.select(containerSelector).append(\"svg\")\n    .attr(\"width\", containerWidth)\n    .attr(\"height\", containerHeight)\n  width = containerWidth - margin * 2 - yAxisWidth * yScaleCount\n  height = containerHeight - margin * 2 - xAxisHeight - keyHeight * chartLines.length\n  currentLine = 0\n  currentYScale = 0\n\n  # Horizontal guidelines\n  marks = (Math.round(i * height / 5) for i in [1..5])\n  yRange = d3.scale.linear().range([height, 0]).domain([0, height])\n  svg.selectAll(\".line\")\n    .data(marks)\n    .enter()\n    .append(\"line\")\n    .attr(\"x1\", margin + yAxisWidth * yScaleCount)\n    .attr(\"y1\", (d) -> margin + yRange(d))\n    .attr(\"x2\", margin + yAxisWidth * yScaleCount + width)\n    .attr(\"y2\", (d) -> margin + yRange(d))\n    .attr(\"stroke\", 'gray')\n    .style(\"opacity\", \"0.3\")\n\n  for line in chartLines\n    # continue unless line.enabled\n    xRange = d3.scale.linear().range([0, width]).domain([d3.min(line.points, (d) -> d.x), d3.max(line.points, (d) -> d.x)])\n    yRange = d3.scale.linear().range([height, 0]).domain([line.min, line.max])\n\n    # x-Axis\n    if currentLine is 0\n      startDay = new Date(line.points[0].day)\n      endDay = new Date(line.points[line.points.length - 1].day)\n      xAxisRange = d3.time.scale()\n        .domain([startDay, endDay])\n        .range([0, width])\n      xAxis = d3.svg.axis()\n        .scale(xAxisRange)\n      svg.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .call(xAxis)\n        .selectAll(\"text\")\n        .attr(\"dy\", \".35em\")\n        .attr(\"transform\", \"translate(\" + (margin + yAxisWidth * yScaleCount) + \",\" + (height + margin) + \")\")\n        .style(\"text-anchor\", \"start\")\n\n    if line.showYScale\n      # y-Axis\n      lineColor = if yScaleCount > 1 then line.lineColor else 'black' \n      yAxisRange = d3.scale.linear().range([height, 0]).domain([line.min, line.max])\n      yAxis = d3.svg.axis()\n        .scale(yRange)\n        .orient(\"left\")\n      svg.append(\"g\")\n        .attr(\"class\", \"y axis\")\n        .attr(\"transform\", \"translate(\" + (margin + yAxisWidth * currentYScale) + \",\" + margin + \")\")\n        .style(\"color\", lineColor)\n        .call(yAxis)\n        .selectAll(\"text\")\n        .attr(\"y\", 0)\n        .attr(\"x\", 0)\n        .attr(\"fill\", lineColor)\n        .style(\"text-anchor\", \"start\")\n      currentYScale++\n\n    # Key\n    svg.append(\"line\")\n      .attr(\"x1\", margin)\n      .attr(\"y1\", margin + height + xAxisHeight + keyHeight * currentLine + keyHeight / 2)\n      .attr(\"x2\", margin + 40)\n      .attr(\"y2\", margin + height + xAxisHeight + keyHeight * currentLine + keyHeight / 2)\n      .attr(\"stroke\", line.lineColor)\n      .attr(\"class\", \"key-line\")\n    svg.append(\"text\")\n      .attr(\"x\", margin + 40 + 10)\n      .attr(\"y\", margin + height + xAxisHeight + keyHeight * currentLine + (keyHeight + 10) / 2)\n      .attr(\"fill\", line.lineColor)\n      .attr(\"class\", \"key-text\")\n      .text(line.description)\n\n    # Path and points\n    svg.selectAll(\".circle\")\n      .data(line.points)\n      .enter()\n      .append(\"circle\")\n      .attr(\"transform\", \"translate(\" + (margin + yAxisWidth * yScaleCount) + \",\" + margin + \")\")\n      .attr(\"cx\", (d) -> xRange(d.x))\n      .attr(\"cy\", (d) -> yRange(d.y))\n      .attr(\"r\", 2)\n      .attr(\"fill\", line.lineColor)\n      .attr(\"stroke-width\", 1)\n      .attr(\"class\", \"graph-point\")\n      .attr(\"data-pointid\", (d) -> \"#{line.lineID}#{d.x}\")\n    d3line = d3.svg.line()\n      .x((d) -> xRange(d.x))\n      .y((d) -> yRange(d.y))\n      .interpolate(\"linear\")\n    svg.append(\"path\")\n      .attr(\"d\", d3line(line.points))\n      .attr(\"transform\", \"translate(\" + (margin + yAxisWidth * yScaleCount) + \",\" + margin + \")\")\n      .style(\"stroke-width\", line.strokeWidth)\n      .style(\"stroke\", line.lineColor)\n      .style(\"fill\", \"none\")\n    currentLine++\n"]}