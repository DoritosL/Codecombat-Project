{"version":3,"sources":["app/core/social-handlers/FacebookHandler.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/core/social-handlers/FacebookHandler.js","sourcesContent":["CocoClass = require 'core/CocoClass'\n{me} = require 'core/auth'\n{backboneFailure} = require 'core/errors'\nstorage = require 'core/storage'\n\n# facebook user object props to\nuserPropsToSave =\n  'first_name': 'firstName'\n  'last_name': 'lastName'\n  'gender': 'gender'\n  'email': 'email'\n  'id': 'facebookID'\n\n\nmodule.exports = FacebookHandler = class FacebookHandler extends CocoClass\n\n  token: -> @authResponse?.accessToken\n\n  startedLoading: false\n  apiLoaded: false\n  connected: false\n  person: null\n  \n  fakeAPI: ->\n    window.FB =\n      login: (cb, options) ->\n        cb({status: 'connected', authResponse: { accessToken: '1234' }})\n      api: (url, options, cb) ->\n        cb({\n          first_name: 'Mr'\n          last_name: 'Bean'\n          id: 'abcd'\n          email: 'some@email.com'\n        })\n\n    @startedLoading = true\n    @apiLoaded = true\n\n  loadAPI: (options={}) ->\n    options.success ?= _.noop\n    options.context ?= options\n    if @apiLoaded\n      options.success.bind(options.context)()\n    else\n      @once 'load-api', options.success, options.context\n    \n    if not @startedLoading\n      # Load the SDK asynchronously\n      @startedLoading = true\n      ((d) ->\n        js = undefined\n        id = 'facebook-jssdk'\n        ref = d.getElementsByTagName('script')[0]\n        return  if d.getElementById(id)\n        js = d.createElement('script')\n        js.id = id\n        js.async = true\n        js.src = '//connect.facebook.net/en_US/sdk.js'\n    \n        #js.src = '//connect.facebook.net/en_US/all/debug.js'\n        ref.parentNode.insertBefore js, ref\n        return\n      )(document)\n\n      window.fbAsyncInit = =>\n        FB.init({\n          appId: (if document.location.origin is 'http://localhost:3000' then '607435142676437' else '148832601965463') # App ID\n          channelUrl: document.location.origin + '/channel.html' # Channel File\n          cookie: true # enable cookies to allow the server to access the session\n          xfbml: true # parse XFBML\n          version: 'v2.8'\n        })\n        FB.getLoginStatus (response) =>\n          if response.status is 'connected'\n            @connected = true\n            @authResponse = response.authResponse\n            @trigger 'connect', { response: response }\n          @apiLoaded = true\n          @trigger 'load-api'\n\n\n  connect: (options={}) ->\n    options.success ?= _.noop\n    options.context ?= options\n    FB.login ((response) =>\n      if response.status is 'connected'\n        @connected = true\n        @authResponse = response.authResponse\n        @trigger 'connect', { response: response }\n        options.success.bind(options.context)()\n    ), scope: 'email'\n\n\n  loadPerson: (options={}) ->\n    options.success ?= _.noop\n    options.context ?= options\n    FB.api '/me', {fields: 'email,last_name,first_name,gender'}, (person) =>\n      attrs = {}\n      for fbProp, userProp of userPropsToSave\n        value = person[fbProp]\n        if value\n          attrs[userProp] = value\n      @trigger 'load-person', attrs\n      options.success.bind(options.context)(attrs)\n\n  renderButtons: ->\n    setTimeout(FB.XFBML.parse, 10) if FB?.XFBML?.parse  # Handles FB login and Like\n"]}