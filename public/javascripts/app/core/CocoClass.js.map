{"version":3,"sources":["app/core/CocoClass.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/core/CocoClass.js","sourcesContent":["# Template for classes with common functions, like hooking into the Mediator.\nutils = require './../core/utils'\nclassCount = 0\nmakeScopeName = -> \"class-scope-#{classCount++}\"\ndoNothing = ->\n\nmodule.exports = class CocoClass\n  @nicks: []\n  @nicksUsed: {}\n  @remainingNicks: []\n  @nextNick: ->\n    return (@name or 'CocoClass') + ' ' + classCount unless @nicks.length\n    @remainingNicks = if @remainingNicks.length then @remainingNicks else @nicks.slice()\n    baseNick = @remainingNicks.splice(Math.floor(Math.random() * @remainingNicks.length), 1)[0]\n    i = 0\n    while true\n      nick = if i then \"#{baseNick} #{i}\" else baseNick\n      break unless @nicksUsed[nick]\n      i++\n    @nicksUsed[nick] = true\n    nick\n\n  subscriptions: {}\n  shortcuts: {}\n\n  # setup/teardown\n\n  constructor: ->\n    @nick = @constructor.nextNick()\n    @subscriptions = utils.combineAncestralObject(@, 'subscriptions')\n    @shortcuts = utils.combineAncestralObject(@, 'shortcuts')\n    @listenToSubscriptions()\n    @scope = makeScopeName()\n    @listenToShortcuts()\n    _.extend(@, Backbone.Events) if Backbone?\n\n  destroy: ->\n    # teardown subscriptions, prevent new ones\n    @stopListening?()\n    @off?()\n    @unsubscribeAll()\n    @stopListeningToShortcuts()\n    @constructor.nicksUsed[@nick] = false\n    @[key] = undefined for key of @\n    @destroyed = true\n    @off = doNothing\n    @destroy = doNothing\n\n  # subscriptions\n\n  listenToSubscriptions: ->\n    # for initting subscriptions\n    return unless Backbone?.Mediator?\n    for channel, func of @subscriptions\n      func = utils.normalizeFunc(func, @)\n      Backbone.Mediator.subscribe(channel, func, @)\n\n  addNewSubscription: (channel, func) ->\n    # this is for adding subscriptions on the fly, rather than at init\n    return unless Backbone?.Mediator?\n    return if @destroyed\n    return unless @subscriptions[channel] is undefined\n    func = utils.normalizeFunc(func, @)\n    @subscriptions[channel] = func\n    Backbone.Mediator.subscribe(channel, func, @)\n\n  unsubscribeAll: ->\n    return unless Backbone?.Mediator?\n    for channel, func of @subscriptions\n      func = utils.normalizeFunc(func, @)\n      Backbone.Mediator.unsubscribe(channel, func, @)\n\n  # keymaster shortcuts\n\n  listenToShortcuts: ->\n    return unless key?\n    for shortcut, func of @shortcuts\n      func = utils.normalizeFunc(func, @)\n      key(shortcut, @scope, _.bind(func, @))\n\n  stopListeningToShortcuts: ->\n    return unless key?\n    key.deleteScope(@scope)\n\n  playSound: (trigger, volume=1) ->\n    Backbone.Mediator.publish 'audio-player:play-sound', trigger: trigger, volume: volume\n\n  wait: (event) -> new Promise((resolve) => @once(event, resolve))\n"]}