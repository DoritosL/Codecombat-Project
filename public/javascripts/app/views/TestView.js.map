{"version":3,"sources":["app/templates/test-view.jade","app/views/TestView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnNA;AAAA;;ACAA;EAAA;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,qBAAR;;AACX,eAAe,QAAQ,kBAAR;;AACf,UAAU,QAAQ,cAAR;;AAEV,QAAQ,uBAAR;;AACA,QAAQ,OAAR;;AAEA,sBAAsB;;AACtB,kBAAkB;;AAElB,MAAM,CAAC,OAAP,GAAiB,WAAiB;;;;;;;qBAChC,KAAI;;qBACJ,WAAU;;qBACV,gBAAe;;qBACf,YAAW;;qBAEX,SACE;IAAA,yBAAyB,wBAAzB;IACA,yBAAyB,wBADzB;;;qBAKF,aAAY,SAAC,OAAD,EAAU,OAAV;IAAU,IAAC,6BAAD,UAAS;IAC7B,IAA4B,IAAC,QAAQ,GAAT,KAAe,GAA3C;MAAA,IAAC,QAAD,GAAW,IAAC,QAAQ,UAApB;;IACA,IAAC,QAAD,GAAW,OAAO,CAAC,IAAR,CAAa,UAAb;IACX,IAAC,eAAD,GAAkB;WAClB,IAAC,cAAD,GAAiB;EAJP;;qBAMZ,cAAa;IACX,IAAC,cAAD;IACA,IAAC,OAAD;IACA,QAAQ,CAAC,QAAT,CAAkB,IAAC,UAAnB,EAA8B,IAAC,QAA/B,EAAwC,IAAxC;WACA,MAAM,CAAC,UAAP;EAJW;;qBAQb,yBAAwB;IACtB,OAAO,CAAC,IAAR,CAAa,UAAb,EAAyB,IAAzB;WACA,QAAQ,CAAC,QAAQ,CAAC,MAAlB;EAFsB;;qBAIxB,yBAAwB;IACtB,OAAO,CAAC,MAAR,CAAe,UAAf;WACA,QAAQ,CAAC,QAAQ,CAAC,MAAlB;EAFsB;;qBAMxB,gBAAe;AACb;IAAA,IAAI,6CAAM,SAAN;IACJ,CAAC,CAAC,aAAF,GAAkB,YAAY,CAAC,gBAAb,CAA8B,IAAC,QAA/B,EAAwC,eAAxC;IAClB,CAAC,CAAC,QAAF,GAAa,YAAY,CAAC,sBAAb,CAAoC,IAAC,UAArC,EAAgD,IAAC,QAAjD,EAA0D,mBAA1D,EAA+E,eAA/E;IACb,QAAQ,IAAC,QAAO,CAAC,KAAT,CAAe,GAAf;IACR,CAAC,CAAC,aAAF,GAAkB,KAAM,MAAK,CAAC,MAAN,GAAa,CAAb,CAAN,IAAyB,KAAM,MAAK,CAAC,MAAN,GAAa,CAAb,CAA/B,IAAkD;WACpE;EANa;;qBAUf,gBAAe;AACb;IAAA,IAAC,UAAD,GAAa,QAAQ,CAAC,eAAT;IACb,IAAG,IAAC,QAAJ;MACE,SAAS,sBAAsB,IAAC;aAChC,IAAC,UAAD;;AAAc;AAAA;aAAA;;cAA2B,CAAC,CAAC,MAAM,CAAC,UAAT,CAAoB,CAApB,EAAuB,MAAvB;yBAA3B;;AAAA;;oBAFhB;;EAFa;;EAMf,QAAC,SAAD,GAAW,SAAC,SAAD,EAAY,OAAZ,EAA2B,IAA3B;AAET;;MAFqB,UAAQ;;IAE7B,OAAO,CAAC,MAAR,EAAgB,CAAC,WAAjB,CAA6B;MAC3B,YAAY,EADe;MAG3B,UAAU,SAAC,MAAD;AACR;QAAA,IAAG,MAAM,CAAC,MAAP,KAAiB,QAApB;UACE,SAAS;YACP,mBAAmB,CAAC,CAAC,KAAF,CAAQ,IAAC,WAAT,CADZ;YAEP;;AAAe;AAAA;mBAAA;;6BAAA,EAAE,CAAC;AAAH;;gBAFR;YAGP,iBAAiB,MAAM,CAAC,WAHjB;;;YAKT,IAAI,CAAE,cAAc,CAAC,IAArB,CAA0B,MAA1B;;gCACA,IAAI,CAAE,eAAN,CAAsB,kBAAtB,WAPF;;MADQ,CAHiB;MAa3B,cAAc,SAAC,MAAD;eACZ,IAAC,WAAU,CAAC,IAAZ,CAAiB,MAAM,CAAC,WAAxB;MADY,CAba;MAgB3B,WAAW,SAAC,MAAD;eACT,IAAC,WAAU,CAAC,GAAZ;MADS,CAhBgB;KAA7B;IAqBA,WAAW,CAAC,OAAZ,GAAsB;;MACtB,YAAa,IAAC,gBAAD;;IACb,IAAG,OAAH;MACE,OAAO,CAAC,MAAR,GAAiB,CAAC,CAAC,IAAF,CAAO,SAAC,GAAD;eACtB,EAAE,YAAF,CAAe,CAAC,MAAhB,CAAuB,GAAvB;MADsB,CAAP;MAEjB,OAAO,CAAC,SAAR,GAAoB,CAAC,CAAC,IAAF,CAAO,SAAC,KAAD;eACzB,WAAW,CAAC,aAAZ,CAA0B,KAA1B;MADyB,CAAP,EAHtB;KAAA;MAME,OAAO,CAAC,MAAR,GAAiB,CAAC,CAAC;MACnB,OAAO,CAAC,SAAR,GAAoB,CAAC,CAAC,KAPxB;;IASA,OAAO,CAAC,IAAI,CAAC,OAAb;IACA,WAAW;MACT,EAAE,CAAC,KAAH;MACA,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAtB;MACA,QAAQ,CAAC,QAAQ,CAAC,IAAlB;MACA,QAAQ,CAAC,QAAQ,CAAC,oBAAlB,CAAuC,KAAvC;MACA,MAAM,WAAW,CAAC,OAAlB,EAA2B,YAA3B;aACA,WAAW,CAAC,eAAZ,GAA8B;IANrB,CAAX;IAYA,UAAU;AACR;8DAA2B,CAAE,OAA7B,CAAqC,SAAC,SAAD;eACnC,aAAa,SAAb;MADmC,CAArC;IADQ,CAAV;AAMA;SAAA;;mBAAA,QAAQ,CAAR;AAAA;;EArDS;;EAuDX,QAAC,gBAAD,GAAmB;AACjB;IAAA,WAAW,MAAM,CAAC,OAAO,CAAC,IAAf;AACV;SAAA;;UAAyB,CAAC,CAAC,OAAF,CAAU,OAAV,IAAqB,CAAC;qBAA/C;;AAAA;;EAFgB;;qBAInB,UAAS;WAGP,QAAQ,CAAC,QAAQ,CAAC,MAAlB;EAHO;;;;GA/GwC","file":"public/javascripts/app/views/TestView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),parentFolders = locals_.parentFolders,currentFolder = locals_.currentFolder,view = locals_.view,children = locals_.children;buf.push(\"<div id=\\\"demo-area\\\"></div><h2 id=\\\"test-h2\\\">Testing Page</h2><ol class=\\\"breadcrumb\\\">\");\n// iterate parentFolders\n;(function(){\n  var $$obj = parentFolders;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var path = $$obj[$index];\n\nbuf.push(\"<li><a\" + (jade.attrs({ 'href':(path.url) }, {\"href\":true})) + \">\" + (jade.escape(null == (jade.interp = path.name) ? \"\" : jade.interp)) + \"</a></li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var path = $$obj[$index];\n\nbuf.push(\"<li><a\" + (jade.attrs({ 'href':(path.url) }, {\"href\":true})) + \">\" + (jade.escape(null == (jade.interp = path.name) ? \"\" : jade.interp)) + \"</a></li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<li class=\\\"active\\\">\" + (jade.escape(null == (jade.interp = currentFolder) ? \"\" : jade.interp)) + \"</li></ol><div class=\\\"container-fluid\\\"><div class=\\\"row\\\"><div class=\\\"col-md-8\\\"><div id=\\\"failure-reports\\\">\");\n// iterate view.failureReports\n;(function(){\n  var $$obj = view.failureReports;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var report = $$obj[$index];\n\nbuf.push(\"<div class=\\\"alert alert-danger alert-report\\\"><ul class=\\\"suite-list\\\">\");\n// iterate report.suiteDescriptions\n;(function(){\n  var $$obj = report.suiteDescriptions;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var description = $$obj[$index];\n\nbuf.push(\"<li>\" + (jade.escape(null == (jade.interp = description) ? \"\" : jade.interp)) + \"</li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var description = $$obj[$index];\n\nbuf.push(\"<li>\" + (jade.escape(null == (jade.interp = description) ? \"\" : jade.interp)) + \"</li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<li><strong>... \" + (jade.escape((jade.interp = report.testDescription) == null ? '' : jade.interp)) + \"</strong></li></ul><hr/><ol class=\\\"error-list\\\">\");\n// iterate report.failMessages\n;(function(){\n  var $$obj = report.failMessages;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var message = $$obj[$index];\n\nbuf.push(\"<li><strong>\" + (jade.escape(null == (jade.interp = message) ? \"\" : jade.interp)) + \"</strong></li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var message = $$obj[$index];\n\nbuf.push(\"<li><strong>\" + (jade.escape(null == (jade.interp = message) ? \"\" : jade.interp)) + \"</strong></li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</ol></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var report = $$obj[$index];\n\nbuf.push(\"<div class=\\\"alert alert-danger alert-report\\\"><ul class=\\\"suite-list\\\">\");\n// iterate report.suiteDescriptions\n;(function(){\n  var $$obj = report.suiteDescriptions;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var description = $$obj[$index];\n\nbuf.push(\"<li>\" + (jade.escape(null == (jade.interp = description) ? \"\" : jade.interp)) + \"</li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var description = $$obj[$index];\n\nbuf.push(\"<li>\" + (jade.escape(null == (jade.interp = description) ? \"\" : jade.interp)) + \"</li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"<li><strong>... \" + (jade.escape((jade.interp = report.testDescription) == null ? '' : jade.interp)) + \"</strong></li></ul><hr/><ol class=\\\"error-list\\\">\");\n// iterate report.failMessages\n;(function(){\n  var $$obj = report.failMessages;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var message = $$obj[$index];\n\nbuf.push(\"<li><strong>\" + (jade.escape(null == (jade.interp = message) ? \"\" : jade.interp)) + \"</strong></li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var message = $$obj[$index];\n\nbuf.push(\"<li><strong>\" + (jade.escape(null == (jade.interp = message) ? \"\" : jade.interp)) + \"</strong></li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</ol></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div><div id=\\\"test-wrapper\\\" class=\\\"well\\\"><div id=\\\"testing-area\\\"></div></div></div><div class=\\\"col-md-4 hidden-sm hidden-xs\\\"><div id=\\\"test-nav\\\" class=\\\"nav nav-pills nav-stacked well\\\">\");\nif ( view.demosOn)\n{\nbuf.push(\"<button id=\\\"hide-demos-btn\\\" class=\\\"btn btn-danger btn-block\\\">Hide Demos</button>\");\n}\nelse\n{\nbuf.push(\"<button id=\\\"show-demos-btn\\\" class=\\\"btn btn-info btn-block\\\">Show Demos</button>\");\n}\nbuf.push(\"<hr/>\");\n// iterate children\n;(function(){\n  var $$obj = children;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var child = $$obj[$index];\n\nbuf.push(\"<li\" + (jade.attrs({ \"class\": [(child.type)] }, {\"class\":true})) + \"><a\" + (jade.attrs({ 'href':(child.url), \"class\": [('small')] }, {\"href\":true})) + \">\");\nif ( child.type == 'folder')\n{\nbuf.push(\"<span class=\\\"glyphicon glyphicon-folder-close\\\"></span>\");\n}\nelse\n{\nbuf.push(\"<span class=\\\"glyphicon glyphicon-file\\\"></span>\");\n}\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = child.name) ? \"\" : jade.interp)) + \"</span>\");\nif ( child.type == 'folder')\n{\nbuf.push(\"<strong>(\" + (jade.escape((jade.interp = child.size) == null ? '' : jade.interp)) + \")</strong>\");\n}\nbuf.push(\"</a></li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var child = $$obj[$index];\n\nbuf.push(\"<li\" + (jade.attrs({ \"class\": [(child.type)] }, {\"class\":true})) + \"><a\" + (jade.attrs({ 'href':(child.url), \"class\": [('small')] }, {\"href\":true})) + \">\");\nif ( child.type == 'folder')\n{\nbuf.push(\"<span class=\\\"glyphicon glyphicon-folder-close\\\"></span>\");\n}\nelse\n{\nbuf.push(\"<span class=\\\"glyphicon glyphicon-file\\\"></span>\");\n}\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = child.name) ? \"\" : jade.interp)) + \"</span>\");\nif ( child.type == 'folder')\n{\nbuf.push(\"<strong>(\" + (jade.escape((jade.interp = child.size) == null ? '' : jade.interp)) + \")</strong>\");\n}\nbuf.push(\"</a></li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\ntemplate = require 'templates/test-view'\nrequireUtils = require 'lib/requireUtils'\nstorage = require 'core/storage'\n\nrequire 'vendor/jasmine-bundle'\nrequire 'tests'\n\nTEST_REQUIRE_PREFIX = 'test/app/'\nTEST_URL_PREFIX = '/test/'\n\nmodule.exports = TestView = class TestView extends RootView\n  id: 'test-view'\n  template: template\n  reloadOnClose: true\n  className: 'style-flat'\n  \n  events:\n    'click #show-demos-btn': 'onClickShowDemosButton'\n    'click #hide-demos-btn': 'onClickHideDemosButton'\n\n  # INITIALIZE\n\n  initialize: (options, @subPath='') ->\n    @subPath = @subPath[1..] if @subPath[0] is '/'\n    @demosOn = storage.load('demos-on')\n    @failureReports = []\n    @loadedFileIDs = []\n\n  afterInsert: ->\n    @initSpecFiles()\n    @render()\n    TestView.runTests(@specFiles, @demosOn, @)\n    window.runJasmine()\n    \n  # EVENTS\n\n  onClickShowDemosButton: ->\n    storage.save('demos-on', true)\n    document.location.reload()\n\n  onClickHideDemosButton: ->\n    storage.remove('demos-on')\n    document.location.reload()\n\n  # RENDER DATA\n\n  getRenderData: ->\n    c = super(arguments...)\n    c.parentFolders = requireUtils.getParentFolders(@subPath, TEST_URL_PREFIX)\n    c.children = requireUtils.parseImmediateChildren(@specFiles, @subPath, TEST_REQUIRE_PREFIX, TEST_URL_PREFIX)\n    parts = @subPath.split('/')\n    c.currentFolder = parts[parts.length-1] or parts[parts.length-2] or 'All'\n    c\n\n  # RUNNING TESTS\n\n  initSpecFiles: ->\n    @specFiles = TestView.getAllSpecFiles()\n    if @subPath\n      prefix = TEST_REQUIRE_PREFIX + @subPath\n      @specFiles = (f for f in @specFiles when _.string.startsWith f, prefix)\n\n  @runTests: (specFiles, demosOn=false, view) ->\n    \n    jasmine.getEnv().addReporter({\n      suiteStack: []\n      \n      specDone: (result) ->\n        if result.status is 'failed'\n          report = {\n            suiteDescriptions: _.clone(@suiteStack)\n            failMessages: (fe.message for fe in result.failedExpectations)\n            testDescription: result.description\n          }\n          view?.failureReports.push(report)\n          view?.renderSelectors('#failure-reports')\n        \n      suiteStarted: (result) ->\n        @suiteStack.push(result.description)\n\n      suiteDone: (result) ->\n        @suiteStack.pop()\n        \n    })\n    \n    application.testing = true\n    specFiles ?= @getAllSpecFiles()\n    if demosOn\n      jasmine.demoEl = _.once ($el) ->\n        $('#demo-area').append($el)\n      jasmine.demoModal = _.once (modal) ->\n        currentView.openModalView(modal)\n    else\n      jasmine.demoEl = _.noop\n      jasmine.demoModal = _.noop\n\n    jasmine.Ajax.install()\n    beforeEach ->\n      me.clear()\n      jasmine.Ajax.requests.reset()\n      Backbone.Mediator.init()\n      Backbone.Mediator.setValidationEnabled false\n      spyOn(application.tracker, 'trackEvent')\n      application.timeoutsToClear = []\n      # TODO Stubbify more things\n      #   * document.location\n      #   * firebase\n      #   * all the services that load in main.html\n\n    afterEach ->\n      application.timeoutsToClear?.forEach (timeoutID) ->\n        clearTimeout(timeoutID)\n      # TODO Clean up more things\n      #   * Events\n\n    require f for f in specFiles # runs the tests\n\n  @getAllSpecFiles = ->\n    allFiles = window.require.list()\n    (f for f in allFiles when f.indexOf('.spec') > -1)\n\n  destroy: ->\n    # hack to get jasmine tests to properly run again on clicking links, and make sure if you\n    # leave this page (say, back to the main site) that test stuff doesn't follow you.\n    document.location.reload()\n"]}