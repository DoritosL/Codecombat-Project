{"version":3,"sources":["app/views/core/CreateAccountModal/BasicInfoView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/core/CreateAccountModal/BasicInfoView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\nAuthModal = require 'views/core/AuthModal'\ntemplate = require 'templates/core/create-account-modal/basic-info-view'\nforms = require 'core/forms'\nerrors = require 'core/errors'\nUser = require 'models/User'\nState = require 'models/State'\n\n###\nThis view handles the primary form for user details â€” name, email, password, etc,\nand the AJAX that actually creates the user.\n\nIt also handles facebook/g+ login, which if used, open one of two other screens:\nsso-already-exists: If the facebook/g+ connection is already associated with a user, they're given a log in button\nsso-confirm: If this is a new facebook/g+ connection, ask for a username, then allow creation of a user\n\nThe sso-confirm view *inherits from this view* in order to share its account-creation logic and events.\nThis means the selectors used in these events must work in both templates.\n\nThis view currently uses the old form API instead of stateful render.\nIt needs some work to make error UX and rendering better, but is functional.\n###\n\nmodule.exports = class BasicInfoView extends CocoView\n  id: 'basic-info-view'\n  template: template\n\n  events:\n    'change input[name=\"email\"]': 'onChangeEmail'\n    'change input[name=\"name\"]': 'onChangeName'\n    'change input[name=\"password\"]': 'onChangePassword'\n    'click .back-button': 'onClickBackButton'\n    'submit form': 'onSubmitForm'\n    'click .use-suggested-name-link': 'onClickUseSuggestedNameLink'\n    'click #facebook-signup-btn': 'onClickSsoSignupButton'\n    'click #gplus-signup-btn': 'onClickSsoSignupButton'\n\n  initialize: ({ @signupState } = {}) ->\n    @state = new State {\n      suggestedNameText: '...'\n      checkEmailState: 'standby' # 'checking', 'exists', 'available'\n      checkEmailValue: null\n      checkEmailPromise: null\n      checkNameState: 'standby' # same\n      checkNameValue: null\n      checkNamePromise: null\n      error: ''\n    }\n    @listenTo @state, 'change:checkEmailState', -> @renderSelectors('.email-check')\n    @listenTo @state, 'change:checkNameState', -> @renderSelectors('.name-check')\n    @listenTo @state, 'change:error', -> @renderSelectors('.error-area')\n    @listenTo @signupState, 'change:facebookEnabled', -> @renderSelectors('.auth-network-logins')\n    @listenTo @signupState, 'change:gplusEnabled', -> @renderSelectors('.auth-network-logins')\n  \n  # These values are passed along to AuthModal if the user clicks \"Sign In\" (handled by CreateAccountModal)\n  updateAuthModalInitialValues: (values) ->\n    @signupState.set {\n      authModalInitialValues: _.merge @signupState.get('authModalInitialValues'), values\n    }, { silent: true }\n    \n  onChangeEmail: (e) ->\n    @updateAuthModalInitialValues { email: @$(e.currentTarget).val() }\n    @checkEmail()\n    \n  checkEmail: ->\n    email = @$('[name=\"email\"]').val()\n\n    if @signupState.get('path') isnt 'student' and (not _.isEmpty(email) and email is @state.get('checkEmailValue'))\n      return @state.get('checkEmailPromise')\n      \n    if not (email and forms.validateEmail(email))\n      @state.set({\n        checkEmailState: 'standby'\n        checkEmailValue: email\n        checkEmailPromise: null\n      })\n      return Promise.resolve()\n      \n    @state.set({\n      checkEmailState: 'checking'\n      checkEmailValue: email\n      \n      checkEmailPromise: (User.checkEmailExists(email)\n      .then ({exists}) =>\n        return unless email is @$('[name=\"email\"]').val()\n        if exists\n          @state.set('checkEmailState', 'exists')\n        else\n          @state.set('checkEmailState', 'available')\n      .catch (e) =>\n        @state.set('checkEmailState', 'standby')\n        throw e\n      )\n    })\n    return @state.get('checkEmailPromise')\n\n  onChangeName: (e) ->\n    @updateAuthModalInitialValues { name: @$(e.currentTarget).val() }\n    @checkName()\n\n  checkName: ->\n    name = @$('input[name=\"name\"]').val()\n\n    if name is @state.get('checkNameValue')\n      return @state.get('checkNamePromise')\n\n    if not name\n      @state.set({\n        checkNameState: 'standby'\n        checkNameValue: name\n        checkNamePromise: null\n      })\n      return Promise.resolve()\n\n    @state.set({\n      checkNameState: 'checking'\n      checkNameValue: name\n\n      checkNamePromise: (User.checkNameConflicts(name)\n      .then ({ suggestedName, conflicts }) =>\n        return unless name is @$('input[name=\"name\"]').val()\n        if conflicts\n          suggestedNameText = $.i18n.t('signup.name_taken').replace('{{suggestedName}}', suggestedName)\n          @state.set({ checkNameState: 'exists', suggestedNameText })\n        else\n          @state.set { checkNameState: 'available' }\n      .catch (error) =>\n        @state.set('checkNameState', 'standby')\n        throw error\n      )\n    })\n\n    return @state.get('checkNamePromise')\n\n  onChangePassword: (e) ->\n    @updateAuthModalInitialValues { password: @$(e.currentTarget).val() }\n\n  checkBasicInfo: (data) ->\n    # TODO: Move this to somewhere appropriate\n    tv4.addFormat({\n      'email': (email) ->\n        if forms.validateEmail(email)\n          return null\n        else\n          return {code: tv4.errorCodes.FORMAT_CUSTOM, message: \"Please enter a valid email address.\"}\n    })\n    \n    forms.clearFormAlerts(@$el)\n    \n    if data.name and forms.validateEmail(data.name)\n      forms.setErrorToProperty(@$el, 'name', $.i18n.t('signup.name_is_email'))\n      return false\n    \n    res = tv4.validateMultiple data, @formSchema()\n    forms.applyErrorsToForm(@$('form'), res.errors) unless res.valid\n    return res.valid\n  \n  formSchema: ->\n    type: 'object'\n    properties:\n      email: User.schema.properties.email\n      name: User.schema.properties.name\n      password: User.schema.properties.password\n    required: ['name', 'password'].concat (if @signupState.get('path') is 'student' then ['firstName', 'lastName'] else ['email'])\n  \n  onClickBackButton: -> @trigger 'nav-back'\n  \n  onClickUseSuggestedNameLink: (e) ->\n    @$('input[name=\"name\"]').val(@state.get('suggestedName'))\n    forms.clearFormAlerts(@$el.find('input[name=\"name\"]').closest('.form-group').parent())\n\n  onSubmitForm: (e) ->\n    @state.unset('error')\n    e.preventDefault()\n    data = forms.formToObject(e.currentTarget)\n    valid = @checkBasicInfo(data)\n    return unless valid\n\n    @displayFormSubmitting()\n    AbortError = new Error()\n    \n    @checkEmail()\n    .then @checkName()\n    .then =>\n      if not (@state.get('checkEmailState') in ['available', 'standby'] and @state.get('checkNameState') is 'available')\n        throw AbortError\n\n      # update User\n      emails = _.assign({}, me.get('emails'))\n      emails.generalNews ?= {}\n      emails.generalNews.enabled = @$('#subscribe-input').is(':checked') and not _.isEmpty(@state.get('checkEmailValue'))\n      me.set('emails', emails)\n      me.set(_.pick(data, 'firstName', 'lastName'))\n      \n      unless _.isNaN(@signupState.get('birthday').getTime())\n        me.set('birthday', @signupState.get('birthday').toISOString())\n\n      me.set(_.omit(@signupState.get('ssoAttrs') or {}, 'email', 'facebookID', 'gplusID'))\n\n      jqxhr = me.save()\n      if not jqxhr\n        console.error(me.validationError)\n        throw new Error('Could not save user')\n\n      return new Promise(jqxhr.then)\n    \n    .then =>\n      # Use signup method\n      window.tracker?.identify()\n      switch @signupState.get('ssoUsed')\n        when 'gplus'\n          { email, gplusID } = @signupState.get('ssoAttrs')\n          { name } = forms.formToObject(@$el)\n          jqxhr = me.signupWithGPlus(name, email, gplusID)\n        when 'facebook'\n          { email, facebookID } = @signupState.get('ssoAttrs')\n          { name } = forms.formToObject(@$el)\n          jqxhr = me.signupWithFacebook(name, email, facebookID)\n        else\n          { name, email, password } = forms.formToObject(@$el)\n          jqxhr = me.signupWithPassword(name, email, password)\n\n      return new Promise(jqxhr.then)\n      \n    .then =>\n      { classCode, classroom } = @signupState.attributes\n      if classCode and classroom\n        return new Promise(classroom.joinWithCode(classCode).then)\n      \n    .then =>\n      @finishSignup()\n        \n    .catch (e) =>\n      @displayFormStandingBy()\n      if e is AbortError\n        return\n      else\n        console.error 'BasicInfoView form submission Promise error:', e\n        @state.set('error', e.responseJSON?.message or 'Unknown Error')\n      \n  finishSignup: ->\n    @trigger 'signup'\n\n  displayFormSubmitting: ->\n    @$('#create-account-btn').text($.i18n.t('signup.creating')).attr('disabled', true)\n    @$('input').attr('disabled', true)\n    \n  displayFormStandingBy: ->\n    @$('#create-account-btn').text($.i18n.t('login.sign_up')).attr('disabled', false)\n    @$('input').attr('disabled', false)\n\n  onClickSsoSignupButton: (e) ->\n    e.preventDefault()\n    ssoUsed = $(e.currentTarget).data('sso-used')\n    handler = if ssoUsed is 'facebook' then application.facebookHandler else application.gplusHandler\n    handler.connect({\n      context: @\n      success: ->\n        handler.loadPerson({\n          context: @\n          success: (ssoAttrs) ->\n            @signupState.set { ssoAttrs }\n            { email } = ssoAttrs\n            User.checkEmailExists(email).then ({exists}) =>\n              @signupState.set {\n                ssoUsed\n                email: ssoAttrs.email\n              }\n              if exists\n                @trigger 'sso-connect:already-in-use'\n              else\n                @trigger 'sso-connect:new-user'\n        })\n    })\n"]}