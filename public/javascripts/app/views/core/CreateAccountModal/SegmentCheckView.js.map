{"version":3,"sources":["app/views/core/CreateAccountModal/SegmentCheckView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/core/CreateAccountModal/SegmentCheckView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\ntemplate = require 'templates/core/create-account-modal/segment-check-view'\nforms = require 'core/forms'\nClassroom = require 'models/Classroom'\nState = require 'models/State'\n\nmodule.exports = class SegmentCheckView extends CocoView\n  id: 'segment-check-view'\n  template: template\n\n  events:\n    'click .back-to-account-type': -> @trigger 'nav-back'\n    'input .class-code-input': 'onInputClassCode'\n    'change .birthday-form-group': 'onInputBirthday'\n    'submit form.segment-check': 'onSubmitSegmentCheck'\n    'click .individual-path-button': -> @trigger 'choose-path', 'individual'\n\n  initialize: ({ @signupState } = {}) ->\n    @checkClassCodeDebounced = _.debounce @checkClassCode, 1000\n    @fetchClassByCode = _.memoize(@fetchClassByCode)\n    @classroom = new Classroom()\n    @state = new State()\n    if @signupState.get('classCode')\n      @checkClassCode(@signupState.get('classCode'))\n    @listenTo @state, 'all', _.debounce(->\n      @renderSelectors('.render')\n      @trigger 'special-render'\n    )\n    \n  getClassCode: -> @$('.class-code-input').val() or @signupState.get('classCode') \n\n  onInputClassCode: ->\n    @classroom = new Classroom()\n    forms.clearFormAlerts(@$el)\n    classCode = @getClassCode()\n    @signupState.set { classCode }, { silent: true }\n    @checkClassCodeDebounced()\n    \n  checkClassCode: ->\n    return if @destroyed\n    classCode = @getClassCode()\n    \n    @fetchClassByCode(classCode)\n    .then (classroom) =>\n      return if @destroyed or @getClassCode() isnt classCode\n      if classroom\n        @classroom = classroom\n        @state.set { classCodeValid: true, segmentCheckValid: true }\n      else\n        @classroom = new Classroom()\n        @state.set { classCodeValid: false, segmentCheckValid: false }\n    .catch (error) ->\n      throw error\n      \n  onInputBirthday: ->\n    { birthdayYear, birthdayMonth, birthdayDay } = forms.formToObject(@$('form'))\n    birthday = new Date Date.UTC(birthdayYear, birthdayMonth - 1, birthdayDay)\n    @signupState.set { birthdayYear, birthdayMonth, birthdayDay, birthday }, { silent: true }\n    unless _.isNaN(birthday.getTime())\n      forms.clearFormAlerts(@$el)\n    \n  onSubmitSegmentCheck: (e) ->\n    e.preventDefault()\n    \n    if @signupState.get('path') is 'student'\n      @$('.class-code-input').attr('disabled', true)\n    \n      @fetchClassByCode(@getClassCode())\n      .then (classroom) =>\n        return if @destroyed\n        if classroom\n          @signupState.set { classroom }\n          @trigger 'nav-forward'\n        else\n          @$('.class-code-input').attr('disabled', false)\n          @classroom = new Classroom()\n          @state.set { classCodeValid: false, segmentCheckValid: false }\n      .catch (error) ->\n        throw error\n        \n    else if @signupState.get('path') is 'individual'\n      if _.isNaN(@signupState.get('birthday').getTime())\n        forms.clearFormAlerts(@$el)\n        forms.setErrorToProperty @$el, 'birthdayDay', 'Required'\n      else\n        age = (new Date().getTime() - @signupState.get('birthday').getTime()) / 365.4 / 24 / 60 / 60 / 1000\n        if age > 13\n          @trigger 'nav-forward'\n        else\n          @trigger 'nav-forward', 'coppa-deny'\n\n  fetchClassByCode: (classCode) ->\n    if not classCode\n      return Promise.resolve()\n      \n    new Promise((resolve, reject) ->\n      new Classroom().fetchByCode(classCode, {\n        success: resolve\n        error: (classroom, jqxhr) ->\n          if jqxhr.status is 404\n            resolve()\n          else\n            reject(jqxhr.responseJSON)\n      })\n    )\n  \n"]}