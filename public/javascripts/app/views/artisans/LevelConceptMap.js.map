{"version":3,"sources":["app/views/artisans/LevelConceptMap.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/artisans/LevelConceptMap.js","sourcesContent":["RootView = require 'views/core/RootView'\ntemplate = require 'templates/artisans/concept-map-view'\n\nLevel = require 'models/Level'\nCampaign = require 'models/Campaign'\n\nCocoCollection = require 'collections/CocoCollection'\nCampaigns = require 'collections/Campaigns'\nLevels = require 'collections/Levels'\ntagger = require 'lib/SolutionConceptTagger'\nconceptList =require 'schemas/concepts'\n\nunless typeof esper is 'undefined'\n  realm = new esper().realm\n  parser = realm.parser.bind(realm)\n\nmodule.exports = class LevelConceptMap extends RootView\n  template: template\n  id: 'solution-problems-view'\n  excludedCampaigns = [\n    # Misc. campaigns\n    'picoctf', 'auditions'\n\n    # Campaign-version campaigns\n    #'dungeon', 'forest', 'desert', 'mountain', 'glacier'\n\n    # Test campaigns\n    'dungeon-branching-test', 'forest-branching-test', 'desert-branching-test'\n\n    # Course-version campaigns\n    #'intro', 'course-2', 'course-3', 'course-4', 'course-5', 'course-6'\n  ]\n\n  includedLanguages = [\n    'javascript'\n  ]\n\n  excludedLevelSnippets = [\n    'treasure', 'brawl', 'siege'\n  ]\n\n  unloadedCampaigns: 0\n  campaignLevels: {}\n  loadedLevels: {}\n  data: {}\n  problemCount: 0\n\n  initialize: ->\n    @campaigns = new Campaigns([])\n    @listenTo(@campaigns, 'sync', @onCampaignsLoaded)\n    @supermodel.trackRequest(@campaigns.fetch(\n      data:\n        project:'slug'\n    ))\n\n  onCampaignsLoaded: (campCollection) ->\n    for campaign in campCollection.models\n      campaignSlug = campaign.get('slug')\n      continue if campaignSlug in excludedCampaigns\n      @unloadedCampaigns++\n\n      @campaignLevels[campaignSlug] = new Levels()\n      @listenTo(@campaignLevels[campaignSlug], 'sync', @onLevelsLoaded.bind @, campaignSlug)\n      @supermodel.trackRequest(@campaignLevels[campaignSlug].fetchForCampaign(campaignSlug,\n        data:\n          project: 'thangs,name,slug,campaign'\n      ))\n\n  onLevelsLoaded: (campaignSlug, lvlCollection) ->\n    for level, k in lvlCollection.models\n      level.campaign = campaignSlug\n      @loadedLevels[campaignSlug] = {} unless @loadedLevels[campaignSlug]?\n      ll = {} unless ll?\n      level.seqNo = lvlCollection.models.length - k\n      @loadedLevels[campaignSlug][level.get('slug')] = level\n    if --@unloadedCampaigns is 0\n      @onAllLevelsLoaded()\n\n  onAllLevelsLoaded: ->\n    for campaignSlug, campaign of @loadedLevels\n      for levelSlug, level of campaign\n        unless level?\n          console.error 'Level Slug doesn\\'t have associated Level', levelSlug\n          continue\n\n        isBad = false\n        for word in excludedLevelSnippets\n          if levelSlug.indexOf(word) isnt -1\n            isBad = true\n        continue if isBad\n        thangs = level.get 'thangs'\n        component = null\n        thangs = _.filter(thangs, (elem) ->\n          return _.findWhere(elem.components, (elem2) ->\n            if elem2.config?.programmableMethods?\n              component = elem2\n              return true\n          )\n        )\n\n        if thangs.length > 1\n          console.warn 'Level has more than 1 programmableMethod Thangs', levelSlug\n          continue\n\n        unless component?\n          console.error 'Level doesn\\'t have programmableMethod Thang', levelSlug\n          continue\n\n        plan = component.config.programmableMethods.plan\n        level.tags = @tagLevel _.find plan.solutions, (s) -> s.language is 'javascript'\n      @data[campaignSlug] = _.sortBy _.values(@loadedLevels[campaignSlug]), 'seqNo'\n\n    console.log @render, @loadedLevels\n    @render()\n\n  tagLevel: (src) ->\n    return [] if not src?.source?\n    try\n      ast = parser(src.source)\n      moreTags = tagger(src)\n    catch e\n      return ['parse error: ' + e.message]\n\n    tags = {}\n    process = (n) ->\n      return unless n?\n      switch n.type\n        when \"Program\", \"BlockStatement\"\n          process(n) for n in n.body\n        when \"FunctionDeclaration\"\n          tags['function-def'] = true\n          if n.params > 0\n            tags['function-params:' + n.params.length] = true\n          process(n.body)\n        when \"ExpressionStatement\"\n          process(n.expression)\n        when \"CallExpression\"\n          process(n.callee)\n        when \"MemberExpression\"\n          if n.object?.name is 'hero'\n            tags[\"hero.\" + n.property.name] = true\n        when \"WhileStatement\"\n          if n.test.type is 'Literal' and n.test.value is true\n            tags['while-true'] = true\n          else\n            tags['while'] = true\n            process(n.test)\n          process(n.body)\n        when \"ForStatement\"\n          tags['for'] = true\n          process(n.init)\n          process(n.test)\n          process(n.update)\n          process(n.body)\n        when \"IfStatement\"\n          tags['if'] = true\n          process(n.test)\n          process(n.consequent)\n          process(n.alternate)\n        when \"Literal\"\n          if n.value is true\n            tags['true'] = true\n          else\n            tags['literal:' + typeof n.value] = true\n        when \"BinaryExpression\",\"LogicalExpression\"\n          process(n.left)\n          process(n.right)\n          tags[n.operator] = true\n        when \"AssignmentExpression\"\n          tags['assign:' + n.operator] = true\n          process(n.right)\n        else\n          tags[n.type] = true\n\n\n\n    process ast\n    \n\n    Object.keys(tags).concat(moreTags)\n    _.map moreTags, (t) -> _.find(conceptList, (e) => e.concept is t)?.name\n"]}