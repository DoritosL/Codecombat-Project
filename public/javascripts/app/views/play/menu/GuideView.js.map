{"version":3,"sources":["app/templates/play/menu/guide-view.jade","app/views/play/menu/GuideView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/FA;AAAA;;ACAA;EAAA;;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,gCAAR;;AACX,UAAU,QAAQ,gBAAR;;AACV,iBAAiB,QAAQ,2BAAR;;AACjB,MAAM,QAAQ,KAAR;;AACN,QAAQ,QAAQ,YAAR;;AAER,MAAM,CAAC,OAAP,GAAuB;;;2BACrB,WAAU;;2BACV,KAAI;;2BACJ,YAAW;;2BACX,kBAAiB;;2BACjB,iBAAgB;;2BAEhB,SACE;IAAA,oCAAoC,gBAApC;;;EAEW,wBAAC,OAAD;;AACX;IAAA,gDAAM,OAAN;IACA,IAAC,UAAD,GAAa,OAAO,CAAC,KAAK,CAAC,GAAd,CAAkB,MAAlB;IACb,IAAC,UAAD,GAAa,OAAO,CAAC,OAAO,CAAC,GAAhB,CAAoB,KAApB;IACb,IAAC,qBAAD,GAAwB,CAAI,EAAE,CAAC,SAAH;IAC5B,IAAC,cAAD,GAAiB,OAAO,CAAC,KAAK,CAAC,MAAd,CAAqB,QAArB,EAA+B,eAA/B;IACjB,IAAC,WAAD,GAAiB,IAAC,cAAJ,GAAuB,EAAvB,6DAAiE;IAC/E,IAAC,sBAAD,GAAyB,IAAC,uBAAD,GAA0B;IAEnD,IAAC,gBAAD,GAAmB,EAAE,CAAC,2BAAH,CAA+B,IAAC,WAAU,CAAC,MAA3C;IACnB,IAA8C,IAAC,WAAU,CAAC,MAAZ,GAAqB,CAArB,IAA2B,CAAI,IAAC,cAA9E;MAAA,IAAC,UAAD,GAAa,IAAC,WAAW,KAAC,gBAAD,EAAzB;;IACA,IAAC,YAAD,GAAe,CAAI,wCAAW,CAAE,cAAZ,IAAoB,IAAC,cAAtB,CAAJ,IAA6C,IAAC;IAE7D,IAAC,UAAD,GAAa,OAAO,CAAC;IACrB,IAAG,MAAM,CAAC,YAAY,CAAC,OAAvB;MACE,IAAC,KAAD,kIAA6D;MAC7D,UAAU,IAAC,KAAI,CAAC,eAAN,IAAyB;MACnC,WAAW,IAAC,KAAI,CAAC,gBAAN,IAA0B;MAErC,WAAW,OAAO,CAAC,UAAU,CAAC,SAAnB,CAA6B,OAA7B;MACX,aAAa;AACb;;QAAA,UAAW,QAAO,CAAC,GAAR,CAAY,UAAZ,EAAX,GAAsC;AAAtC;MACA;;AAAW;aAAA;;uBAAA,UAAW,IAAG,CAAC,QAAJ;AAAX;;;MACX;;AAAW;aAAA;;cAA+C;yBAA/C,OAAO,CAAC;;AAAR;;;MAEX,IAAC,KAAD,GAAQ,QAAQ,CAAC,MAAT,CAAgB,OAAhB;MACR,IAAC,KAAD,GAAQ,CAAC,CAAC,MAAF,CAAS,IAAT,EAAe,EAAf,EAAmB,IAAC,KAApB;MACR,IAAsB,IAAC,UAAD,IAAe,IAAC,KAAK,GAA3C;QAAA,IAAC,KAAD,GAAQ,CAAC,IAAC,KAAK,GAAP,EAAR;;MACA,IAAC,kBAAD;AACA;AAAA;;QAAA,GAAG,CAAC,IAAJ,GAAW,OAAO,KAAK,CAAC,2BAAN,CAAkC,KAAK,CAAC,IAAN,CAAW,GAAX,EAAgB,MAAhB,CAAlC,EAA2D,OAAO,CAAC,OAAO,CAAC,GAAhB,CAAoB,cAApB,CAA3D,CAAP;AAAX;AACA;AAAA;;QAAA,GAAG,CAAC,IAAJ,GAAW,CAAC,CAAC,MAAM,CAAC,OAAT,CAAiB,GAAG,CAAC,IAArB;AAAX;AACA;AAAA;;QAAA,GAAG,CAAC,IAAJ,GAAY,KAAK,CAAC,IAAN,CAAW,GAAX,EAAgB,MAAhB;AAAZ,OAjBF;KAAA;MAmBE,IAAC,KAAD,GAAQ,GAnBV;;EAdW;;2BAmCb,UAAS;AACP;IAAA,IAAG,IAAC,sBAAJ;MACE,IAAG,MAAM,CAAC,gBAAV;QACE,MAAM,CAAC,mBAAP,CAA2B,SAA3B,EAAsC,IAAC,kBAAvC,EAA0D,KAA1D,EADF;OAAA;QAGE,MAAM,CAAC,WAAP,CAAmB,WAAnB,EAAgC,IAAC,kBAAjC,EAAoD,KAApD,EAHF;OADF;;AAKA;AAAA;;MAAA,SAAS,CAAC,OAAV;AAAA;WACA;EAPO;;2BAST,gBAAe;AACb;IAAA,IAAI;IACJ,CAAC,CAAC,IAAF,GAAS,IAAC;IACV,KAA4C,IAAC,cAA7C;MAAA,CAAC,CAAC,SAAF,GAAc,IAAC,WAAU,CAAC,MAAZ,GAAqB,EAAnC;;IACA,CAAC,CAAC,WAAF,GAAgB,IAAC;WACjB;EALa;;2BAOf,cAAa;AACX;IAAA;IACA,KAA2B,IAAC,YAA5B;MAAA,IAAC,iBAAD;;IACA,IAAG,IAAC,KAAI,CAAC,MAAN,GAAe,IAAC,WAAU,CAAC,MAA3B,GAAoC,CAAvC;MACE,IAAG,IAAC,WAAU,CAAC,MAAf;QACE,cAAc,EADhB;OAAA;QAGE,cAAc,CAAC,CAAC,SAAF,CAAY,IAAC,KAAb,EAAmB;UAAA,MAAM,UAAN;SAAnB;QACd,IAAmB,gBAAe,CAAC,CAAnC;UAAA,cAAc,EAAd;SAJF;;MAMA,IAAC,IAAG,CAAC,IAAL,CAAU,sBAAoB,WAApB,GAAgC,GAA1C,CAA6C,CAAC,QAA9C,CAAuD,QAAvD;MACA,IAAC,IAAG,CAAC,IAAL,CAAU,gCAA8B,WAA9B,GAA0C,GAApD,CAAuD,CAAC,QAAxD,CAAiE,QAAjE;MACA,IAAC,IAAG,CAAC,IAAL,CAAU,aAAV,CAAwB,CAAC,KAAzB,CAA+B,IAAC,SAAhC;MACA,IAAC,IAAG,CAAC,QAAL,CAAc,UAAd,EAVF;;IAWA,IAAC,oBAAD;WACA,IAAC,UAAD,CAAW,YAAX;EAfW;;2BAiBb,sBAAqB;AACnB;AAAA;AAAA;;MAAA,SAAS,CAAC,OAAV;AAAA;IACA,IAAC,WAAD,GAAc;IACd,aAAa,IAAC;IACd,eAAe,IAAC,QAAO,CAAC,OAAO,CAAC,GAAjB,CAAqB,cAArB,iDAA2D,CAAE,kBAA7D,IAAyE;WACxF,IAAC,IAAG,CAAC,IAAL,CAAU,KAAV,CAAgB,CAAC,IAAjB,CAAsB;AACpB;MAAA,YAAY,KAAK,CAAC,aAAN,CAAoB,IAApB,EAAuB,YAAvB;aACZ,UAAU,CAAC,IAAX,CAAgB,SAAhB;IAFoB,CAAtB;EALmB;;2BASrB,iBAAgB,SAAC,CAAD;AACd;IAAA,QAAQ,IAAC;IACT,IAAC,cAAD,CAAmB,oBAAnB;iDAEc,CAAE,UAAhB,CAA2B,yBAA3B,EAAsD;MAAA,UAAU,cAAV;MAA0B,OAAO,oBAAjC;MAAuD,OAAO,KAA9D;MAAqE,SAAS,KAA9E;KAAtD;EAJc;;2BAMhB,WAAU,SAAC,CAAD;IACR,IAAC,IAAG,CAAC,IAAL,CAAU,WAAV,CAAsB,CAAC,WAAvB,CAAmC,QAAnC;WACA,IAAC,UAAD,CAAW,kBAAX;EAFQ;;2BAIV,cAAa;IACX;WACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,kBAA1B,EAA8C,EAA9C;EAFW;;2BAIb,WAAU;AACR;IAAA,IAAG,IAAC,sBAAJ;MACE,SAAS,IAAC,EAAD,CAAG,oBAAH,CAAyB;MAClC,MAAM,CAAC,aAAa,CAAC,WAArB,CAAiC,IAAI,CAAC,SAAL,CAAe;QAAA,QAAQ,OAAR;OAAf,CAAjC,EAAkE,GAAlE,EAFF;;;;;cAGe,CAAE,2FAA0C;;;;WAC3D,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,mBAA1B,EAA+C,EAA/C;EALQ;;2BAOV,UAAS;AAEP;;MAAA,IAAC,qDAA6B;;wGACf,CAAE,SAAjB,CAA2B,GAA3B;EAHO;;2BAKT,mBAAkB;AAChB;IAAA,KAAO,IAAC,sBAAR;;YACgB,CAAE,UAAhB,CAA2B,kBAA3B,EAA+C;UAAA,OAAO,IAAC,UAAR;UAAmB,IAAI,IAAC,UAAxB;UAAmC,6CAAiB,CAAE,cAAtD;SAA/C;;aACA,IAAC,sBAAD,GAAyB,KAF3B;;EADgB;;2BAKlB,oBAAmB;AACjB;IAAA,KAAO,IAAC,uBAAR;;YACgB,CAAE,UAAhB,CAA2B,mBAA3B,EAAgD;UAAA,OAAO,IAAC,UAAR;UAAmB,IAAI,IAAC,UAAxB;UAAmC,6CAAiB,CAAE,cAAtD;SAAhD;;aACA,IAAC,uBAAD,GAA0B,KAF5B;;EADiB;;2BAKnB,mBAAkB;AAChB;IAAA,KAAc,IAAC,UAAf;AAAA;;IAGA,MAAM,WAAW,IAAC,UAAS,CAAC,GAAG,CAAC,MAAf,CAAsB,IAAC,UAAS,CAAC,GAAG,CAAC,OAAf,CAAuB,GAAvB,CAAtB;WACjB,IAAC,sBAAD,CAAuB,GAAvB;EALgB;;2BAOlB,wBAAuB,SAAC,YAAD;AAKrB;IAAA,MAAM,QAAQ,CAAC,aAAT,CAAuB,QAAvB;IACN,GAAG,CAAC,EAAJ,GAAS;IACT,GAAG,CAAC,GAAJ,GAAU,eAAe;IACzB,GAAG,CAAC,MAAJ,GAAa,IAAC;IACd,GAAG,CAAC,KAAJ,GAAY,IAAC;IACb,GAAG,CAAC,eAAJ,GAAsB;IACtB,GAAG,CAAC,kBAAJ,GAAyB;IACzB,OAAO,EAAE,GAAF;IACP,IAAI,CAAC,IAAL,CAAU,uBAAV,EAAmC,IAAnC;IACA,IAAC,IAAG,CAAC,IAAL,CAAU,oBAAV,CAA+B,CAAC,WAAhC,CAA4C,IAA5C;IAEA,IAAC,kBAAD,GAAqB;aAAA,SAAC,CAAD;AACnB;QAAA,OAAO,IAAI,CAAC,KAAL,CAAW,CAAC,CAAC,IAAb;QACP,IAAG,IAAI,CAAC,KAAL,KAAc,OAAjB;UAGE,SAAS,EAAE,oBAAF,CAAwB;UACjC,MAAM,CAAC,aAAa,CAAC,WAArB,CAAiC,IAAI,CAAC,SAAL,CAAe;YAAA,QAAQ,kBAAR;YAA4B,OAAO,MAAnC;WAAf,CAAjC,EAA4F,YAA5F;iBACA,MAAM,CAAC,aAAa,CAAC,WAArB,CAAiC,IAAI,CAAC,SAAL,CAAe;YAAA,QAAQ,kBAAR;YAA4B,OAAO,QAAnC;WAAf,CAAjC,EAA8F,YAA9F,EALF;SAAA,MAMK,IAAG,IAAI,CAAC,KAAL,KAAc,MAAjB;gEACH,KAAC,6BADE;SAAA,MAEA,IAAG,IAAI,CAAC,KAAL,KAAc,QAAjB;iEACH,KAAC,8BADE;;MAVc;IAAA;IAcrB,IAAG,MAAM,CAAC,gBAAV;MACE,MAAM,CAAC,gBAAP,CAAwB,SAAxB,EAAmC,IAAC,kBAApC,EAAuD,KAAvD,EADF;KAAA;MAGE,MAAM,CAAC,WAAP,CAAmB,WAAnB,EAAgC,IAAC,kBAAjC,EAAoD,KAApD,EAHF;;WAIA,IAAC,sBAAD,GAAyB;EAlCJ;;2BAoCvB,oBAAmB;AACjB;IAAA,KAAc,WAAU,IAAC,QAAO,CAAC,KAAK,CAAC,cAAzB,CAAd;AAAA;;IACA,KAAwD,IAAC,KAAI,CAAC,MAA9D;MAAA,IAAC,KAAD,GAAQ;QAAC;UAAA,MAAM,OAAN;UAAe,MAAM,EAArB;UAAyB,MAAM,OAA/B;SAAD;QAAR;;AACA;AAAA;SAAA;;kBAAsB,GAAG,CAAC,KAAJ,KAAa,UAAb,aAAyB;qBAC7C,GAAG,CAAC,IAAJ,IAAY,UACJ,OAAO,CAAC,IADJ,GACS,MADT,GAGR,OAAO,CAAC,WAHA,GAGY,MAHZ,GAKR,OAAO,CAAC,QALA,GAKS,KALT,GAKc,OAAO,CAAC,KALtB,GAK4B,mBAL5B,GAOF,OAAO,CAAC,KAPN,CAQT,CAAC,OARQ,CAQA,iBARA,EAQmB,IARnB;;AADd;;EAHiB;;;;GAtKyB","file":"public/javascripts/app/views/play/menu/GuideView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),docs = locals_.docs,showVideo = locals_.showVideo,videoLocked = locals_.videoLocked;if ( docs.length === 1)\n{\nif ( showVideo)\n{\nbuf.push(\"<h3 id=\\\"help-video-heading\\\" data-i18n=\\\"game_menu.guide_video_tutorial\\\"></h3>\");\nif ( videoLocked)\n{\nbuf.push(\"<p data-i18n=\\\"subscribe.unlock_help_videos\\\">Subscribe to unlock all video tutorials.</p><button data-i18n=\\\"subscribe.subscribe_title\\\" class=\\\"start-subscription-button btn btn-lg btn-success\\\">Subscribe</button>\");\n}\nelse\n{\nbuf.push(\"<div id=\\\"help-video-player\\\"></div>\");\n}\n}\nbuf.push(\"<h3 data-i18n=\\\"game_menu.guide_tips\\\"></h3><div>\" + (null == (jade.interp = docs[0].html) ? \"\" : jade.interp) + \"</div>\");\n}\nelse\n{\nbuf.push(\"<ul class=\\\"nav nav-tabs\\\">\");\nif ( showVideo)\n{\nbuf.push(\"<li><a data-target=\\\"#docs_tab_help_video\\\" data-toggle=\\\"tab\\\" data-i18n=\\\"game_menu.guide_video_tutorial\\\"></a></li>\");\n}\n// iterate docs\n;(function(){\n  var $$obj = docs;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var doc = $$obj[$index];\n\nbuf.push(\"<li><a\" + (jade.attrs({ 'data-target':(\"#docs_tab_\" + (doc.slug) + \"\"), 'data-toggle':(\"tab\") }, {\"data-target\":true,\"data-toggle\":true})) + \">\" + (jade.escape((jade.interp = doc.name) == null ? '' : jade.interp)) + \"</a></li>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var doc = $$obj[$index];\n\nbuf.push(\"<li><a\" + (jade.attrs({ 'data-target':(\"#docs_tab_\" + (doc.slug) + \"\"), 'data-toggle':(\"tab\") }, {\"data-target\":true,\"data-toggle\":true})) + \">\" + (jade.escape((jade.interp = doc.name) == null ? '' : jade.interp)) + \"</a></li>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</ul><div class=\\\"tab-content\\\">\");\nif ( showVideo)\n{\nbuf.push(\"<div id=\\\"docs_tab_help_video\\\" class=\\\"tab-pane\\\">\");\nif ( videoLocked)\n{\nbuf.push(\"<p data-i18n=\\\"subscribe.unlock_help_videos\\\">Subscribe to unlock all video tutorials.</p><button data-i18n=\\\"subscribe.subscribe_title\\\" class=\\\"start-subscription-button btn btn-lg btn-success\\\">Subscribe</button>\");\n}\nelse\n{\nbuf.push(\"<div id=\\\"help-video-player\\\"></div>\");\n}\nbuf.push(\"</div>\");\n}\n// iterate docs\n;(function(){\n  var $$obj = docs;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var doc = $$obj[$index];\n\nbuf.push(\"<div\" + (jade.attrs({ 'id':(\"docs_tab_\" + (doc.slug) + \"\"), \"class\": [('tab-pane')] }, {\"id\":true})) + \">\" + (null == (jade.interp = doc.html) ? \"\" : jade.interp) + \"</div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var doc = $$obj[$index];\n\nbuf.push(\"<div\" + (jade.attrs({ 'id':(\"docs_tab_\" + (doc.slug) + \"\"), \"class\": [('tab-pane')] }, {\"id\":true})) + \">\" + (null == (jade.interp = doc.html) ? \"\" : jade.interp) + \"</div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\n};return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\ntemplate = require 'templates/play/menu/guide-view'\nArticle = require 'models/Article'\nSubscribeModal = require 'views/core/SubscribeModal'\nace = require 'ace'\nutils = require 'core/utils'\n\nmodule.exports = class LevelGuideView extends CocoView\n  template: template\n  id: 'guide-view'\n  className: 'tab-pane'\n  helpVideoHeight: '295'\n  helpVideoWidth: '471'\n\n  events:\n    'click .start-subscription-button': 'clickSubscribe'\n\n  constructor: (options) ->\n    super options\n    @levelSlug = options.level.get('slug')\n    @sessionID = options.session.get('_id')\n    @requiresSubscription = not me.isPremium()\n    @isCourseLevel = options.level.isType('course', 'course-ladder')\n    @helpVideos = if @isCourseLevel then [] else options.level.get('helpVideos') ? []\n    @trackedHelpVideoStart = @trackedHelpVideoFinish = false\n    # A/B Testing video tutorial styles\n    @helpVideosIndex = me.getVideoTutorialStylesIndex(@helpVideos.length)\n    @helpVideo = @helpVideos[@helpVideosIndex] if @helpVideos.length > 0 and not @isCourseLevel\n    @videoLocked = not (@helpVideo?.free or @isCourseLevel) and @requiresSubscription\n\n    @firstOnly = options.firstOnly\n    if window.serverConfig.picoCTF\n      @docs = options?.docs ? options.level.get('documentation') ? {}\n      general = @docs.generalArticles or []\n      specific = @docs.specificArticles or []\n\n      articles = options.supermodel.getModels(Article)\n      articleMap = {}\n      articleMap[article.get('original')] = article for article in articles\n      general = (articleMap[ref.original] for ref in general)\n      general = (article.attributes for article in general when article)\n\n      @docs = specific.concat(general)\n      @docs = $.extend(true, [], @docs)\n      @docs = [@docs[0]] if @firstOnly and @docs[0]\n      @addPicoCTFProblem() \n      doc.html = marked(utils.filterMarkdownCodeLanguages(utils.i18n(doc, 'body'), options.session.get('codeLanguage'))) for doc in @docs\n      doc.slug = _.string.slugify(doc.name) for doc in @docs\n      doc.name = (utils.i18n doc, 'name') for doc in @docs\n    else\n      @docs = []\n\n  destroy: ->\n    if @vimeoListenerAttached\n      if window.addEventListener\n        window.removeEventListener('message', @onMessageReceived, false)\n      else\n        window.detachEvent('onmessage', @onMessageReceived, false)\n    oldEditor.destroy() for oldEditor in @aceEditors ? []\n    super()\n\n  getRenderData: ->\n    c = super()\n    c.docs = @docs\n    c.showVideo = @helpVideos.length > 0 unless @isCourseLevel\n    c.videoLocked = @videoLocked\n    c\n\n  afterRender: ->\n    super()\n    @setupVideoPlayer() unless @videoLocked\n    if @docs.length + @helpVideos.length > 1\n      if @helpVideos.length\n        startingTab = 0\n      else\n        startingTab = _.findIndex @docs, slug: 'overview'\n        startingTab = 0 if startingTab is -1\n      # incredible hackiness. Getting bootstrap tabs to work shouldn't be this complex\n      @$el.find(\".nav-tabs li:nth(#{startingTab})\").addClass('active')\n      @$el.find(\".tab-content .tab-pane:nth(#{startingTab})\").addClass('active')\n      @$el.find('.nav-tabs a').click(@clickTab)\n      @$el.addClass 'has-tabs'\n    @configureACEEditors()\n    @playSound 'guide-open'\n\n  configureACEEditors: ->\n    oldEditor.destroy() for oldEditor in @aceEditors ? []\n    @aceEditors = []\n    aceEditors = @aceEditors\n    codeLanguage = @options.session.get('codeLanguage') or me.get('aceConfig')?.language or 'python'\n    @$el.find('pre').each ->\n      aceEditor = utils.initializeACE @, codeLanguage\n      aceEditors.push aceEditor\n\n  clickSubscribe: (e) ->\n    level = @levelSlug # Save ref to level slug\n    @openModalView new SubscribeModal()\n    # TODO: Added levelID on 2/9/16. Remove level property and associated AnalyticsLogEvent 'properties.level' index later.\n    window.tracker?.trackEvent 'Show subscription modal', category: 'Subscription', label: 'help video clicked', level: level, levelID: level\n\n  clickTab: (e) =>\n    @$el.find('li.active').removeClass('active')\n    @playSound 'guide-tab-switch'\n\n  afterInsert: ->\n    super()\n    Backbone.Mediator.publish 'level:docs-shown', {}\n\n  onHidden: ->\n    if @vimeoListenerAttached\n      player = @$('#help-video-player')[0]\n      player.contentWindow.postMessage JSON.stringify(method: 'pause'), '*'\n    createjs?.Sound?.setVolume?(@volume ? ( me.get('volume') ? 1.0))\n    Backbone.Mediator.publish 'level:docs-hidden', {}\n\n  onShown: ->\n    # TODO: Disable sound only when video is playing?\n    @volume ?= me.get('volume') ? 1.0\n    createjs?.Sound?.setVolume(0.0)\n\n  onStartHelpVideo: ->\n    unless @trackedHelpVideoStart\n      window.tracker?.trackEvent 'Start help video', level: @levelSlug, ls: @sessionID, style: @helpVideo?.style\n      @trackedHelpVideoStart = true\n\n  onFinishHelpVideo: ->\n    unless @trackedHelpVideoFinish\n      window.tracker?.trackEvent 'Finish help video', level: @levelSlug, ls: @sessionID, style: @helpVideo?.style\n      @trackedHelpVideoFinish = true\n\n  setupVideoPlayer: () ->\n    return unless @helpVideo\n    # Always use HTTPS\n    # TODO: Not specifying the protocol should work based on Vimeo docs, but breaks postMessage/eventing in practice.\n    url = \"https:\" + @helpVideo.url.substr @helpVideo.url.indexOf '/'\n    @setupVimeoVideoPlayer url\n\n  setupVimeoVideoPlayer: (helpVideoURL) ->\n    # Setup Vimeo player\n    # https://developer.vimeo.com/player/js-api#universal-with-postmessage\n\n    # Create Vimeo iframe player\n    tag = document.createElement('iframe')\n    tag.id = 'help-video-player'\n    tag.src = helpVideoURL + \"?api=1&badge=0&byline=0&portrait=0&title=0\"\n    tag.height = @helpVideoHeight\n    tag.width = @helpVideoWidth\n    tag.allowFullscreen = true\n    tag.mozAllowFullscreen = true\n    $tag = $(tag)\n    $tag.attr('webkitallowfullscreen', true) # strong arm Safari into working\n    @$el.find('#help-video-player').replaceWith($tag)\n\n    @onMessageReceived = (e) =>\n      data = JSON.parse(e.data)\n      if data.event is 'ready'\n        # Vimeo player is ready, can now hook up other events\n        # https://developer.vimeo.com/player/js-api#events\n        player = $('#help-video-player')[0]\n        player.contentWindow.postMessage JSON.stringify(method: 'addEventListener', value: 'play'), helpVideoURL\n        player.contentWindow.postMessage JSON.stringify(method: 'addEventListener', value: 'finish'), helpVideoURL\n      else if data.event is 'play'\n        @onStartHelpVideo?()\n      else if data.event is 'finish'\n        @onFinishHelpVideo?()\n\n    # Listen for Vimeo player 'ready'\n    if window.addEventListener\n      window.addEventListener('message', @onMessageReceived, false)\n    else\n      window.attachEvent('onmessage', @onMessageReceived, false)\n    @vimeoListenerAttached = true\n\n  addPicoCTFProblem: ->\n    return unless problem = @options.level.picoCTFProblem\n    @docs = [name: 'Intro', body: '', slug: 'intro'] unless @docs.length\n    for doc in @docs when doc.name in ['Overview', 'Intro']\n      doc.body += \"\"\"\n        ### #{problem.name}\n\n        #{problem.description}\n\n        #{problem.category} - #{problem.score} points\n\n        Hint: #{problem.hints}\n      \"\"\".replace /<p>(.*?)<\\/p>/gi, '$1'\n"]}