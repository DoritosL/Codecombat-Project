{"version":3,"sources":["app/templates/play/level/tome/spell-palette-view.jade","app/views/play/level/tome/SpellPaletteView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/SpellPaletteView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),_ = locals_._,view = locals_.view,tabs = locals_.tabs,isIE = locals_.isIE;var header_mixin = function(label, name){\nvar block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};\nbuf.push(\"<a\" + (jade.attrs({ 'role':(\"button\"), 'id':(\"#palette-header-\" + _.string.slugify(label)), 'data-panel':(\"#palette-tab-\" + _.string.slugify(label)), \"class\": [('section-header'),('btn'),('btn-small'),('btn-illustrated'),('btn-warning')] }, {\"role\":true,\"id\":true,\"data-panel\":true})) + \">\" + (jade.escape((jade.interp = name) == null ? '' : jade.interp)) + \"\");\nif ( label == 'api-area')\n{\nbuf.push(\"<div style=\\\"float: right\\\" class=\\\"glyphicon glyphicon-chevron-down\\\"></div>\");\n}\nelse\n{\nbuf.push(\"<div style=\\\"float: right\\\" class=\\\"glyphicon glyphicon-chevron-right\\\"></div>\");\n}\nbuf.push(\"</a>\");\n};\nbuf.push(\"<div class=\\\"container\\\"><div class=\\\"left nano\\\"><div id=\\\"spell-palette-api-bar\\\" class=\\\"nano-content panel-group\\\">\");\nif ( view.level.get('type') == 'web-dev')\n{\nheader_mixin('api-area', 'HTML');\n}\nelse\n{\nheader_mixin('api-area', 'Methods');\n}\nbuf.push(\"<div id=\\\"palette-tab-api-area\\\" class=\\\"apis panel-collapse collapse in\\\"><div class=\\\"properties properties-this\\\"></div></div>\");\nif ( tabs)\n{\n// iterate tabs\n;(function(){\n  var $$obj = tabs;\n  if ('number' == typeof $$obj.length) {\n\n    for (var tab = 0, $$l = $$obj.length; tab < $$l; tab++) {\n      var entries = $$obj[tab];\n\nheader_mixin(tab, tab);\nbuf.push(\"<div\" + (jade.attrs({ 'id':(\"palette-tab-\" + _.string.slugify(tab)), \"class\": [('panel-collapse'),('collapse')] }, {\"id\":true})) + \"><div\" + (jade.attrs({ \"class\": [(\"properties properties-\" + _.string.slugify(tab))] }, {\"class\":true})) + \"></div></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var tab in $$obj) {\n      $$l++;      var entries = $$obj[tab];\n\nheader_mixin(tab, tab);\nbuf.push(\"<div\" + (jade.attrs({ 'id':(\"palette-tab-\" + _.string.slugify(tab)), \"class\": [('panel-collapse'),('collapse')] }, {\"id\":true})) + \"><div\" + (jade.attrs({ \"class\": [(\"properties properties-\" + _.string.slugify(tab))] }, {\"class\":true})) + \"></div></div>\");\n    }\n\n  }\n}).call(this);\n\n}\nheader_mixin('events', 'Events');\nbuf.push(\"<div id=\\\"palette-tab-events\\\" class=\\\"apis panel-collapse collapse\\\"></div>\");\nheader_mixin('stuff-area', 'Spawnable');\nbuf.push(\"<div id=\\\"palette-tab-stuff-area\\\" class=\\\"apis panel-collapse collapse\\\"></div></div></div><div class=\\\"right\\\"><div class=\\\"closeBtn btn btn-illustrated btn-danger\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></div>\");\nif ( isIE)\n{\nbuf.push(\"<div class=\\\"scrollArea always-scroll-y\\\"><div class=\\\"scrollableArea\\\"><div class=\\\"rightContentTarget content\\\"></div></div></div>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"scrollArea\\\"><div class=\\\"scrollableArea\\\"><div class=\\\"rightContentTarget content\\\"></div></div></div>\");\n}\nbuf.push(\"</div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\n{me} = require 'core/auth'\nfilters = require 'lib/image_filter'\nSpellPaletteEntryView = require './SpellPaletteEntryView'\nSpellPaletteThangEntryView = require './SpellPaletteThangEntryView'\nLevelComponent = require 'models/LevelComponent'\nThangType = require 'models/ThangType'\nGameMenuModal = require 'views/play/menu/GameMenuModal'\nLevelSetupManager = require 'lib/LevelSetupManager'\nace = require 'ace'\nutils = require 'core/utils'\n\nN_ROWS = 4\n\nmodule.exports = class SpellPaletteView extends CocoView\n  id: 'spell-palette-view'\n  template: require 'templates/play/level/tome/spell-palette-view'\n  controlsEnabled: true\n\n  subscriptions:\n    'level:disable-controls': 'onDisableControls'\n    'level:enable-controls': 'onEnableControls'\n    'surface:frame-changed': 'onFrameChanged'\n    'tome:change-language': 'onTomeChangedLanguage'\n    'tome:palette-clicked': 'onPalleteClick'\n    'surface:stage-mouse-down': 'hide'\n    'level:set-playing': 'hide'\n    \n\n  events:\n    'click #spell-palette-help-button': 'onClickHelp'\n    'click .closeBtn': 'onClickClose'\n    'click .section-header': 'onSectionHeaderClick'\n\n  initialize: (options) ->\n    {@level, @session, @thang, @useHero} = options\n    @aceEditors = []\n    docs = @options.level.get('documentation') ? {}\n    @showsHelp = docs.specificArticles?.length or docs.generalArticles?.length\n    @createPalette()\n    $(window).on 'resize', @onResize\n    console.log \"My thang is\", @thang\n\n  getRenderData: ->\n    c = super()\n    c.entryGroups = @entryGroups\n    c.entryGroupSlugs = @entryGroupSlugs\n    c.entryGroupNames = @entryGroupNames\n    c.tabbed = _.size(@entryGroups) > 1\n    c.defaultGroupSlug = @defaultGroupSlug\n    c.showsHelp = @showsHelp\n    c.tabs = @tabs  # For hero-based, non-this-owned tabs like Vector, Math, etc.\n    c.thisName = {coffeescript: '@', lua: 'self', python: 'self', java: 'hero'}[@options.language] or 'this'\n    c._ = _\n    c\n\n  afterRender: ->\n    super()\n    if @entryGroupSlugs\n      for group, entries of @entryGroups\n        groupSlug = @entryGroupSlugs[group]\n        for columnNumber, entryColumn of entries\n          col = $('<div class=\"property-entry-column\"></div>').appendTo @$el.find(\".properties-#{groupSlug}\")\n          for entry in entryColumn\n            col.append entry.el\n            entry.render()  # Render after appending so that we can access parent container for popover\n      @$('.nano').nanoScroller alwaysVisible: true\n      @updateCodeLanguage @options.language\n    else\n      @entryGroupElements = {}\n      for group, entries of @entryGroups\n        @entryGroupElements[group] = itemGroup = $('<div class=\"property-entry-item-group\"></div>').appendTo @$el.find('.properties-this')\n        if entries[0].options.item?.getPortraitURL\n          itemImage = $('<img class=\"item-image\" draggable=false></img>').attr('src', entries[0].options.item.getPortraitURL())\n          itemGroup.append itemImage\n          firstEntry = entries[0]\n          do (firstEntry) ->\n            itemImage.on \"mouseenter\", (e) -> firstEntry.onMouseEnter e\n            itemImage.on \"mouseleave\", (e) -> firstEntry.onMouseLeave e\n        for entry, entryIndex in entries\n          itemGroup.append entry.el\n          entry.render()  # Render after appending so that we can access parent container for popover\n          if entries.length is 1\n            entry.$el.addClass 'single-entry'\n          if entryIndex is 0\n            entry.$el.addClass 'first-entry'\n      for tab, entries of @tabs or {}\n        tabSlug = _.string.slugify tab\n        itemsInGroup = 0\n        for entry, entryIndex in entries\n          if itemsInGroup is 0 or (itemsInGroup is 2 and entryIndex isnt entries.length - 1)\n            itemGroup = $('<div class=\"property-entry-item-group\"></div>').appendTo @$el.find(\".properties-#{tabSlug}\")\n            itemsInGroup = 0\n          ++itemsInGroup\n          itemGroup.append entry.el\n          entry.render()  # Render after appending so that we can access parent container for popover\n          if itemsInGroup is 0\n            entry.$el.addClass 'first-entry'\n      @$el.addClass 'hero'\n      @$el.toggleClass 'shortenize', Boolean @shortenize\n      @$el.toggleClass 'web-dev', @options.level.isType('web-dev')\n\n    tts = @supermodel.getModels ThangType\n    console.log @deferredDocs\n\n    for dn of @deferredDocs\n      doc = @deferredDocs[dn]\n      if doc.type is \"spawnable\"\n        thangName = doc.name\n        if @thang.spawnAliases[thangName]\n          thangName = @thang.spawnAliases[thangName][0]\n\n        info = @thang.buildables[thangName]\n        tt = _.find tts, (t) -> t.get('original') is info?.thangType\n        continue unless tt?\n        t = new SpellPaletteThangEntryView doc: doc, thang: tt, buildable: info, buildableName: doc.name, shortenize: true, language: @options.language, level: @options.level, useHero: @useHero\n        @$el.find(\"#palette-tab-stuff-area\").append t.el\n        t.render()\n\n      if doc.type is \"event\"\n        t = new SpellPaletteEntryView doc: doc, thang: @thang, shortenize: true, language: @options.language, level: @options.level, useHero: @useHero\n        @$el.find(\"#palette-tab-events\").append t.el\n        t.render()\n\n\n    @$(\".section-header:has(+.collapse:empty)\").hide()\n\n  afterInsert: ->\n    super()\n    _.delay => @$el?.css('bottom', 0) unless $('#spell-view').is('.shown')\n\n  updateCodeLanguage: (language) ->\n    @options.language = language\n\n  onResize: (e) =>\n    @updateMaxHeight?()\n\n  createPalette: ->\n    Backbone.Mediator.publish 'tome:palette-cleared', {thangID: @thang.id}\n    lcs = @supermodel.getModels LevelComponent\n\n    allDocs = {}\n    excludedDocs = {}\n    for lc in lcs\n      for doc in (lc.get('propertyDocumentation') ? [])\n        if doc.codeLanguages and not (@options.language in doc.codeLanguages)\n          excludedDocs['__' + doc.name] = doc\n          continue\n        allDocs['__' + doc.name] ?= []\n        allDocs['__' + doc.name].push doc\n        if doc.type is 'snippet' then doc.owner = 'snippets'\n\n    if @options.programmable\n      propStorage =\n        'this': 'programmableProperties'\n        more: 'moreProgrammableProperties'\n        Math: 'programmableMathProperties'\n        Array: 'programmableArrayProperties'\n        Object: 'programmableObjectProperties'\n        String: 'programmableStringProperties'\n        Global: 'programmableGlobalProperties'\n        Function: 'programmableFunctionProperties'\n        RegExp: 'programmableRegExpProperties'\n        Date: 'programmableDateProperties'\n        Number: 'programmableNumberProperties'\n        JSON: 'programmableJSONProperties'\n        LoDash: 'programmableLoDashProperties'\n        Vector: 'programmableVectorProperties'\n        HTML: 'programmableHTMLProperties'\n        WebJavaScript: 'programmableWebJavaScriptProperties'\n        jQuery: 'programmableJQueryProperties'\n        CSS: 'programmableCSSProperties'\n        snippets: 'programmableSnippets'\n    else\n      propStorage =\n        'this': ['apiProperties', 'apiMethods']\n    if not @options.level.isType('hero', 'hero-ladder', 'hero-coop', 'course', 'course-ladder', 'game-dev', 'web-dev') or not @options.programmable\n      @organizePalette propStorage, allDocs, excludedDocs\n    else\n      @organizePaletteHero propStorage, allDocs, excludedDocs\n\n  organizePalette: (propStorage, allDocs, excludedDocs) ->\n    count = 0\n    propGroups = {}\n    for owner, storages of propStorage\n      storages = [storages] if _.isString storages\n      for storage in storages\n        props = _.reject @thang[storage] ? [], (prop) -> prop[0] is '_'  # no private properties\n        props = _.uniq props\n        added = _.sortBy(props).slice()\n        propGroups[owner] = (propGroups[owner] ? []).concat added\n        count += added.length\n    Backbone.Mediator.publish 'tome:update-snippets', propGroups: propGroups, allDocs: allDocs, language: @options.language\n\n    @shortenize = count > 6\n    tabbify = count >= 10\n    @entries = []\n    for owner, props of propGroups\n      for prop in props\n        doc = _.find (allDocs['__' + prop] ? []), (doc) ->\n          return true if doc.owner is owner\n          return (owner is 'this' or owner is 'more') and (not doc.owner? or doc.owner is 'this')\n        if not doc and not excludedDocs['__' + prop]\n          console.log 'could not find doc for', prop, 'from', allDocs['__' + prop], 'for', owner, 'of', propGroups\n          doc ?= prop\n        if doc\n          @entries.push @addEntry(doc, @shortenize, owner is 'snippets')\n    groupForEntry = (entry) ->\n      return 'more' if entry.doc.owner is 'this' and entry.doc.name in (propGroups.more ? [])\n      entry.doc.owner\n    @entries = _.sortBy @entries, (entry) ->\n      order = ['this', 'more', 'Math', 'Vector', 'String', 'Object', 'Array', 'Function', 'HTML', 'CSS', 'WebJavaScript', 'jQuery', 'snippets']\n      index = order.indexOf groupForEntry entry\n      index = String.fromCharCode if index is -1 then order.length else index\n      index += entry.doc.name\n    if tabbify and _.find @entries, ((entry) -> entry.doc.owner isnt 'this')\n      @entryGroups = _.groupBy @entries, groupForEntry\n    else\n      i18nKey = if @options.level.isType('hero', 'hero-ladder', 'hero-coop', 'course', 'course-ladder', 'game-dev', 'web-dev') then 'play_level.tome_your_skills' else 'play_level.tome_available_spells'\n      defaultGroup = $.i18n.t i18nKey\n      @entryGroups = {}\n      @entryGroups[defaultGroup] = @entries\n      @defaultGroupSlug = _.string.slugify defaultGroup\n    @entryGroupSlugs = {}\n    @entryGroupNames = {}\n    for group, entries of @entryGroups\n      @entryGroups[group] = _.groupBy entries, (entry, i) -> Math.floor i / N_ROWS\n      @entryGroupSlugs[group] = _.string.slugify group\n      @entryGroupNames[group] = group\n    if thisName = {coffeescript: '@', lua: 'self', python: 'self'}[@options.language]\n      if @entryGroupNames.this\n        @entryGroupNames.this = thisName\n\n  organizePaletteHero: (propStorage, allDocs, excludedDocs) ->\n    # Assign any kind of programmable properties to the items that grant them.\n    @isHero = true\n    itemThangTypes = {}\n    itemThangTypes[tt.get('name')] = tt for tt in @supermodel.getModels ThangType  # Also heroes\n    propsByItem = {}\n    propCount = 0\n    itemsByProp = {}\n    @deferredDocs = {}\n    # Make sure that we get the spellbook first, then the primary hand, then anything else.\n    slots = _.sortBy _.keys(@thang.inventoryThangTypeNames ? {}), (slot) ->\n      if slot is 'left-hand' then 0 else if slot is 'right-hand' then 1 else 2\n    for slot in slots\n      thangTypeName = @thang.inventoryThangTypeNames[slot]\n      if item = itemThangTypes[thangTypeName]\n        unless item.get('components')\n          console.error 'Item', item, 'did not have any components when we went to assemble docs.'\n        for component in item.get('components') ? [] when component.config\n          for owner, storages of propStorage\n            if props = component.config[storages]\n              for prop in _.sortBy(props) when prop[0] isnt '_' and not itemsByProp[prop]  # no private properties\n                continue if prop is 'moveXY' and @options.level.get('slug') is 'slalom'  # Hide for Slalom\n                propsByItem[item.get('name')] ?= []\n                propsByItem[item.get('name')].push owner: owner, prop: prop, item: item\n                itemsByProp[prop] = item\n                ++propCount\n      else\n        console.log @thang.id, \"couldn't find item ThangType for\", slot, thangTypeName\n\n    # Get any Math-, Vector-, etc.-owned properties into their own tabs\n    for owner, storage of propStorage when not (owner in ['this', 'more', 'snippets', 'HTML', 'CSS', 'WebJavaScript', 'jQuery'])\n      continue unless @thang[storage]?.length\n      @tabs ?= {}\n      @tabs[owner] = []\n      programmaticonName = @thang.inventoryThangTypeNames['programming-book']\n      programmaticon = itemThangTypes[programmaticonName]\n      sortedProps = @thang[storage].slice().sort()\n      for prop in sortedProps\n        if doc = _.find (allDocs['__' + prop] ? []), {owner: owner}  # Not all languages have all props\n          entry = @addEntry doc, false, false, programmaticon\n          @tabs[owner].push entry\n\n    # Assign any unassigned properties to the hero itself.\n    for owner, storage of propStorage\n      continue unless owner in ['this', 'more', 'snippets', 'HTML', 'CSS', 'WebJavaScript', 'jQuery']\n      for prop in _.reject(@thang[storage] ? [], (prop) -> itemsByProp[prop] or prop[0] is '_')  # no private properties\n        continue if prop is 'say' and @options.level.get 'hidesSay'  # Hide for Dungeon Campaign\n        continue if prop is 'moveXY' and @options.level.get('slug') is 'slalom'  # Hide for Slalom\n        propsByItem['Hero'] ?= []\n        propsByItem['Hero'].push owner: owner, prop: prop, item: itemThangTypes[@thang.spriteName]\n        ++propCount\n\n    Backbone.Mediator.publish 'tome:update-snippets', propGroups: propsByItem, allDocs: allDocs, language: @options.language\n\n    @shortenize = propCount > 6\n    @entries = []\n    for itemName, props of propsByItem\n      for prop, propIndex in props\n        item = prop.item\n        owner = prop.owner\n        prop = prop.prop\n        doc = _.find (allDocs['__' + prop] ? []), (doc) ->\n          return true if doc.owner is owner\n          return (owner is 'this' or owner is 'more') and (not doc.owner? or doc.owner is 'this')\n        if not doc and not excludedDocs['__' + prop]\n          console.log 'could not find doc for', prop, 'from', allDocs['__' + prop], 'for', owner, 'of', propsByItem, 'with item', item\n          doc ?= prop\n        if doc\n          if doc.type in ['spawnable', 'event']\n            @deferredDocs[doc.name] = doc\n          else\n            @entries.push @addEntry(doc, @shortenize, owner is 'snippets', item, propIndex > 0)\n    if @options.level.isType('web-dev')\n      @entryGroups = _.groupBy @entries, (entry) -> entry.doc.type\n    else\n      @entryGroups = _.groupBy @entries, (entry) -> itemsByProp[entry.doc.name]?.get('name') ? 'Hero'\n    iOSEntryGroups = {}\n    for group, entries of @entryGroups\n      iOSEntryGroups[group] =\n        item: {name: group, imageURL: itemThangTypes[group]?.getPortraitURL()}\n        props: (entry.doc for entry in entries)\n    Backbone.Mediator.publish 'tome:palette-updated', thangID: @thang.id, entryGroups: JSON.stringify(iOSEntryGroups)\n\n  addEntry: (doc, shortenize, isSnippet=false, item=null, showImage=false) ->\n    writable = (if _.isString(doc) then doc else doc.name) in (@thang.apiUserProperties ? [])\n    new SpellPaletteEntryView doc: doc, thang: @thang, shortenize: shortenize, isSnippet: isSnippet, language: @options.language, writable: writable, level: @options.level, item: item, showImage: showImage, useHero: @useHero\n\n  onDisableControls: (e) -> @toggleControls e, false\n  onEnableControls: (e) -> @toggleControls e, true\n  toggleControls: (e, enabled) ->\n    return if e.controls and not ('palette' in e.controls)\n    return if enabled is @controlsEnabled\n    @controlsEnabled = enabled\n    @$el.find('*').attr('disabled', not enabled)\n    @$el.toggleClass 'controls-disabled', not enabled\n\n  onFrameChanged: (e) ->\n    return unless e.selectedThang?.id is @thang.id\n    @options.thang = @thang = e.selectedThang  # Update our thang to the current version\n\n  onTomeChangedLanguage: (e) ->\n    @updateCodeLanguage e.language\n    entry.destroy() for entry in @entries\n    @createPalette()\n    @render()\n\n  onSectionHeaderClick: (e) ->\n\n    $et = @$(e.target)\n    target = @$($et.attr('data-panel'))\n    isCollapsed = !target.hasClass('in')\n    console.log \"O\", target[0], isCollapsed\n    if isCollapsed\n      target.collapse 'show'\n      $et.find('.glyphicon').removeClass('glyphicon-chevron-right').addClass('glyphicon-chevron-down')\n    else\n      target.collapse 'hide'\n      $et.find('.glyphicon').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-right')\n\n    setTimeout () =>\n      @$('.nano').nanoScroller alwaysVisible: true\n    , 200\n    e.preventDefault()\n\n  onClickHelp: (e) ->\n    application.tracker?.trackEvent 'Spell palette help clicked', levelID: @level.get('slug')\n    gameMenuModal = new GameMenuModal showTab: 'guide', level: @level, session: @session, supermodel: @supermodel\n    @openModalView gameMenuModal\n    @listenToOnce gameMenuModal, 'change-hero', ->\n      @setupManager?.destroy()\n      @setupManager = new LevelSetupManager({supermodel: @supermodel, level: @level, levelID: @level.get('slug'), parent: @, session: @session, courseID: @options.courseID, courseInstanceID: @options.courseInstanceID})\n      @setupManager.open()\n\n  onClickClose: (e) ->\n    @hide()\n\n  hide: () =>\n    @$el.find('.left .selected').removeClass 'selected'\n    @$el.removeClass('open')\n\n  onPalleteClick: (e) ->\n    @$el.addClass('open')\n    content = @$el.find(\".rightContentTarget\")\n    content.html(e.entry.doc.initialHTML)\n    codeLanguage = e.entry.options.language\n    oldEditor.destroy() for oldEditor in @aceEditors\n    @aceEditors = []\n    aceEditors = @aceEditors\n    # Initialize Ace for each popover code snippet that still needs it\n    content.find('.docs-ace').each ->\n      aceEditor = utils.initializeACE @, codeLanguage\n      aceEditors.push aceEditor\n\n  destroy: ->\n    entry.destroy() for entry in @entries\n    @toggleBackground = null\n    $(window).off 'resize', @onResize\n    @setupManager?.destroy()\n    super()\n"]}