{"version":3,"sources":["app/views/play/level/tome/DocFormatter.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/DocFormatter.js","sourcesContent":["popoverTemplate = require 'templates/play/level/tome/spell_palette_entry_popover'\n{downTheChain} = require 'lib/world/world_utils'\nwindow.Vector = require 'lib/world/vector'  # So we can document it\nutils = require 'core/utils'\n\nsafeJSONStringify = (input, maxDepth) ->\n  recursion = (input, path, depth) ->\n    output = {}\n    pPath = undefined\n    refIdx = undefined\n    path = path or ''\n    depth = depth or 0\n    depth++\n    return '{depth over ' + maxDepth + '}' if maxDepth and depth > maxDepth\n    for p of input\n      pPath = ((if path then (path + '.') else '')) + p\n      if typeof input[p] is 'function'\n        output[p] = '{function}'\n      else if typeof input[p] is 'object'\n        refIdx = refs.indexOf(input[p])\n        if -1 isnt refIdx\n          output[p] = '{reference to ' + refsPaths[refIdx] + '}'\n        else\n          refs.push input[p]\n          refsPaths.push pPath\n          output[p] = recursion(input[p], pPath, depth)\n      else\n        output[p] = input[p]\n    output\n  refs = []\n  refsPaths = []\n  maxDepth = maxDepth or 5\n  if typeof input is 'object'\n    output = recursion(input)\n  else\n    output = input\n  JSON.stringify output, null, 1\n\nmodule.exports = class DocFormatter\n  constructor: (@options) ->\n    @doc = _.cloneDeep @options.doc\n    @fillOutDoc()\n\n  fillOutDoc: ->\n    # TODO: figure out better ways to format html/css/scripting docs for web-dev levels\n    if _.isString @doc\n      @doc = name: @doc, type: typeof @options.thang[@doc]\n    if @options.isSnippet\n      @doc.type = 'snippet'\n      @doc.owner = 'snippets'\n      @doc.shortName = @doc.shorterName = @doc.title = @doc.name\n    else if @doc.owner in ['HTML', 'CSS', 'WebJavaScript', 'jQuery']\n      @doc.shortName = @doc.shorterName = @doc.title = @doc.name\n    else\n      @doc.owner ?= 'this'\n      ownerName = @doc.ownerName = if @doc.owner isnt 'this' then @doc.owner else switch @options.language\n        when 'python', 'lua' then (if @options.useHero then 'hero' else 'self')\n        when 'java' then 'hero'\n        when 'coffeescript' then '@'\n        else (if @options.useHero then 'hero' else 'this')\n      ownerName = 'game' if @options.level.isType('game-dev')\n      if @doc.type is 'function'\n        [docName, args] = @getDocNameAndArguments()\n        argNames = args.join ', '\n        argString = if argNames then '__ARGS__' else ''\n        @doc.shortName = switch @options.language\n          when 'coffeescript' then \"#{ownerName}#{if ownerName is '@' then '' else '.'}#{docName}#{if argString then ' ' + argString else '()'}\"\n          when 'python' then \"#{ownerName}.#{docName}(#{argString})\"\n          when 'lua' then \"#{ownerName}:#{docName}(#{argString})\"\n          else \"#{ownerName}.#{docName}(#{argString});\"\n      else\n        @doc.shortName = switch @options.language\n          when 'coffeescript' then \"#{ownerName}#{if ownerName is '@' then '' else '.'}#{@doc.name}\"\n          when 'python' then \"#{ownerName}.#{@doc.name}\"\n          when 'lua' then \"#{ownerName}.#{@doc.name}\"\n          else \"#{ownerName}.#{@doc.name};\"\n      @doc.shorterName = @doc.shortName\n      if @doc.type is 'function' and argString\n        @doc.shortName = @doc.shorterName.replace argString, argNames\n        @doc.shorterName = @doc.shorterName.replace argString, (if not /cast[A-Z]/.test(@doc.name) and argNames.length > 6 then '...' else argNames)\n      if @doc.type is 'event'\n        @doc.shortName = @doc.name\n        @doc.shorterName = @doc.name\n      if @options.language is 'javascript'\n        @doc.shorterName = @doc.shortName.replace ';', ''\n        if @doc.owner is 'this' or @options.tabbify or ownerName is 'game'\n          @doc.shorterName = @doc.shorterName.replace /^(this|hero)\\./, ''\n      else if (@options.language in ['python', 'lua']) and (@doc.owner is 'this' or @options.tabbify or ownerName is 'game')\n        @doc.shorterName = @doc.shortName.replace /^(self|hero|game)[:.]/, ''\n      @doc.title = if @options.shortenize then @doc.shorterName else @doc.shortName\n      translatedName = utils.i18n(@doc, 'name')\n      if translatedName isnt @doc.name\n        @doc.translatedShortName = @doc.shortName.replace(@doc.name, translatedName)\n\n\n    # Grab the language-specific documentation for some sub-properties, if we have it.\n    toTranslate = [{obj: @doc, prop: 'description'}, {obj: @doc, prop: 'example'}]\n    for arg in (@doc.args ? [])\n      toTranslate.push {obj: arg, prop: 'example'}, {obj: arg, prop: 'description'}\n    if @doc.returns\n      toTranslate.push {obj: @doc.returns, prop: 'example'}, {obj: @doc.returns, prop: 'description'}\n    for {obj, prop} in toTranslate\n      # Translate into chosen code language.\n      if val = obj[prop]?[@options.language]\n        obj[prop] = val\n      else unless _.isString obj[prop]\n        obj[prop] = null\n\n      # Translate into chosen spoken language.\n      if val = originalVal = obj[prop]\n        context = @doc.context\n        obj[prop] = val = utils.i18n obj, prop\n        # For multiplexed-by-both-code-and-spoken-language objects, now also get code language again.\n        if _.isObject(val)\n          if valByCodeLanguage = obj[prop]?[@options.language]\n            obj[prop] = val = valByCodeLanguage\n          else\n            obj[prop] = originalVal  # Never mind, we don't have that code language for that spoken language.\n        if @doc.i18n\n          spokenLanguage = me.get 'preferredLanguage'\n          while spokenLanguage\n            spokenLanguage = spokenLanguage.substr 0, spokenLanguage.lastIndexOf('-') if fallingBack?\n            if spokenLanguageContext = @doc.i18n[spokenLanguage]?.context\n              context = _.merge context, spokenLanguageContext\n              break\n            fallingBack = true\n        if context\n          try\n            obj[prop] = _.template val, context\n          catch e\n            console.error \"Couldn't create docs template of\", val, \"\\nwith context\", context, \"\\nError:\", e\n        obj[prop] = @replaceSpriteName obj[prop]  # Do this before using the template, otherwise marked might get us first.\n\n    # Temporary hack to replace self|this with hero until we can update the docs\n    if @options.useHero\n      thisToken =\n        'python': /self/g,\n        'javascript': /this/g,\n        'lua': /self/g\n\n      if thisToken[@options.language]\n        if @doc.example\n          @doc.example = @doc.example.replace thisToken[@options.language], 'hero'\n        if @doc.snippets?[@options.language]?.code\n          @doc.snippets[@options.language].code.replace thisToken[@options.language], 'hero'\n        if @doc.args\n          arg.example = arg.example.replace thisToken[@options.language], 'hero' for arg in @doc.args when arg.example\n\n    if @doc.shortName is 'loop' and @options.level.isType('course', 'course-ladder')\n      @replaceSimpleLoops()\n\n  replaceSimpleLoops: ->\n    # Temporary hackery to make it look like we meant while True: in our loop: docs until we can update everything\n    @doc.shortName = @doc.shorterName = @doc.title = @doc.name = switch @options.language\n      when 'coffeescript' then \"loop\"\n      when 'python' then \"while True:\"\n      when 'lua' then \"while true do\"\n      else \"while (true)\"\n    for field in ['example', 'description']\n      [simpleLoop, whileLoop] = switch @options.language\n        when 'coffeescript' then [/loop/g, \"loop\"]\n        when 'python' then [/loop:/g, \"while True:\"]\n        when 'lua' then [/loop/g, \"while true do\"]\n        else [/loop/g, \"while (true)\"]\n      @doc[field] = @doc[field].replace simpleLoop, whileLoop\n\n  formatPopover: ->\n    [docName, args] = @getDocNameAndArguments()\n    argumentExamples = (arg.example or arg.default or arg.name for arg in @doc.args ? [])\n    argumentExamples.unshift args[0] if args.length > argumentExamples.length\n    content = popoverTemplate {\n      doc: @doc\n      docName: docName\n      language: @options.language\n      value: @formatValue()\n      marked: marked\n      argumentExamples: argumentExamples\n      writable: @options.writable\n      selectedMethod: @options.selectedMethod\n      cooldowns: @inferCooldowns()\n      item: @options.item\n      _: _\n    }\n    owner = if @doc.owner is 'this' then @options.thang else window[@doc.owner]\n    content = @replaceSpriteName content\n    content = content.replace /\\#\\{(.*?)\\}/g, (s, properties) => @formatValue downTheChain(owner, properties.split('.'))\n    content = content.replace /{([a-z]+)}([^]*?){\\/\\1}/g, (s, language, text) =>\n      if language is @options.language then return text\n      return ''\n\n  replaceSpriteName: (s) ->\n    # Prefer type, and excluded the quotes we'd get with @formatValue\n    name = @options.thang.type ? @options.thang.spriteName\n    name = 'hero' if /Hero Placeholder/.test @options.thang.id\n    s.replace /#{spriteName}/g, name\n\n  getDocNameAndArguments: ->\n    return [@doc.name, []] unless @doc.type is 'function'\n    docName = @doc.name\n    args = (arg.name for arg in @doc.args ? [])\n    if /cast[A-Z]/.test docName\n      docName = 'cast'\n      args.unshift '\"' + _.string.dasherize(@doc.name).replace('cast-', '') + '\"'\n    [docName, args]\n\n  formatValue: (v) ->\n    return null if @options.level.isType('web-dev')\n    return null if @doc.type is 'snippet'\n    return @options.thang.now() if @doc.name is 'now'\n    return '[Function]' if not v and @doc.type is 'function'\n    unless v?\n      if @doc.owner is 'this'\n        v = @options.thang[@doc.name]\n      else\n        v = window[@doc.owner][@doc.name]  # grab Math or Vector\n    if @doc.type is 'number' and not _.isNaN v\n      if v is Math.round v\n        return v\n      if _.isNumber v\n        return v.toFixed 2\n      unless v\n        return 'null'\n      return '' + v\n    if _.isString v\n      return \"\\\"#{v}\\\"\"\n    if v?.id\n      return v.id\n    if v?.name\n      return v.name\n    if _.isArray v\n      return '[' + (@formatValue v2 for v2 in v).join(', ') + ']'\n    if _.isPlainObject v\n      return safeJSONStringify v, 2\n    v\n\n  inferCooldowns: ->\n    return null unless @doc.type is 'function' and @doc.owner is 'this'\n    owner = @options.thang\n    cooldowns = null\n    spellName = @doc.name.match /^cast(.+)$/\n    if spellName\n      actionName = _.string.slugify _.string.underscored spellName[1]\n      action = owner.spells?[actionName]\n      type = 'spell'\n    else\n      actionName = _.string.slugify _.string.underscored @doc.name\n      action = owner.actions?[actionName]\n      type = 'action'\n    return null unless action\n    cooldowns = cooldown: action.cooldown, specificCooldown: action.specificCooldown, name: actionName, type: type\n    for prop in ['range', 'radius', 'duration', 'damage']\n      v = owner[_.string.camelize actionName + _.string.capitalize(prop)]\n      continue if prop is 'range' and v <= 5  # Don't confuse players by showing melee ranges, they will inappropriately use distanceTo(enemy) < 3.\n      cooldowns[prop] = v\n      if _.isNumber(v) and v isnt Math.round v\n        cooldowns[prop] = v.toFixed 2\n    cooldowns\n"]}