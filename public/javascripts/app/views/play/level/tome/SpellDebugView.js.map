{"version":3,"sources":["app/views/play/level/tome/SpellDebugView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/tome/SpellDebugView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\ntemplate = require 'templates/play/level/tome/spell_debug'\nace = require 'ace'\nRange = ace.require('ace/range').Range\nTokenIterator = ace.require('ace/token_iterator').TokenIterator\nserializedClasses =\n  Thang: require 'lib/world/thang'\n  Vector: require 'lib/world/vector'\n  Rectangle: require 'lib/world/rectangle'\n  Ellipse: require 'lib/world/ellipse'\n  LineSegment: require 'lib/world/line_segment'\n\nmodule.exports = class SpellDebugView extends CocoView\n  className: 'spell-debug-view'\n  template: template\n\n  subscriptions:\n    'god:new-world-created': 'onNewWorld'\n    'god:debug-value-return': 'handleDebugValue'\n    'god:debug-world-load-progress-changed': 'handleWorldLoadProgressChanged'\n    'tome:cast-spells': 'onTomeCast'\n    'surface:frame-changed': 'onFrameChanged'\n    'tome:spell-has-changed-significantly-calculation': 'onSpellChangedCalculation'\n\n  events: {}\n\n  constructor: (options) ->\n    super options\n    @ace = options.ace\n    @thang = options.thang\n    @spell = options.spell\n    @progress = 0\n    @variableStates = {}\n    @globals = {Math: Math, _: _, String: String, Number: Number, Array: Array, Object: Object}  # ... add more as documented\n    for className, serializedClass of serializedClasses\n      @globals[className] = serializedClass\n\n    @onMouseMove = _.throttle @onMouseMove, 25\n    @cache = {}\n    @lastFrameRequested = -1\n    @workerIsSimulating = false\n    @spellHasChanged = false\n    @currentFrame = 0\n    @frameRate = 10 #only time it won't be set is at very beginning\n    @debouncedTooltipUpdate = _.debounce @updateTooltipProgress, 100\n\n  pad2: (num) ->\n    if not num? or num is 0 then '00' else ((if num < 10 then '0' else '') + num)\n\n  calculateCurrentTimeString: =>\n    time = @currentFrame / @frameRate\n    mins = Math.floor(time / 60)\n    secs = (time - mins * 60).toFixed(1)\n    \"#{mins}:#{@pad2 secs}\"\n\n  setTooltipKeyAndValue: (key, value) =>\n    @hideProgressBarAndShowText()\n    message = \"Time: #{@calculateCurrentTimeString()}\\n#{key}: #{value}\"\n    @$el.find('code').text message\n    @$el.show().css(@pos)\n\n  setTooltipText: (text) =>\n    #perhaps changing styling here in the future\n    @hideProgressBarAndShowText()\n    @$el.find('code').text text\n    @$el.show().css(@pos)\n\n  setTooltipProgress: (progress) =>\n    @showProgressBarAndHideText()\n    @$el.find('.progress-bar').css('width', progress + '%').attr 'aria-valuenow', progress\n    @$el.show().css(@pos)\n\n  showProgressBarAndHideText: ->\n    @$el.find('pre').css('display', 'none')\n    @$el.find('.progress').css('display', 'block')\n\n  hideProgressBarAndShowText: ->\n    @$el.find('pre').css('display', 'block')\n    @$el.find('.progress').css('display', 'none')\n\n  onTomeCast: ->\n    @invalidateCache()\n\n  invalidateCache: -> @cache = {}\n\n  retrieveValueFromCache: (thangID, spellID, variableChain, frame) ->\n    joinedVariableChain = variableChain.join()\n    value = @cache[frame]?[thangID]?[spellID]?[joinedVariableChain]\n    return value ? undefined\n\n  updateCache: (thangID, spellID, variableChain, frame, value) ->\n    currentObject = @cache\n    keys = [frame, thangID, spellID, variableChain.join()]\n    for keyIndex in [0...(keys.length - 1)]\n      key = keys[keyIndex]\n      unless key of currentObject\n        currentObject[key] = {}\n      currentObject = currentObject[key]\n    currentObject[keys[keys.length - 1]] = value\n\n  handleDebugValue: (e) ->\n    {key, value} = e\n    @workerIsSimulating = false\n    @updateCache(@thang.id, @spell.name, key.split('.'), @lastFrameRequested, value)\n    if @variableChain and not key is @variableChain.join('.') then return\n    @setTooltipKeyAndValue(key, value)\n\n  handleWorldLoadProgressChanged: (e) ->\n    @progress = e.progress\n\n  afterRender: ->\n    super()\n    @ace.on 'mousemove', @onMouseMove\n\n  setVariableStates: (@variableStates) ->\n    @update()\n\n  isIdentifier: (t) ->\n    t and (t.type is 'identifier' or t.value is 'this' or @globals[t.value])\n\n  onMouseMove: (e) =>\n    return if @destroyed\n    pos = e.getDocumentPosition()\n    it = new TokenIterator e.editor.session, pos.row, pos.column\n    endOfLine = it.getCurrentToken()?.index is it.$rowTokens.length - 1\n    while it.getCurrentTokenRow() is pos.row and not @isIdentifier(token = it.getCurrentToken())\n      break if endOfLine or not token  # Don't iterate beyond end or beginning of line\n      it.stepBackward()\n    if @isIdentifier token\n      # This could be a property access, like 'enemy.target.pos' or 'this.spawnedRectangles'.\n      # We have to realize this and dig into the nesting of the objects.\n      start = it.getCurrentTokenColumn()\n      [chain, start, end] = [[token.value], start, start + token.value.length]\n      while it.getCurrentTokenRow() is pos.row\n        it.stepBackward()\n        break unless it.getCurrentToken()?.value is '.'\n        it.stepBackward()\n        token = null  # If we're doing a complex access like this.getEnemies().length, then length isn't a valid var.\n        break unless @isIdentifier(prev = it.getCurrentToken())\n        token = prev\n        start = it.getCurrentTokenColumn()\n        chain.unshift token.value\n    #Highlight all tokens, so true overrides all other conditions TODO: Refactor this later\n    if token and (true or token.value of @variableStates or token.value is 'this' or @globals[token.value])\n      @variableChain = chain\n      offsetX = e.domEvent.offsetX ? e.clientX - $(e.domEvent.target).offset().left\n      offsetY = e.domEvent.offsetY ? e.clientY - $(e.domEvent.target).offset().top\n      w = $(document).width()\n      offsetX = w - $(e.domEvent.target).offset().left - 300 if e.clientX + 300 > w\n      @pos = {left: offsetX + 50, top: offsetY + 20}\n      @markerRange = new Range pos.row, start, pos.row, end\n    else\n      @variableChain = @markerRange = null\n    @update()\n\n  onMouseOut: (e) ->\n    @variableChain = @markerRange = null\n    @update()\n\n  updateTooltipProgress: =>\n    if @variableChain and @progress < 1\n      @setTooltipProgress(@progress * 100)\n      _.delay @updateTooltipProgress, 100\n\n  onNewWorld: (e) ->\n    @thang = @options.thang = e.world.thangMap[@thang.id] if @thang\n    @frameRate = e.world.frameRate\n\n  onFrameChanged: (data) ->\n    @currentFrame = Math.round(data.frame)\n    @frameRate = data.world.frameRate\n\n  onSpellChangedCalculation: (data) ->\n    @spellHasChanged = data.hasChangedSignificantly\n\n  update: ->\n    if @variableChain\n      if @spellHasChanged\n        @setTooltipText('You\\'ve changed this spell! \\nPlease recast to use the hover debugger.')\n      else if @variableChain.length is 2 and @variableChain[0] is 'this'\n        @setTooltipKeyAndValue(@variableChain.join('.'), @stringifyValue(@thang[@variableChain[1]], 0))\n      else if @variableChain.length is 1 and Aether.globals[@variableChain[0]]\n        @setTooltipKeyAndValue(@variableChain.join('.'), @stringifyValue(Aether.globals[@variableChain[0]], 0))\n      else if @workerIsSimulating and @progress < 1\n        @debouncedTooltipUpdate()\n      else if @currentFrame is @lastFrameRequested and (cacheValue = @retrieveValueFromCache(@thang.id, @spell.name, @variableChain, @currentFrame))\n        @setTooltipKeyAndValue(@variableChain.join('.'), cacheValue)\n      else\n        Backbone.Mediator.publish 'tome:spell-debug-value-request',\n          thangID: @thang.id\n          spellID: @spell.name\n          variableChain: @variableChain\n          frame: @currentFrame\n        if @currentFrame isnt @lastFrameRequested then @workerIsSimulating = true\n        @lastFrameRequested = @currentFrame\n        @progress = 0\n        @debouncedTooltipUpdate()\n    else\n      @$el.hide()\n    if @variableChain?.length is 2\n      clearTimeout @hoveredPropertyTimeout if @hoveredPropertyTimeout\n      @hoveredPropertyTimeout = _.delay @notifyPropertyHovered, 500\n    else\n      @notifyPropertyHovered()\n    @updateMarker()\n\n  stringifyValue: (value, depth) ->\n    return value if not value or _.isString value\n    if _.isFunction value\n      return if depth is 2 then undefined else '<Function>'\n    return \"<this #{value.id}>\" if value is @thang and depth\n    if depth is 2\n      if value.constructor?.className is 'Thang'\n        value = \"<#{value.type or value.spriteName} - #{value.id}, #{if value.pos then value.pos.toString() else 'non-physical'}>\"\n      else\n        value = value.toString()\n      return value\n\n    isArray = _.isArray value\n    isObject = _.isObject value\n    return value.toString() unless isArray or isObject\n    brackets = if isArray then ['[', ']'] else ['{', '}']\n    size = _.size value\n    return brackets.join '' unless size\n    values = []\n    if isArray\n      for v in value\n        s = @stringifyValue(v, depth + 1)\n        values.push '' + s unless s is undefined\n    else\n      for key in value.apiProperties ? _.keys value\n        s = @stringifyValue(value[key], depth + 1)\n        values.push key + ': ' + s unless s is undefined\n    sep = '\\n' + ('  ' for i in [0 ... depth]).join('')\n    prefix = value.constructor?.className\n    prefix ?= 'Array' if isArray\n    prefix ?= 'Object' if isObject\n    prefix = if prefix then prefix + ' ' else ''\n    return \"#{prefix}#{brackets[0]}#{sep}  #{values.join(sep + '  ')}#{sep}#{brackets[1]}\"\n  notifyPropertyHovered: =>\n    clearTimeout @hoveredPropertyTimeout if @hoveredPropertyTimeout\n    @hoveredPropertyTimeout = null\n    oldHoveredProperty = @hoveredProperty\n    @hoveredProperty = if @variableChain?.length is 2 then owner: @variableChain[0], property: @variableChain[1] else {}\n    unless _.isEqual oldHoveredProperty, @hoveredProperty\n      Backbone.Mediator.publish 'tome:spell-debug-property-hovered', @hoveredProperty\n\n  updateMarker: ->\n    if @marker\n      @ace.getSession().removeMarker @marker\n      @marker = null\n    if @markerRange\n      @marker = @ace.getSession().addMarker @markerRange, 'ace_bracket', 'text'\n\n\n  destroy: ->\n    @ace?.removeEventListener 'mousemove', @onMouseMove\n    super()\n"]}