{"version":3,"sources":["app/templates/play/level/modal/course-victory-modal.jade","app/views/play/level/modal/CourseVictoryModal.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/modal/CourseVictoryModal.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nbuf.push(\"<div class=\\\"modal-dialog\\\"><div class=\\\"background-wrapper\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-body\\\"></div></div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","ModalView = require 'views/core/ModalView'\ntemplate = require 'templates/play/level/modal/course-victory-modal'\nLevel = require 'models/Level'\nCourse = require 'models/Course'\nLevelSessions = require 'collections/LevelSessions'\nProgressView = require './ProgressView'\nClassroom = require 'models/Classroom'\nutils = require 'core/utils'\n\nmodule.exports = class CourseVictoryModal extends ModalView\n  id: 'course-victory-modal'\n  template: template\n  closesOnClickOutside: false\n\n  initialize: (options) ->\n    @courseID = options.courseID\n    @courseInstanceID = options.courseInstanceID or @getQueryVariable('course-instance') or @getQueryVariable('league')\n    @views = []\n\n    @session = options.session\n    @level = options.level\n\n    if @courseInstanceID\n      @classroom = new Classroom()\n      @supermodel.trackRequest(@classroom.fetchForCourseInstance(@courseInstanceID))\n\n    @playSound 'victory'\n    @nextLevel = new Level()\n    @nextLevelRequest = @supermodel.trackRequest(@nextLevel.fetchNextForCourse({\n      levelOriginalID: @level.get('original')\n      @courseInstanceID\n      @courseID\n      sessionID: @session.id\n    }))\n\n    @course = options.course\n    if @courseID and not @course\n      @course = new Course().setURL \"/db/course/#{@courseID}\"\n      @course = @supermodel.loadModel(@course).model\n\n    if @courseInstanceID\n      @levelSessions = new LevelSessions()\n      @levelSessions.fetchForCourseInstance(@courseInstanceID)\n      @levelSessions = @supermodel.loadCollection(@levelSessions, 'sessions', {\n        data: { project: 'state.complete level.original playtime changed' }\n      }).model\n\n      if not @course\n        @course = new Course()\n        @supermodel.trackRequest @course.fetchForCourseInstance(@courseInstanceID)\n\n    window.tracker?.trackEvent 'Play Level Victory Modal Loaded', category: 'Students', levelSlug: @level.get('slug'), []\n\n  onResourceLoadFailed: (e) ->\n    if e.resource.jqxhr is @nextLevelRequest\n      return\n    super(arguments...)\n\n  onLoaded: ->\n    super()\n    @courseID ?= @course.id\n    @views = []\n\n    @levelSessions?.remove(@session)\n    @levelSessions?.add(@session)\n    progressView = new ProgressView({\n      level: @level\n      nextLevel: @nextLevel\n      course: @course\n      classroom: @classroom\n      levelSessions: @levelSessions\n      session: @session\n    })\n\n    progressView.once 'done', @onDone, @\n    progressView.once 'next-level', @onNextLevel, @\n    progressView.once 'ladder', @onLadder, @\n    for view in @views\n      view.on 'continue', @onViewContinue, @\n    @views.push(progressView)\n\n    @showView(_.first(@views))\n\n  afterRender: ->\n    super()\n    @showView(@currentView)\n\n  showView: (view) ->\n    return unless view\n    view.setElement(@$('.modal-content'))\n    view.$el.attr('id', view.id)\n    view.$el.addClass(view.className)\n    view.render()\n    @currentView = view\n\n  onViewContinue: ->\n    index = _.indexOf(@views, @currentView)\n    @showView(@views[index+1])\n\n  onNextLevel: ->\n    window.tracker?.trackEvent 'Play Level Victory Modal Next Level', category: 'Students', levelSlug: @level.get('slug'), nextLevelSlug: @nextLevel.get('slug'), []\n    if me.isSessionless()\n      link = \"/play/level/#{@nextLevel.get('slug')}?course=#{@courseID}&codeLanguage=#{utils.getQueryVariable('codeLanguage', 'python')}\"\n    else\n      link = \"/play/level/#{@nextLevel.get('slug')}?course=#{@courseID}&course-instance=#{@courseInstanceID}\"\n      link += \"&codeLanguage=\" + @level.get('primerLanguage') if @level.get('primerLanguage')\n    application.router.navigate(link, {trigger: true})\n\n  onDone: ->\n    window.tracker?.trackEvent 'Play Level Victory Modal Done', category: 'Students', levelSlug: @level.get('slug'), []\n    if me.isSessionless()\n      link = '/teachers/courses'\n    else\n      link = '/students'\n    application.router.navigate(link, {trigger: true})\n\n  onLadder: ->\n    # Preserve the supermodel as we navigate back to the ladder.\n    viewArgs = [{supermodel: if @options.hasReceivedMemoryWarning then null else @supermodel}, @level.get('slug')]\n    ladderURL = \"/play/ladder/#{@level.get('slug') || @level.id}\"\n    if leagueID = (@courseInstanceID or @getQueryVariable 'league')\n      leagueType = if @level.get('type') is 'course-ladder' then 'course' else 'clan'\n      viewArgs.push leagueType\n      viewArgs.push leagueID\n      ladderURL += \"/#{leagueType}/#{leagueID}\"\n    ladderURL += '#my-matches'\n    Backbone.Mediator.publish 'router:navigate', route: ladderURL, viewClass: 'views/ladder/LadderView', viewArgs: viewArgs\n"]}