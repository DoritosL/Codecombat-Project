{"version":3,"sources":["app/views/play/level/DialogueAnimator.coffee"],"names":[],"mappings":";AAAA;;AAAA,MAAM,CAAC,OAAP,GAAuB;6BACrB,gBAAe;;6BACf,gBAAe;;6BACf,aAAY;;6BACZ,gBAAe;;EAEF,0BAAC,IAAD,EAAO,aAAP;AACX;IADkB,IAAC,iBAAD;IAClB,IAAI,EAAE,aAAF,CAAgB,CAAC,IAAjB,CAAsB,IAAtB;IACJ,IAAC,cAAD,GAAiB,CAAC,CAAC,GAAF,CAAM,CAAE,GAAE,CAAC,UAAX,EAAuB,SAAC,CAAD;AAAO,aAAO;IAAd,CAAvB;IACjB,IAAC,GAAD,GAAU;IACV,IAAC,WAAD,GAAc;IACd,IAAC,eAAD,GAAkB;EALP;;6BAOb,OAAM;IACJ,IAAG,CAAI,IAAC,WAAL,IAAoB,CAAI,IAAC,cAA5B;MACE,IAAC,eAAD,GADF;;IAGA,IAAG,IAAC,WAAJ;MACE,IAAC,cAAD;AACA,aAFF;;IAIA,IAAG,IAAC,cAAJ;MACE,IAAC,cAAa,CAAC,IAAf;MACA,IAAG,IAAC,cAAa,CAAC,IAAf,EAAH;eACE,IAAC,cAAD,GAAiB,KADnB;OAFF;;EARI;;6BAaN,iBAAgB;AACd;IAAA,KAAc,IAAC,cAAa,CAAC,MAA7B;AAAA;;IACA,WAAW,IAAC,cAAc;IAC1B,IAAC,cAAD,GAAiB,IAAC,cAAc;IAChC,IAAG,QAAQ,CAAC,QAAT,KAAqB,OAAxB;aACE,IAAC,WAAD,GAAc,QAAQ,CAAC,UADzB;KAAA;MAGE,QAAQ,QAAQ,CAAC;MACjB,UAAU,EAAE,QAAF,CAAW,CAAC,IAAZ,CAAiB,EAAjB;MACV,IAAC,cAAa,CAAC,MAAf,CAAsB,OAAtB;MACA,IAAG,KAAH;QACE,IAAiD,IAAC,cAAlD;UAAA,IAAC,WAAD,IAAe,IAAC,cAAa,CAAC,aAAf,GAAf;;eACA,IAAC,cAAD,GAAqB,qBAAiB,KAAjB,EAAwB,OAAxB,EAFvB;OANF;;EAJc;;6BAchB,gBAAe;AACb;IAAA,UAAU,CAAK,UAAL,IAAe,IAAC;IAC1B,SAAS,IAAC,cAAD;IACT,mBAAmB,IAAI,CAAC,KAAL,CAAW,IAAC,eAAD,GAAkB,OAAlB,GAA4B,IAAvC;IACnB,SAAS,IAAI,CAAC,GAAL,CAAS,mBAAmB,MAA5B,EAAoC,IAAC,WAAU,CAAC,MAAhD;IACT,IAAC,cAAa,CAAC,IAAf,CAAoB,IAAC,cAAa,CAAC,IAAf,KAAwB,IAAC,WAAU,CAAC,KAAZ,CAAkB,CAAlB,EAAqB,MAArB,CAA5C;IACA,IAAC,WAAD,GAAc,IAAC,WAAU,CAAC,KAAZ,CAAkB,MAAlB;IACd,IAAG,IAAC,WAAU,CAAC,MAAZ,KAAsB,CAAzB;MACE,IAAC,WAAD,GAAc,KADhB;;WAEA,IAAC,WAAD,IAAe;EATF;;6BAWf,gBAAe;AACb;WAAA,IAAC,WAAD,GAAc,wFAA8B,CAA9B;EADD;;6BAGf,OAAM;IACJ,IAAgB,IAAC,cAAa,CAAC,MAAf,GAAwB,CAAxC;AAAA,aAAO,MAAP;;IACA,IAAgB,IAAC,WAAjB;AAAA,aAAO,MAAP;;IACA,IAAgB,IAAC,cAAjB;AAAA,aAAO,MAAP;;AACA,WAAO;EAJH","file":"public/javascripts/app/views/play/level/DialogueAnimator.js","sourcesContent":["module.exports = class DialogueAnimator\n  jqueryElement: null\n  childrenToAdd: null\n  charsToAdd: null\n  childAnimator: null\n\n  constructor: (html, @jqueryElement) ->\n    d = $('<div></div>').html(html)\n    @childrenToAdd = _.map(d[0].childNodes, (e) -> return e)\n    @t0 = new Date()\n    @charsAdded = 0\n    @charsPerSecond = 25\n\n  tick: ->\n    if not @charsToAdd and not @childAnimator\n      @addNextElement()\n\n    if @charsToAdd\n      @addSingleChar()\n      return\n\n    if @childAnimator\n      @childAnimator.tick()\n      if @childAnimator.done()\n        @childAnimator = null\n\n  addNextElement: ->\n    return unless @childrenToAdd.length\n    nextElem = @childrenToAdd[0]\n    @childrenToAdd = @childrenToAdd[1..]\n    if nextElem.nodeName is '#text'\n      @charsToAdd = nextElem.nodeValue\n    else\n      value = nextElem.innerHTML\n      newElem = $(nextElem).html('')\n      @jqueryElement.append(newElem)\n      if value\n        @charsAdded += @childAnimator.getCharsAdded() if @childAnimator\n        @childAnimator = new DialogueAnimator(value, newElem)\n\n  addSingleChar: ->\n    elapsed = (new Date()) - @t0\n    nAdded = @getCharsAdded()\n    nToHaveBeenAdded = Math.round @charsPerSecond * elapsed / 1000\n    nToAdd = Math.min nToHaveBeenAdded - nAdded, @charsToAdd.length\n    @jqueryElement.html(@jqueryElement.html() + @charsToAdd.slice(0, nToAdd))\n    @charsToAdd = @charsToAdd.slice(nToAdd)\n    if @charsToAdd.length is 0\n      @charsToAdd = null\n    @charsAdded += nToAdd\n\n  getCharsAdded: ->\n    @charsAdded + (@childAnimator?.charsAdded ? 0)\n\n  done: ->\n    return false if @childrenToAdd.length > 0\n    return false if @charsToAdd\n    return false if @childAnimator\n    return true\n"]}