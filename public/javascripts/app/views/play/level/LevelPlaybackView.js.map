{"version":3,"sources":["app/templates/play/level/level-playback-view.jade","app/views/play/level/LevelPlaybackView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/LevelPlaybackView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view;buf.push(\"<button id=\\\"play-button\\\" title=\\\"Ctrl/Cmd + P: Toggle level play/pause\\\" class=\\\"btn btn-xs btn-inverse paused\\\"><div class=\\\"glyphicon glyphicon-play\\\"></div><div class=\\\"glyphicon glyphicon-pause\\\"></div><div class=\\\"glyphicon glyphicon-repeat\\\"></div></button><button id=\\\"volume-button\\\" title=\\\"Adjust volume\\\" class=\\\"btn btn-xs btn-inverse picoctf-hide\\\"><div class=\\\"glyphicon glyphicon-volume-off\\\"></div><div class=\\\"glyphicon glyphicon-volume-down\\\"></div><div class=\\\"glyphicon glyphicon-volume-up\\\"></div></button><button id=\\\"music-button\\\" title=\\\"Toggle Music\\\" class=\\\"btn btn-xs btn-inverse picoctf-hide\\\"><span>♫</span></button>\");\nif ( !view.options.level.isType('game-dev'))\n{\nbuf.push(\"<div class=\\\"scrubber\\\"><div class=\\\"scrubber-inner\\\"><div id=\\\"timeProgress\\\" class=\\\"progress secret\\\"><div class=\\\"progress-bar\\\"><div class=\\\"scrubber-handle\\\"></div><div id=\\\"timePopover\\\" class=\\\"popover fade top in\\\"><div class=\\\"arrow\\\"></div><h3 class=\\\"popover-title\\\"></h3><div class=\\\"popover-content\\\"></div></div></div></div></div></div>\");\n}\nbuf.push(\"<div id=\\\"playback-settings\\\" class=\\\"btn-group dropup\\\"><button title=\\\"Toggle fullscreen\\\" class=\\\"btn btn-xs btn-inverse toggle-fullscreen\\\"><div class=\\\"glyphicon glyphicon-fullscreen\\\"></div></button><button id=\\\"zoom-in-button\\\" title=\\\"Zoom In (or scroll down)\\\" class=\\\"btn btn-xs btn-inverse\\\"><div class=\\\"glyphicon glyphicon-zoom-in\\\"></div></button><button id=\\\"zoom-out-button\\\" title=\\\"Zoom Out (or scroll up)\\\" class=\\\"btn btn-xs btn-inverse\\\"><div class=\\\"glyphicon glyphicon-zoom-out\\\"></div></button></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\ntemplate = require 'templates/play/level/level-playback-view'\n{me} = require 'core/auth'\n\nmodule.exports = class LevelPlaybackView extends CocoView\n  id: 'playback-view'\n  template: template\n\n  subscriptions:\n    'level:disable-controls': 'onDisableControls'\n    'level:enable-controls': 'onEnableControls'\n    'level:set-playing': 'onSetPlaying'\n    'level:toggle-playing': 'onTogglePlay'\n    'level:scrub-forward': 'onScrubForward'\n    'level:scrub-back': 'onScrubBack'\n    'level:set-volume': 'onSetVolume'\n    'surface:frame-changed': 'onFrameChanged'\n    'god:new-world-created': 'onNewWorld'\n    'god:streaming-world-updated': 'onNewWorld'\n    'level:set-letterbox': 'onSetLetterbox'\n    'tome:cast-spells': 'onTomeCast'\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\n    'playback:stop-real-time-playback': 'onStopRealTimePlayback'\n\n  events:\n    'click #music-button': 'onToggleMusic'\n    'click #zoom-in-button': -> Backbone.Mediator.publish 'camera:zoom-in', {} unless @shouldIgnore()\n    'click #zoom-out-button': -> Backbone.Mediator.publish 'camera:zoom-out', {} unless @shouldIgnore()\n    'click #volume-button': 'onToggleVolume'\n    'click #play-button': 'onTogglePlay'\n    'click': -> Backbone.Mediator.publish 'tome:focus-editor', {} unless @realTime\n    'mouseenter #timeProgress': 'onProgressEnter'\n    'mouseleave #timeProgress': 'onProgressLeave'\n    'mousemove #timeProgress': 'onProgressHover'\n    'tapstart #timeProgress': 'onProgressTapStart'\n    'tapend #timeProgress': 'onProgressTapEnd'\n    'tapmove #timeProgress': 'onProgressTapMove'\n\n  shortcuts:\n    '⌘+p, p, ctrl+p': 'onTogglePlay'\n    '⌘+[, ctrl+[': 'onScrubBack'\n    '⌘+⇧+[, ctrl+⇧+[': 'onSingleScrubBack'\n    '⌘+], ctrl+]': 'onScrubForward'\n    '⌘+⇧+], ctrl+⇧+]': 'onSingleScrubForward'\n\n  constructor: ->\n    super(arguments...)\n    me.on('change:music', @updateMusicButton, @)\n\n  afterRender: ->\n    super()\n    @$progressScrubber = $('.scrubber .progress', @$el)\n    @hookUpScrubber() unless @options.level.isType('game-dev')\n    @updateMusicButton()\n    $(window).on('resize', @onWindowResize)\n    ua = navigator.userAgent.toLowerCase()\n    if /safari/.test(ua) and not /chrome/.test(ua)\n      @$el.find('.toggle-fullscreen').hide()\n    @timePopup ?= new HoverPopup\n    t = $.i18n.t\n    @second = t 'units.second'\n    @seconds = t 'units.seconds'\n    @minute = t 'units.minute'\n    @minutes = t 'units.minutes'\n    @goto = t 'play_level.time_goto'\n    @current = t 'play_level.time_current'\n    @total = t 'play_level.time_total'\n    @$el.find('#play-button').css('visibility', 'hidden') if @options.level.get 'hidesPlayButton'  # Don't show for first few levels, confuses new players.\n\n  updatePopupContent: ->\n    @timePopup?.updateContent \"<h2>#{@timeToString @newTime}</h2>#{@formatTime(@current, @currentTime)}<br/>#{@formatTime(@total, @totalTime)}\"\n\n  # These functions could go to some helper class\n\n  pad2: (num) ->\n    if not num? or num is 0 then '00' else ((if num < 10 then '0' else '') + num)\n\n  formatTime: (text, time) =>\n    \"#{text}\\t#{@timeToString time}\"\n\n  timeToString: (time=0, withUnits=false) ->\n    mins = Math.floor(time / 60)\n    secs = (time - mins * 60).toFixed(1)\n    if withUnits\n      ret = ''\n      ret = (mins + ' ' + (if mins is 1 then @minute else @minutes)) if (mins > 0)\n      ret = (ret + ' ' + secs + ' ' + (if secs is 1 then @second else @seconds)) if (secs > 0 or mins is 0)\n    else\n      \"#{mins}:#{@pad2 secs}\"\n\n  # callbacks\n\n  updateMusicButton: ->\n    @$el.find('#music-button').toggleClass('music-on', me.get('music'))\n\n  onSetLetterbox: (e) ->\n    return if @realTime\n    @togglePlaybackControls !e.on\n    @disabled = e.on\n\n  togglePlaybackControls: (to) ->\n    buttons = @$el.find '#play-button, .scrubber-handle'\n    buttons.css 'visibility', if to then 'visible' else 'hidden'\n\n  onTomeCast: (e) ->\n    return unless e.realTime\n    @realTime = true\n    @togglePlaybackControls false\n    Backbone.Mediator.publish 'playback:real-time-playback-started', {}\n    @playSound 'real-time-playback-start'\n\n  onWindowResize: (s...) =>\n    @barWidth = $('.progress', @$el).width()\n\n  onNewWorld: (e) ->\n    @updateBarWidth e.world.frames.length, e.world.maxTotalFrames, e.world.dt\n\n  updateBarWidth: (loadedFrameCount, maxTotalFrames, dt) ->\n    @totalTime = (loadedFrameCount - 1) * dt\n    pct = parseInt(100 * loadedFrameCount / (maxTotalFrames - 1)) + '%'\n    @barWidth = $('.progress', @$el).css('width', pct).show().width()\n    $('.scrubber .progress', @$el).slider('enable', true)\n    @newTime = 0\n    @currentTime = 0\n    @lastLoadedFrameCount = loadedFrameCount\n\n  onDisableControls: (e) ->\n    if not e.controls or ('playback' in e.controls)\n      @disabled = true\n      $('button', @$el).addClass('disabled')\n      try\n        @$progressScrubber.slider('disable', true)\n      catch error\n        console.warn('error disabling scrubber', error)\n      @timePopup?.disable()\n      $('#volume-button', @$el).removeClass('disabled')\n      @$el.addClass 'controls-disabled'\n\n  onEnableControls: (e) ->\n    return if @realTime\n    if not e.controls or ('playback' in e.controls)\n      @disabled = false\n      $('button', @$el).removeClass('disabled')\n      try\n        @$progressScrubber.slider('enable', true)\n      catch error\n        console.warn('error enabling scrubber', error)\n      @timePopup?.enable()\n      @$el.removeClass 'controls-disabled'\n\n  onSetPlaying: (e) ->\n    @playing = (e ? {}).playing ? true\n    button = @$el.find '#play-button'\n    ended = button.hasClass 'ended'\n    changed = button.hasClass('playing') isnt @playing\n    button.toggleClass('playing', @playing and not ended).toggleClass('paused', not @playing and not ended)\n    @playSound (if @playing then 'playback-play' else 'playback-pause') unless @options.level.isType('game-dev')\n    return   # don't stripe the bar\n    bar = @$el.find '.scrubber .progress'\n    bar.toggleClass('progress-striped', @playing and not ended).toggleClass('active', @playing and not ended)\n\n  onSetVolume: (e) ->\n    classes = ['vol-off', 'vol-down', 'vol-up']\n    button = $('#volume-button', @$el)\n    button.removeClass(c) for c in classes\n    button.addClass(classes[0]) if e.volume <= 0.0\n    button.addClass(classes[1]) if e.volume > 0.0 and e.volume < 1.0\n    button.addClass(classes[2]) if e.volume >= 1.0\n\n  onScrub: (e, options) ->\n    e?.preventDefault?()\n    options.scrubDuration = 500\n    Backbone.Mediator.publish('level:set-time', options)\n\n  onScrubForward: (e) ->\n    @onScrub e, ratioOffset: 0.05\n\n  onSingleScrubForward: (e) ->\n    @onScrub e, frameOffset: 1\n\n  onScrubBack: (e) ->\n    @onScrub e, ratioOffset: -0.05\n\n  onSingleScrubBack: (e) ->\n    @onScrub e, frameOffset: -1\n\n  onFrameChanged: (e) ->\n    if e.progress isnt @lastProgress\n      @currentTime = e.frame / e.world.frameRate\n      @updatePopupContent() if @timePopup?.shown\n      @updateProgress(e.progress, e.world)\n      @updatePlayButton(e.progress)\n    @lastProgress = e.progress\n\n  onProgressEnter: (e) ->\n    # Why it needs itself as parameter you ask? Ask Twitter instead.\n    @timePopup?.enter @timePopup\n\n  onProgressLeave: (e) ->\n    @timePopup?.leave @timePopup\n\n  onProgressHover: (e, offsetX) ->\n    timeRatio = @$progressScrubber.width() / @totalTime\n    offsetX ?= e.clientX - $(e.target).closest('#timeProgress').offset().left\n    offsetX = Math.max 0, offsetX\n    @newTime = offsetX / timeRatio\n    @updatePopupContent()\n    @timePopup?.onHover e\n\n    # Show it instantaneously if close enough to current time.\n    if @timePopup and Math.abs(@currentTime - @newTime) < 1 and not @timePopup.shown\n      @timePopup.show()\n\n  onProgressTapStart: (e, touchData) ->\n    return unless application.isIPadApp\n    @onProgressEnter e\n    screenOffsetX = e.clientX ? touchData?.position.x ? 0\n    offsetX = screenOffsetX - $(e.target).closest('#timeProgress').offset().left\n    offsetX = Math.max offsetX, 0\n    @scrubTo offsetX / @$progressScrubber.width()\n    @onTogglePlay() if @$el.find('#play-button').hasClass 'playing'\n\n  onProgressTapEnd: (e, touchData) ->\n    return unless application.isIPadApp\n    @onProgressLeave e\n\n  onProgressTapMove: (e, touchData) ->\n    return unless application.isIPadApp  # Not sure why the tap events would fire when it's not one.\n    screenOffsetX = e.clientX ? touchData?.position.x ? 0\n    offsetX = screenOffsetX - $(e.target).closest('#timeProgress').offset().left\n    offsetX = Math.max offsetX, 0\n    @onProgressHover e, offsetX\n    @scrubTo offsetX / @$progressScrubber.width()\n\n  updateProgress: (progress, world) ->\n    if world.frames.length isnt @lastLoadedFrameCount\n      @updateBarWidth world.frames.length, world.maxTotalFrames, world.dt\n    wasLoaded = @worldCompletelyLoaded\n    @worldCompletelyLoaded = world.frames.length is world.totalFrames\n    if @realTime and @worldCompletelyLoaded and not wasLoaded\n      Backbone.Mediator.publish 'playback:real-time-playback-ended', {}\n      Backbone.Mediator.publish 'level:set-letterbox', on: false\n    $('.scrubber .progress-bar', @$el).css('width', \"#{progress * 100}%\")\n\n  updatePlayButton: (progress) ->\n    playButton = @$el.find('#play-button')\n    wasEnded = playButton.hasClass('ended')\n    if @worldCompletelyLoaded and progress >= 0.99 and @lastProgress < 0.99\n      playButton.removeClass('playing').removeClass('paused').addClass('ended')\n      Backbone.Mediator.publish 'level:set-letterbox', on: false if @realTime\n      Backbone.Mediator.publish 'playback:real-time-playback-ended', {} if @realTime\n    if progress < 0.99 and @lastProgress >= 0.99\n      playButton.removeClass('ended')\n      playButton.addClass(if @playing then 'playing' else 'paused')\n    isEnded = playButton.hasClass('ended')\n    if wasEnded isnt isEnded\n      Backbone.Mediator.publish 'playback:ended-changed', ended: isEnded\n\n  onRealTimePlaybackEnded: (e) ->\n    return unless @realTime\n    @realTime = false\n    @togglePlaybackControls true\n    @playSound 'real-time-playback-end'\n\n  onStopRealTimePlayback: (e) ->\n    Backbone.Mediator.publish 'level:set-letterbox', on: false\n    Backbone.Mediator.publish 'playback:real-time-playback-ended', {}\n\n  # to refactor\n\n  hookUpScrubber: ->\n    @sliderIncrements = 500  # max slider width before we skip pixels\n    @$progressScrubber.slider(\n      max: @sliderIncrements\n      animate: 'slow'\n      slide: (event, ui) =>\n        return if @shouldIgnore()\n        ++@slideCount\n        oldRatio = @getScrubRatio()\n        @scrubTo ui.value / @sliderIncrements\n        if ratioChange = @getScrubRatio() - oldRatio\n          sound = \"playback-scrub-slide-#{if ratioChange > 0 then 'forward' else 'back'}-#{@slideCount % 3}\"\n          unless /back/.test sound  # We don't have the back sounds in yet: http://discourse.codecombat.com/t/bug-some-mp3-lost/4830\n            @playSound sound, (Math.min 1, Math.abs ratioChange * 50)\n\n      start: (event, ui) =>\n        return if @shouldIgnore()\n        @slideCount = 0\n        @wasPlaying = @playing and not $('#play-button').hasClass('ended')\n        Backbone.Mediator.publish 'level:set-playing', {playing: false}\n        @playSound 'playback-scrub-start', 0.5\n\n\n      stop: (event, ui) =>\n        return if @shouldIgnore()\n        @actualProgress = ui.value / @sliderIncrements\n        Backbone.Mediator.publish 'playback:manually-scrubbed', ratio: @actualProgress  # For scripts\n        Backbone.Mediator.publish 'level:set-playing', {playing: @wasPlaying}\n        if @slideCount < 3\n          @wasPlaying = false\n          Backbone.Mediator.publish 'level:set-playing', {playing: false}\n          @$el.find('.scrubber-handle').effect('bounce', {times: 2})\n        else\n          @playSound 'playback-scrub-end', 0.5\n\n    )\n\n  getScrubRatio: ->\n    @$progressScrubber.find('.progress-bar').width() / @$progressScrubber.width()\n\n  scrubTo: (ratio, duration=0) ->\n    return if @shouldIgnore()\n    Backbone.Mediator.publish 'level:set-time', ratio: ratio, scrubDuration: duration\n\n  shouldIgnore: -> return @disabled or @realTime\n\n  onTogglePlay: (e) ->\n    e?.preventDefault?()\n    return if @shouldIgnore()\n    button = $('#play-button')\n    willPlay = button.hasClass('paused') or button.hasClass('ended')\n    Backbone.Mediator.publish 'level:set-playing', playing: willPlay\n    $(document.activeElement).blur()\n\n  onToggleVolume: (e) ->\n    button = $(e.target).closest('#volume-button')\n    classes = ['vol-off', 'vol-down', 'vol-up']\n    volumes = [0, 0.4, 1.0]\n    for oldClass, i in classes\n      if button.hasClass oldClass\n        newI = (i + 1) % classes.length\n        break\n      else if i is classes.length - 1  # no oldClass\n        newI = 2\n    Backbone.Mediator.publish 'level:set-volume', volume: volumes[newI]\n    $(document.activeElement).blur()\n\n  onToggleMusic: (e) ->\n    e?.preventDefault()\n    me.set('music', not me.get('music', true))\n    me.patch()\n    $(document.activeElement).blur()\n\n  destroy: ->\n    me.off('change:music', @updateMusicButton, @)\n    $(window).off('resize', @onWindowResize)\n    @onWindowResize = null\n    super()\n\n# popover that shows at the current mouse position on the progressbar, using the bootstrap popover.\n# Could make this into a jQuery plugins itself theoretically.\nclass HoverPopup extends $.fn.popover.Constructor\n  constructor: () ->\n    @enabled = true\n    @shown = false\n    @type = 'HoverPopup'\n    @options =\n      placement: 'top'\n      container: 'body'\n      animation: true\n      html: true\n      delay:\n        show: 400\n    @$element = $('#timeProgress')\n    @$tip = $('#timePopover')\n\n    @content = ''\n\n  getContent: -> @content\n\n  show: ->\n    unless @shown\n      super()\n      @shown = true\n\n  updateContent: (@content) ->\n    @setContent()\n    @$tip.addClass('fade top in')\n\n  onHover: (@e) ->\n    pos = @getPosition()\n    actualWidth  = @$tip[0].offsetWidth\n    actualHeight = @$tip[0].offsetHeight\n    calculatedOffset =\n      top: pos.top - actualHeight\n      left: pos.left + pos.width / 2 - actualWidth / 2\n    @applyPlacement(calculatedOffset, 'top')\n\n  getPosition: ->\n    top: @$element.offset().top\n    left: if @e? then @e.pageX else @$element.offset().left\n    height: 0\n    width: 0\n\n  hide: ->\n    super()\n    @shown = false\n\n  disable: ->\n    super()\n    @hide()\n"]}