{"version":3,"sources":["app/templates/play/level/level-dialogue-view.jade","app/views/play/level/LevelDialogueView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/play/level/LevelDialogueView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nbuf.push(\"<div class=\\\"dialogue-area\\\"><p class=\\\"bubble dialogue-bubble\\\"></p></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","CocoView = require 'views/core/CocoView'\ntemplate = require 'templates/play/level/level-dialogue-view'\nDialogueAnimator = require './DialogueAnimator'\n\nmodule.exports = class LevelDialogueView extends CocoView\n  id: 'level-dialogue-view'\n  template: template\n\n  subscriptions:\n    'sprite:speech-updated': 'onSpriteDialogue'\n    'level:sprite-clear-dialogue': 'onSpriteClearDialogue'\n    'level:shift-space-pressed': 'onShiftSpacePressed'\n    'level:escape-pressed': 'onEscapePressed'\n    'sprite:dialogue-sound-completed': 'onDialogueSoundCompleted'\n\n  events:\n    'click': 'onClick'\n    'click a': 'onClickLink'\n\n  constructor: (options) ->\n    super options\n    @level = options.level\n    @sessionID = options.sessionID\n\n  onClick: (e) ->\n    Backbone.Mediator.publish 'tome:focus-editor', {}\n\n  onClickLink: (e) ->\n    route = $(e.target).attr('href')\n    if route and /item-store/.test route\n      PlayItemsModal = require 'views/play/modal/PlayItemsModal'\n      @openModalView new PlayItemsModal supermodel: @supermodal\n      e.stopPropagation()\n\n  onSpriteDialogue: (e) ->\n    return unless e.message\n    @$el.addClass 'active speaking'\n    $('body').addClass('dialogue-view-active')\n    @setMessage e.message, e.mood, e.responses\n\n    window.tracker?.trackEvent 'Heard Sprite', {message: e.message, label: e.message, ls: @sessionID}\n\n  onDialogueSoundCompleted: ->\n    @$el.removeClass 'speaking'\n\n  onSpriteClearDialogue: ->\n    @$el.removeClass 'active speaking'\n    $('body').removeClass('dialogue-view-active')\n\n  setMessage: (message, mood, responses) ->\n    message = marked message\n    # Fix old HTML icons like <i class='icon-play'></i> in the Markdown\n    message = message.replace /&lt;i class=&#39;(.+?)&#39;&gt;&lt;\\/i&gt;/, \"<i class='$1'></i>\"\n    clearInterval(@messageInterval) if @messageInterval\n    @bubble = $('.dialogue-bubble', @$el)\n    @bubble.removeClass(@lastMood) if @lastMood\n    @lastMood = mood\n    @bubble.text('')\n    group = $('<div class=\"enter secret\"></div>')\n    @bubble.append(group)\n    if responses\n      @lastResponses = responses\n      for response in responses\n        button = $('<button class=\"btn btn-small banner\"></button>').text(response.text)\n        button.addClass response.buttonClass if response.buttonClass\n        group.append(button)\n        response.button = $('button:last', group)\n    else\n      s = $.i18n.t('common.continue', defaultValue: 'Continue')\n      sk = $.i18n.t('play_level.skip_tutorial', defaultValue: 'skip: esc')\n      if not @escapePressed and not @isFullScreen()\n        group.append('<span class=\"hud-hint\">' + sk + '</span>')\n      group.append($('<button class=\"btn btn-small banner with-dot\">' + s + ' <div class=\"dot\"></div></button>'))\n      @lastResponses = null\n    @animator = new DialogueAnimator(message, @bubble)\n    @messageInterval = setInterval(@addMoreMessage, 1000 / 30)  # 30 FPS\n\n  isFullScreen: ->\n    document.fullScreen || document.mozFullScreen || document.webkitIsFullScreen\n\n  addMoreMessage: =>\n    if @animator.done()\n      clearInterval(@messageInterval)\n      @messageInterval = null\n      $('.enter', @bubble).removeClass('secret').css('opacity', 0.0).delay(500).animate({opacity: 1.0}, 500, @animateEnterButton)\n      if @lastResponses\n        buttons = $('.enter button')\n        for response, i in @lastResponses\n          channel = response.channel.replace 'level-set-playing', 'level:set-playing'  # Easier than migrating all those victory buttons.\n          f = (r) => => setTimeout((-> Backbone.Mediator.publish(channel, r.event or {})), 10)\n          $(buttons[i]).click(f(response))\n      else\n        $('.enter', @bubble).click(-> Backbone.Mediator.publish('script:end-current-script', {}))\n      return\n    @animator.tick()\n\n  onShiftSpacePressed: (e) ->\n    @shiftSpacePressed = (@shiftSpacePressed || 0) + 1\n    # We don't need to handle script:end-current-script--that's done--but if we do have\n    # custom buttons, then we need to trigger the one that should fire (the last one).\n    # If we decide that always having the last one fire is bad, we should make it smarter.\n    return unless @lastResponses?.length\n    r = @lastResponses[@lastResponses.length - 1]\n    channel = r.channel.replace 'level-set-playing', 'level:set-playing'\n    _.delay (-> Backbone.Mediator.publish(channel, r.event or {})), 10\n\n  onEscapePressed: (e) ->\n    @escapePressed = true\n\n  animateEnterButton: =>\n    return unless @bubble\n    button = $('.enter', @bubble)\n    dot = $('.dot', button)\n    dot.animate({opacity: 0.2}, 300).animate({opacity: 1.9}, 600, @animateEnterButton)\n\n  destroy: ->\n    clearInterval(@messageInterval) if @messageInterval\n    super()\n"]}