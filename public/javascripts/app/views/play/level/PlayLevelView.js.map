{"version":3,"sources":["app/views/play/level/PlayLevelView.coffee"],"names":[],"mappings":";AAAA;EAAA;;;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,gCAAR;;AACV,KAAM,QAAQ,WAAR,EAAN;;AACD,YAAY,QAAQ,kBAAR;;AACZ,QAAQ,QAAQ,YAAR;;AACR,UAAU,QAAQ,cAAR;;AACT,sBAAuB,QAAQ,kBAAR,EAAvB;;AAGD,UAAU,QAAQ,qBAAR;;AACV,MAAM,QAAQ,SAAR;;AACN,cAAc,QAAQ,uBAAR;;AACd,gBAAgB,QAAQ,2BAAR;;AAChB,WAAW,QAAQ,cAAR;;AACX,cAAc,QAAQ,iBAAR;;AACd,eAAe,QAAQ,qBAAR;;AACf,QAAQ,QAAQ,cAAR;;AACR,iBAAiB,QAAQ,uBAAR;;AACjB,UAAU,QAAQ,gBAAR;;AACV,SAAS,QAAQ,oBAAR;;AACT,cAAc,QAAQ,iBAAR;;AACd,YAAY,QAAQ,yBAAR;;AACZ,cAAc,QAAQ,oBAAR;;AAGd,mBAAmB,QAAQ,oBAAR;;AACnB,mBAAmB,QAAQ,yBAAR;;AACnB,WAAW,QAAQ,iBAAR;;AACX,WAAW,QAAQ,iBAAR;;AACX,UAAU,QAAQ,gBAAR;;AACV,oBAAoB,QAAQ,qBAAR;;AACpB,iBAAiB,QAAQ,kBAAR;;AACjB,oBAAoB,QAAQ,qBAAR;;AACpB,YAAY,QAAQ,kBAAR;;AACZ,iBAAiB,QAAQ,kBAAR;;AACjB,WAAW,QAAQ,iBAAR;;AACX,gBAAgB,QAAQ,iBAAR;;AAChB,eAAe,QAAQ,sBAAR;;AACf,mBAAmB,QAAQ,0BAAR;;AACnB,qBAAqB,QAAQ,4BAAR;;AACrB,sBAAsB,QAAQ,6BAAR;;AACtB,oBAAoB,QAAQ,2BAAR;;AACpB,oBAAoB,QAAQ,uBAAR;;AACpB,eAAe,QAAQ,yBAAR;;AACf,YAAY,QAAQ,aAAR;;AACZ,aAAa,QAAQ,cAAR;;AACb,iBAAiB,QAAQ,kBAAR;;AACjB,mBAAmB,QAAQ,yBAAR;;AAEnB,QAAQ,gBAAR;;AAEA,aAAa;;AAEb,MAAM,CAAC,OAAP,GAAuB;;;0BACrB,KAAI;;0BACJ,WAAU;;0BACV,QAAO;;0BACP,mBAAkB;;0BAClB,kBAAiB;;0BAEjB,gBACE;IAAA,oBAAoB,aAApB;IACA,sBAAsB,eADtB;IAEA,iBAAiB,gBAFjB;IAGA,uBAAuB,gBAHvB;IAIA,2BAA2B,gBAJ3B;IAKA,mBAAmB,YALnB;IAMA,0BAA0B,mBAN1B;IAOA,yBAAyB,kBAPzB;IAQA,mCAAmC,4BARnC;IASA,yBAAyB,YATzB;IAUA,+BAA+B,YAV/B;IAWA,qBAAqB,gBAXrB;IAYA,0BAA0B,uBAZ1B;IAaA,2BAA2B,wBAb3B;IAcA,iBAAiB,gBAdjB;IAeA,gCAAgC,wBAfhC;IAgBA,+BAA+B,uBAhB/B;IAiBA,gBAAgB,eAjBhB;IAkBA,wBAAwB,iBAlBxB;IAmBA,uCAAuC,2BAnBvC;IAoBA,qCAAqC,yBApBrC;IAqBA,uBAAuB,qBArBvB;IAsBA,wBAAwB,iBAtBxB;;;0BAwBF,SACE;IAAA,4BAA4B,eAA5B;IACA,yCAAyC;aAAG,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,kCAA1B,EAA8D,EAA9D;IAAH,CADzC;IAEA,8CAA8C,SAAC,CAAD;aAAO,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,sBAA1B,EAAkD,EAAlD;IAAP,CAF9C;IAGA,uBAAuB,kBAHvB;;;0BAKF,YACE;IAAA,UAAU,SAAV;IACA,OAAO,iBADP;;;EAKW,uBAAC,OAAD,EAAU,OAAV;AACX;IADqB,IAAC,WAAD;;;IACrB,IAAsB,UAAtB;;QAAA,OAAO,CAAC;OAAR;;IACA,+CAAM,OAAN;IAEA,IAAC,SAAD,GAAY,OAAO,CAAC,QAAR,IAAoB,IAAC,iBAAD,CAAkB,QAAlB;IAChC,IAAC,iBAAD,GAAoB,OAAO,CAAC,gBAAR,IAA4B,IAAC,iBAAD,CAAkB,iBAAlB;IAEhD,IAAC,gBAAD,GAAmB,IAAC,iBAAD,CAAkB,KAAlB;IACnB,IAAC,UAAD,GAAa,IAAC,iBAAD,CAAkB,SAAlB;IACb,IAAC,UAAD,GAAa,IAAC,iBAAD,CAAkB,WAAlB;IAEb,IAAC,kBAAD,GAAqB,IAAC,iBAAD,CAAkB,UAAlB;;MACrB,IAAC,qBAAqB,IAAC,QAAO,CAAC;;IAC/B,IAAC,YAAD,GAAmB;IAEnB,EAAE,cAAF,CAAiB,CAAC,MAAlB;IACA,EAAE,MAAF,CAAS,CAAC,EAAV,CAAa,QAAb,EAAuB,IAAC,eAAxB;;SAEmB,CAAE,kBAArB,CAAwC,IAAC,QAAzC;;IAEA,IAAG,IAAC,gBAAJ;MACE,IAAC,WAAU,CAAC,iBAAZ,GAAgC,SAAC,KAAD;AAC9B;uBAAA,KAAK,CAAC,WAAW,CAAC,UAAlB,KAAgC,OAAhC,aAAyC,gBAAzC,aAA2D,aAA3D,aAA0E;MAD5C;MAEhC,IAAI;eAAA;UAAG,KAAe,KAAC,YAAhB;mBAAA,KAAC,KAAD;;QAAH;MAAA;MACJ,WAAW,CAAX,EAAc,GAAd,EAJF;KAAA;MAME,IAAC,KAAD;MACA,KAAsH,IAAC,UAAvH;;cAAmB,CAAE,UAArB,CAAgC,oBAAhC,EAAsD;YAAA,UAAU,YAAV;YAAwB,OAAO,IAAC,QAAhC;YAAyC,OAAO,IAAC,QAAjD;WAAtD;SAAA;OAPF;;EApBW;;0BA6Bb,WAAU,SAAC,KAAD,EAAS,eAAT;AACR;IADS,IAAC,SAAD;IACT,IAAC,WAAU,CAAC,MAAZ,GAAqB,eAAe,CAAC;IACrC,IAAC,WAAU,CAAC,WAAZ,GAA0B,eAAe,CAAC;IAC1C,IAAC,WAAU,CAAC,iBAAZ,GAAgC,eAAe,CAAC;IAEhD,kBAAkB,IAAC,MAAK,CAAC,SAAP,CAAiB;MAAE,YAAD,IAAC,WAAF;MAAe,SAAD,IAAC,QAAf;MAAyB,cAAD,IAAC,aAAzB;MAAuC,UAAU,KAAjD;MAAwD,aAAa,KAArE;KAAjB;;SACd,CAAE,QAAN,CAAe,eAAf;;IACA,IAAG,IAAC,MAAJ;aACE,IAAC,MAAK,CAAC,aAAP,CAAqB,eAArB,EAAsC,KAAtC,EADF;KAAA;aAGE,IAAC,KAAD,GAHF;;EAPQ;;0BAYV,OAAM;AACJ;IAAA,IAAC,cAAD,GAAqB;IACrB,qBAAqB;MAAG,YAAD,IAAC,WAAH;MAAgB,SAAD,IAAC,QAAhB;MAA0B,WAAD,IAAC,UAA1B;MAAsC,mBAAD,IAAC,kBAAtC;MAAyD,MAAM,IAAC,iBAAD,CAAkB,MAAlB,CAA/D;MAA2F,WAAD,IAAC,UAA3F;MAAuG,UAAD,IAAC,SAAvG;MAAkH,kBAAD,IAAC,iBAAlH;;IACrB,IAAG,EAAE,CAAC,aAAH,EAAH;MACE,kBAAkB,CAAC,iBAAnB,GAAuC,GADzC;;IAEA,IAAC,YAAD,GAAmB,gBAAY,kBAAZ;IACnB,IAAC,aAAD,CAAc,IAAC,YAAf,EAA4B,0BAA5B,EAAwD,IAAC,yBAAzD;WACA,IAAC,SAAD,CAAU,IAAC,YAAX,EAAwB,6BAAxB,EAAuD,IAAC,2BAAxD;EAPI;;0BASN,gBAAe,SAAC,CAAD;IACb,IAAU,IAAC,UAAX;AAAA;;IACA,IAAG,CAAC,EAAE,CAAC,SAAH,MAAkB,EAAE,CAAC,SAAH,EAAnB,KAAuC,CAAI,IAAC,SAA5C,IAAyD,CAAI,CAAC,CAAC,KAAK,CAAC,MAAR,CAAe,eAAf,CAAhE;AACE,aAAO,CAAC,CAAC,KAAF,CAAQ;eAAG,WAAW,CAAC,MAAM,CAAC,YAAnB;MAAH,CAAR,EADT;;IAGA,KAAO,CAAC,CAAC,KAAK,CAAC,MAAR,CAAe,SAAf,CAAP;MACE,IAAC,IAAD,GAAW,QAAI;QACZ,aAAD,IAAC,YADY;QAEb,kBAAkB,CAAC,CAAC,KAAK,CAAC,MAAR,CAAe,UAAf,CAFL;OAAJ,EADb;;IAKA,IAAe,IAAC,kBAAhB;aAAA,IAAC,SAAD;;EAVa;;0BAYf,oBAAmB;AACjB;IAAA,IAAU,IAAC,gBAAX;AAAA;;IACA,IAAC,YAAD,GAAmB;IACnB,IAAC,aAAD,GAAgB,IAAC,YAAD,GAAe,IAAC;IAChC,OAAO,CAAC,KAAR,CAAc,0BAAuB,CAAC,CAAC,IAAC,aAAD,GAAgB,IAAjB,CAAsB,CAAC,OAAvB,CAA+B,CAA/B,CAAD,CAAvB,GAA0D,GAAxE;IACA,KAAO,IAAC,UAAR;;WACqB,CAAE,UAArB,CAAgC,qBAAhC,EAAuD;UAAA,UAAU,YAAV;UAAwB,OAAO,IAAC,QAAhC;UAAyC,OAAO,IAAC,QAAjD;UAA0D,cAAc,IAAC,aAAzE;SAAvD;;wDACmB,CAAE,WAArB,CAAiC,IAAC,aAAlC,EAAgD,iBAAhD,EAAmE,IAAC,QAApE,EAA6E,IAAC,QAA9E,WAFF;;EALiB;;0BASnB,eAAc;WAAG,IAAC,SAAD,IAAc,IAAC;EAAlB;;0BAEd,UAAS;AACP,WAAO;IACP,IAAG,WAAW,CAAC,YAAZ,MAA8B,CAAC,EAAE,CAAC,SAAH,EAA/B,IAAiD,CAAC,EAAE,CAAC,SAAH,EAAlD,IAAoE,CAAC,MAAM,CAAC,YAAY,CAAC,OAAzF,IAAoG,CAAC,IAAC,aAAD,EAAxG;AACE,aAAO,EAAE,CAAC,mBAAH,OAA4B,kBADrC;;WAEA;EAJO;;0BAQT,gBAAe;AACb;IAAA,IAAI;IACJ,CAAC,CAAC,KAAF,GAAU,IAAC;WACX;EAHa;;0BAKf,qBAAoB;IAClB,IAAC,IAAG,CAAC,WAAL,CAAiB,QAAjB;WACA,EAAE,MAAF,CAAS,CAAC,OAAV,CAAkB,QAAlB;EAFkB;;0BAIpB,cAAa;AACX;IAAA;;MACA,MAAM,CAAC,sBAAuB;;IAC9B,IAAC,cAAD,CAAe,IAAC,YAAD,GAAmB,qBAAiB;MAAA,YAAY,IAAC,QAAO,CAAC,UAAT,IAAuB,IAAC,UAApC;MAA+C,uFAA6B,IAAC,MAA7E;MAAoF,6FAAiC,IAAC,QAAtH;KAAjB,CAAlC;IACA,IAAC,IAAG,CAAC,IAAL,CAAU,oBAAV,CAA+B,CAAC,IAAhC;IACA,EAAE,MAAF,CAAS,CAAC,QAAV,CAAmB,YAAnB;IACA,IAAsC,IAAC,UAAD,EAAtC;aAAA,EAAE,MAAF,CAAS,CAAC,IAAV,CAAe,WAAf,EAA4B,KAA5B;;EANW;;0BAQb,cAAa;WACX;EADW;;0BAKb,2BAA0B;AAExB;IAAA,IAAC,oBAAD;IACA,uMAAsF;IACtF,IAAC,iBAAD,CAAkB,IAAlB;IACA,IAAC,SAAD;IACA,IAAC,QAAD,CAAS,IAAT;IACA,IAAC,gBAAD;IACA,IAAC,eAAD;IACA,IAAC,WAAD;IACA,IAAC,SAAD;IACA,IAAC,WAAU,CAAC,MAAZ,CAAmB,IAAC,IAApB;WACA,IAAC,kBAAD;EAZwB;;0BAc1B,6BAA4B,SAAC,QAAD;WAC1B,IAAC,YAAW,CAAC,WAAb,CAAyB,QAAzB;EAD0B;;0BAG5B,sBAAqB;AACnB;IAAA,IAAC,QAAD,GAAW,IAAC,YAAW,CAAC;IACxB,IAAC,MAAD,GAAS,IAAC,YAAW,CAAC;IACtB,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAAH;MACE,IAAC,IAAG,CAAC,QAAL,CAAc,SAAd;AACA,aAFF;;IAGA,IAAC,MAAD,GAAS,IAAC,YAAW,CAAC;IACtB,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,UAAd,CAAH;MACE,IAAC,IAAG,CAAC,QAAL,CAAc,UAAd;MACA,IAAC,cAAD,GAAiB,KAAK,CAAC,IAAN,CAAW,IAAC,MAAK,CAAC,UAAlB,EAA8B,yBAA9B;;QACjB,IAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,CAAP,CAAS,kDAAT;;MAClB,IAAC,cAAD,GAAiB,OAAO,IAAC,cAAR,EAAuB;QAAE,UAAU,IAAZ;OAAvB;MACjB,IAAC,gBAAD,CAAiB,6BAAjB,EALF;;IAMA,IAAwB,IAAC,MAAK,CAAC,MAAP,CAAc,MAAd,EAAsB,aAAtB,EAAqC,WAArC,EAAkD,QAAlD,EAA4D,eAA5D,EAA6E,UAA7E,CAAxB;MAAA,IAAC,IAAG,CAAC,QAAL,CAAc,MAAd;;IACA,IAAyB,CAAC,CAAC,GAAF,CAAM,IAAC,MAAK,CAAC,MAAb,EAAqB,SAAC,CAAD;AAAO;aAAA,CAAC,CAAC,CAAC,sBAAF,IAA6B,aAAe,CAAC,CAAC,sBAAjB,mBAA9B,uCAAqF,CAAE;IAA9F,CAArB,KAA4H,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,MAAsB,UAA3K;MAAA,IAAC,IAAG,CAAC,QAAL,CAAc,OAAd;;IAGA,IAAC,aAAD,GAAgB,IAAC,YAAW,CAAC;IAC7B,KAAO,IAAC,MAAK,CAAC,MAAP,CAAc,UAAd,CAAP;MACE,IAAC,uBAAD,GAA0B;AAC1B,WAAe,wCAAf;QACE,IAAC,uBAAsB,CAAC,IAAxB,CAA6B,IAAC,WAAU,CAAC,oBAAZ,CAAiC,CAAjC,CAA7B;AADF,OAFF;;WAIA,IAAC,gBAAD,CAAiB,iCAAjB;EAtBmB;;0BAwBrB,6BAA4B,SAAC,CAAD;AAC1B;IAAA,IAAc,CAAC,CAAC,GAAF,KAAS,IAAC,IAAxB;AAAA;;IACA,KAAc,IAAC,uBAAf;AAAA;;;MACA,IAAC,wBAAwB;;IACzB,mBAAmB,IAAI,CAAC,KAAL,CAAW,MAAM,CAAC,CAAC,QAAnB;AACnB,SAAe,uGAAf;MACE,IAAC,uBAAuB,WAAU,CAAV,CAAY,CAAC,UAArC;AADF;IAEA,IAAC,qBAAD,GAAwB;IACxB,IAAkC,qBAAoB,GAAtD;aAAA,IAAC,uBAAD,GAA0B,KAA1B;;EAR0B;;0BAU5B,mBAAkB,SAAC,MAAD;AAChB;IAAA,iBAAiB;AACjB;AAAA;;MACE,IAAY,cAAa,MAAb,IAAuB,CAAI,MAAvC;AAAA;;MACA,iBAAiB,cAAc,CAAC,MAAf,CAAsB,MAAtB;AAFnB;IAGA,IAAG,CAAC,CAAI,IAAC,QAAO,CAAC,GAAT,CAAa,YAAb,CAAL,+CAAkD,CAAE,GAAf,CAAmB,YAAnB,WAAxC;MACE,IAAC,QAAO,CAAC,GAAT,CAAa,YAAb,EAA2B,IAAC,aAAY,CAAC,GAAd,CAAkB,YAAlB,CAA3B,EADF;;IAEA,yDAA4B,CAAE,GAAf,CAAmB,MAAnB,eAA8B;IAC7C,SAAS,IAAC,QAAO,CAAC,GAAT,CAAa,MAAb,KAAwB;AACjC;;MACE,OAAiB,KAAK,CAAC,KAAN,CAAY,GAAZ,CAAjB,EAAC,eAAD,EAAQ;MACR,+CAAyB;;QACzB,MAAO,UAAU;;MACjB,IAAG,CAAH;QAAU,MAAO,OAAO,OAAd,GAAuB,EAAjC;OAAA;QAAwC,OAAO,MAAO,OAAO,QAA7D;;AAJF;WAKA,IAAC,QAAO,CAAC,GAAT,CAAa,MAAb,EAAqB,MAArB;EAdgB;;0BAgBlB,WAAU;IACR,IAAU,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAAV;AAAA;;IACA,KAAwC,IAAC,IAAzC;AAAA,aAAO,IAAC,kBAAD,GAAqB,KAA5B;;IACA,IAAC,kBAAD,GAAqB;IACrB,IAAC,IAAG,CAAC,QAAL,CAAc,IAAC,MAAK,CAAC,SAAP,CAAiB;MAAE,YAAD,IAAC,WAAF;MAAe,SAAD,IAAC,QAAf;MAAyB,cAAD,IAAC,aAAzB;MAAuC,UAAU,KAAjD;MAAwD,aAAa,KAArE;KAAjB,CAAd;IACA,IAAC,IAAG,CAAC,kBAAL,CAA2B,IAAC,aAAJ,GAAsB,CAAC,IAAC,QAAO,CAAC,EAAV,EAAc,IAAC,aAAY,CAAC,EAA5B,CAAtB,GAA2D,CAAC,IAAC,QAAO,CAAC,EAAV,CAAnF;WACA,IAAC,IAAG,CAAC,gBAAL,CAAsB,IAAC,MAAK,CAAC,QAA7B;EANQ;;0BAQV,UAAS,SAAC,IAAD;IACP,KAAyB,CAAC,CAAC,QAAF,CAAW,IAAX,CAAzB;MAAA,sBAAO,IAAI,CAAE,cAAb;;;MACA,OAAQ;;IACR,EAAE,CAAC,IAAH,GAAU;IACV,IAAC,QAAO,CAAC,GAAT,CAAa,MAAb,EAAqB,IAArB;IACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,gBAA1B,EAA4C;MAAA,MAAM,IAAN;KAA5C;WACA,IAAC,KAAD,GAAQ;EAND;;0BAQT,kBAAiB;AACf;IAAA,IAAC,YAAD,GAAmB,gBAAY,IAAC,MAAb,EAAoB,IAAC,MAAK,CAAC,GAAP,CAAW,OAAX,CAApB,EAAyC,IAAC,KAA1C;yCACf,CAAE,cAAN,CAAqB,IAAC,YAAtB;EAFe;;0BAIjB,cAAa,SAAC,KAAD;IACX,IAAC,MAAK,CAAC,GAAP,CAAW,OAAX,EAAoB,KAApB;IACA,IAAC,YAAW,CAAC,OAAb;WACA,IAAC,gBAAD;EAHW;;0BAKb,qBAAoB,SAAC,KAAD,EAAQ,KAAR;AAClB;IAAA,MAAc,qDAA2B,CAAE,eAAnB,KAA8B,KAAxC,IAAkD,CAAC,KAAK,CAAC,sBAAN,IAAgC,KAAK,CAAC,aAAtC,IAAuD,KAAK,CAAC,0BAA9D,CAAhE;AAAA;;IACA,UAAU,MAAM,CAAC,IAAP,CAAY,KAAK,CAAC,SAAN,EAAZ,KAAkC,CAAI,wBAAwB,CAAC,IAAzB,CAA8B,KAAK,CAAC,SAAN,EAA9B;WAChD,IAAC,iBAAD,GAAoB,IAAC,cAAD,CAAmB,qBAAiB;MAAE,YAAF;MAAU,YAAD,IAAC,WAAV;MAAsB,8BAAc,KAAK,CAAE,OAAP,WAApC;MAAsD,4EAA4B,IAAC,QAAO,CAAC,GAAT,CAAa,cAAb,CAAlF;MAAgH,SAAS,IAAC,QAA1H;MAAmI,OAAO,IAAC,MAA3I;MAAkJ,UAAU,IAAC,SAA7J;MAAuK,kBAAkB,IAAC,iBAA1L;MAA4M,gBAA5M;KAAjB,CAAnB;EAHF;;0BAOpB,iBAAgB;AACd;IAAA,IAAC,WAAD,GAAkB,eAAW;MAAE,QAAQ,IAAV;KAAX,EAA6B;MAAG,SAAD,IAAC,QAAH;MAAa,OAAD,IAAC,MAAb;MAAqB,YAAD,IAAC,WAArB;KAA7B;IAClB,IAAC,cAAD,CAAe,IAAC,KAAD,GAAY,aAAS;MAAG,SAAD,IAAC,QAAH;MAAa,SAAD,IAAC,QAAb;MAAuB,cAAD,IAAC,aAAvB;MAAqC,eAAe,IAApD;MAAuD,mFAAyB,EAAhF;MAAqF,YAAD,IAAC,WAArF;MAAkG,OAAD,IAAC,MAAlG;MAA0G,WAAD,IAAC,UAA1G;MAAsH,UAAD,IAAC,SAAtH;MAAiI,kBAAD,IAAC,iBAAjI;MAAoJ,KAAD,IAAC,IAApJ;MAA0J,YAAD,IAAC,WAA1J;KAAT,CAA3B;IACA,KAA6E,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAA7E;MAAA,IAAC,cAAD,CAAmB,sBAAkB;QAAA,SAAS,IAAC,QAAV;QAAmB,OAAO,IAAC,MAA3B;OAAlB,CAAnB;;IACA,IAAC,cAAD,CAAmB,cAAU;MAAC,OAAO,IAAC,MAAT;KAAV,CAAnB;IACA,IAAsE,IAAC,IAAG,CAAC,QAAL,CAAc,OAAd,CAAtE;MAAA,IAAC,cAAD,CAAmB,mBAAe;QAAA,SAAS,IAAC,QAAV;QAAmB,OAAO,IAAC,MAA3B;OAAf,CAAnB;;IACA,KAAkF,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAAlF;MAAA,YAAsC,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,OAAuB,YAA7D;QAAA,IAAC,cAAD,CAAmB,aAAS,EAAT,CAAnB;OAAA;;IACA,KAAkD,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAAlD;MAAA,IAAC,cAAD,CAAmB,YAAQ;QAAC,OAAO,IAAC,MAAT;OAAR,CAAnB;;IACA,IAAC,cAAD,CAAmB,sBAAkB;MAAC,OAAO,IAAC,MAAT;MAAgB,WAAW,IAAC,QAAO,CAAC,EAApC;KAAlB,CAAnB;IACA,IAAC,cAAD,CAAmB,aAAS;MAAA,SAAS,IAAC,QAAV;MAAmB,WAAW,IAAC,QAAO,CAAC,EAAvC;MAA2C,SAAS,IAAC,QAArD;KAAT,CAAnB;IACA,IAAC,cAAD,CAAmB,qBAAiB;MAAA,SAAS,IAAC,QAAV;MAAmB,OAAO,IAAC,MAA3B;MAAkC,YAAY,IAAC,WAA/C;KAAjB,CAAnB;IACA,IAAkJ,IAAC,MAAK,CAAC,MAAP,CAAc,aAAd,EAA6B,eAA7B,CAAlJ;MAAA,IAAC,cAAD,CAAmB,kBAAc;QAAA,OAAO,IAAC,MAAR;QAAe,SAAS,IAAC,QAAzB;QAAkC,cAAc,IAAC,aAAjD;QAA+D,YAAY,IAAC,WAA5E;QAAwF,QAAQ,IAAC,MAAK,CAAC,MAAvG;OAAd,CAAnB;;IACA,IAAC,cAAD,CAAe,IAAC,WAAD,GAAkB,mBAAe;MAAC,WAAW,KAAK,CAAC,IAAN,CAAW,IAAC,MAAK,CAAC,UAAlB,EAA8B,MAA9B,CAAZ;MAAmD,SAAS,IAAC,QAA7D;MAAsE,OAAO,IAAC,MAA9E;MAAqF,YAAY,IAAC,WAAlG;MAA8G,UAAU,IAAC,SAAzH;MAAmI,kBAAkB,IAAC,iBAAtJ;KAAf,CAAjC;IACA,IAAC,cAAD,CAAe,IAAC,UAAD,GAAiB,cAAU;MAAG,SAAD,IAAC,QAAH;MAAa,OAAD,IAAC,MAAb;MAAqB,YAAD,IAAC,WAArB;KAAV,CAAhC,EAA8E,IAAC,EAAD,CAAG,aAAH,CAA9E;IACA,IAAiF,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAAjF;aAAA,IAAC,cAAD,CAAe,IAAC,WAAD,GAAkB,mBAAe;QAAC,OAAO,IAAC,MAAT;QAAiB,aAAD,IAAC,YAAjB;OAAf,CAAjC;;EAdc;;0BAiBhB,aAAY;AACV;IAAA,SAAS,EAAE,CAAC,GAAH,CAAO,QAAP;IACT,IAAoB,cAApB;MAAA,SAAS,IAAT;;WACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,kBAA1B,EAA8C;MAAA,QAAQ,MAAR;KAA9C;EAHU;;0BAKZ,oBAAmB;IACjB,IAAU,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAAV;AAAA;;IACA,IAAC,cAAD,GAAqB,kBAAc;MAAC,SAAS,IAAC,MAAK,CAAC,OAAP,IAAkB,EAA5B;MAAgC,MAAM,IAAtC;MAAyC,SAAS,IAAC,QAAnD;MAA4D,SAAS,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAArE;KAAd;WACrB,IAAC,cAAa,CAAC,eAAf;EAHiB;;0BAKnB,WAAU;IACR,IAAC,IAAD,GAAO,QAAQ,CAAC,GAAT,CAAa,IAAC,QAAd,EAAuB,IAAC,QAAO,CAAC,EAAhC;IACP,IAAC,IAAG,CAAC,UAAL,CAAgB,IAAC,QAAjB;WACA,IAAC,IAAG,CAAC,SAAL,CAAe,IAAC,KAAI,CAAC,MAArB;EAHQ;;0BAQV,kBAAiB,SAAC,CAAD;AACf;IAAA,IAAU,IAAC,QAAX;AAAA;;IACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,sBAA1B,EAAkD;MAAA,gEAA0C,QAA1C;KAAlD;IAEA,IAAG,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,MAAZ,MAAuB,UAA1B;MACE,WAAW;MACX,IAAG,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,SAAd,MAA4B,0BAA/B;QACE,WAAW,2BADb;;aAEA,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,YAAd,EAA4B;QAAC,aAAY,QAAb;QAAsB,aAAY;UAAC,UAAS,0BAAV;UAAqC,oBAAmB,0BAAxD;UAAmF,UAAS,0BAA5F;UAAuH,QAAO,0BAA9H;UAAyJ,cAAa,0BAAtK;UAAiM,aAAY,0BAA7M;UAAwO,UAAS,0BAAjP;UAA4Q,UAAS,0BAArR;UAAgT,SAAQ,0BAAxT;UAAmV,QAAO,0BAA1V;UAAqX,QAAO,0BAA5X;UAAuZ,QAAO,0BAA9Z;SAAlC;OAA5B,EAJF;KAAA,MAMK,IAAG,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,MAAZ,MAAuB,iBAA1B;MACH,cAAc;aACd,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,YAAd,EAA4B;QAAC,aAAY,WAAb;QAAyB,aAAY;UAC/D,QAAO,0BADwD;UAE/D,QAAO,0BAFwD;UAG/D,QAAO,0BAHwD;UAI/D,SAAQ,0BAJuD;UAK/D,cAAa,0BALkD;UAM/D,oBAAmB,0BAN4C;SAArC;OAA5B,EAFG;KAAA,MAUA,IAAG,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,MAAZ,MAAuB,qBAA1B;MACH,cAAc;aACd,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,YAAd,EAA4B;QAAC,aAAY,WAAb;QAAyB,aAAY;UAC/D,QAAQ,0BADuD;UAE/D,QAAQ,0BAFuD;UAG/D,SAAS,0BAHsD;UAI/D,cAAc,0BAJiD;UAK/D,UAAU,0BALqD;UAM/D,oBAAoB,0BAN2C;UAO/D,aAAa,0BAPkD;SAArC;OAA5B,EAFG;KAAA,MAWA,IAAG,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,MAAZ,MAAuB,eAA1B;MACH,cAAc;aACd,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,YAAd,EAA4B;QAAC,aAAY,WAAb;QAAyB,aAAY;UAC/D,UAAU,0BADqD;UAE/D,QAAQ,0BAFuD;UAG/D,QAAQ,0BAHuD;UAI/D,aAAa,0BAJkD;UAK/D,cAAc,0BALiD;UAM/D,SAAS,0BANsD;UAO/D,oBAAoB,0BAP2C;UAQ/D,UAAU,0BARqD;UAS/D,QAAQ,0BATuD;UAU/D,SAAS,0BAVsD;UAW/D,QAAQ,0BAXuD;SAArC;OAA5B,EAFG;KAAA,MAeA,YAAG,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,MAAZ,OAAwB,eAAxB,aAAyC,gBAA5C;MACH,UAAU;aACV,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,YAAd,EAA4B;QAAC,aAAY,OAAb;QAAqB,aAAY;UAAC,QAAO,0BAAR;UAAmC,QAAO,0BAA1C;UAAqE,UAAS,0BAA9E;UAAyG,QAAO,0BAAhH;UAA2I,UAAS,0BAApJ;UAA+K,oBAAmB,0BAAlM;SAAjC;OAA5B,EAFG;KAAA,MAGA,IAAG,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,MAAZ,MAAuB,wBAA1B;MACH,SAAS;aACT,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,YAAd,EAA4B;QAAC,aAAY,MAAb;QAAoB,aAAY,EAAhC;OAA5B,EAFG;KAAA,MAGA,IAAG,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,MAAZ,MAAuB,gBAA1B;MACH,SAAS;aACT,CAAC,CAAC,OAAO,CAAC,GAAV,CAAc,YAAd,EAA4B;QAAC,aAAY,MAAb;QAAoB,aAAY,EAAhC;OAA5B,EAFG;KAAA,MAGA,IAAG,CAAC,CAAC,KAAK,CAAC,MAAR,CAAe,MAAf,EAAuB,aAAvB,EAAsC,WAAtC,KAAuD,CAAI,CAAC,CAAC,IAAF,kGAAgD,EAAhD,CAA9D;;YACU,CAAE,OAAf;;MACA,IAAC,aAAD,GAAoB,sBAAkB;QAAC,YAAY,IAAC,WAAd;QAA0B,OAAO,CAAC,CAAC,KAAnC;QAA0C,SAAS,IAAC,QAApD;QAA6D,QAAQ,IAArE;QAAwE,SAAS,CAAC,CAAC,OAAnF;QAA4F,UAAU,IAAC,SAAvG;QAAiH,kBAAkB,IAAC,iBAApI;OAAlB;aACpB,IAAC,aAAY,CAAC,IAAd,GAHG;;EAvDU;;0BA4DjB,WAAU;WACR,CAAC,CAAC,KAAF,CAAQ;aAAA;eAAG,KAAC,oBAAD;MAAH;IAAA,QAAR;EADQ;;0BAGV,sBAAqB;AAEnB;IAAA,IAAc,IAAC,YAAW,CAAC,QAAb,OAA2B,CAAzC;AAAA;;IAGA,IAAG,CAAI,IAAC,UAAL,IAAmB,CAAI,CAAC,IAAC,YAAW,CAAC,KAAK,CAAC,MAAnB,CAA0B,QAA1B,EAAoC,iBAApC,CAAD,CAA1B;MACE,EAAE,CAAC,GAAH,CAAO,WAAP,EAAoB,IAAC,QAArB;MACA,EAAE,CAAC,IAAH;;WACmB,CAAE,QAArB;OAHF;;IAIA,IAAsB,IAAC,aAAvB;MAAA,IAAC,gBAAD;;IACA,IAAC,YAAW,CAAC,OAAb;IACA,IAAC,YAAD,GAAe;IACf,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,SAAd,CAAH;aACE,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,eAA1B,EAA2C,EAA3C,EADF;KAAA;aAGE,IAAC,YAAD,GAHF;;EAZmB;;0BAiBrB,kBAAiB;AACf;IAAA,2FAAqE;IACrE,yFAA6D;IAC7D,wBAAyB,KAAC,QAAD,CAAzB,GAAqC;IACrC,KAAyI,CAAC,CAAC,IAAF,CAAO,qBAAP,EAA8B;MAAA,gBAAgB,IAAC,aAAY,CAAC,EAA9B;KAA9B,CAAzI;MAAA,qBAAqB,CAAC,OAAtB,CAA8B;QAAA,UAAU,EAAE,CAAC,IAAb;QAAmB,gBAAgB,IAAC,aAAY,CAAC,EAAjD;QAAqD,cAAc,IAAC,aAAY,CAAC,GAAd,CAAkB,aAAlB,CAAnE;OAA9B;;IACA,qBAAqB,CAAC,MAAtB,CAA6B,CAA7B;WACA,OAAO,CAAC,IAAR,CAAa,yBAAb,EAAwC,wBAAxC;EANe;;0BAQjB,cAAa;AACX;IAAA,eAAe,EAAE,sBAAF,EAA0B,IAAC,IAA3B;IACf,gBAAgB,EAAE,uBAAF,EAA2B,IAAC,IAA5B;IAChB,iBAAiB;MACf,YAAY,IAAC,WAAU,CAAC,SAAZ,CAAsB,SAAtB,CADG;MAEd,WAAD,IAAC,UAFc;MAGf,aAAa,IAAC,gBAAD,EAHE;MAIf,WAAW,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,EAAmB,IAAnB,CAJI;MAKf,aAAa,IAAC,QAAD,EALE;MAMd,aAAD,IAAC,YANc;MAOd,OAAD,IAAC,MAPc;;IASjB,IAAC,QAAD,GAAe,YAAQ,IAAC,MAAT,EAAgB,aAAhB,EAA+B,YAA/B,EAA6C,cAA7C;IACf,cAAc,IAAC,MAAK,CAAC,SAAP;IACd,SAAS;MAAC;QAAC,GAAG,WAAW,CAAC,IAAhB;QAAsB,GAAG,WAAW,CAAC,GAArC;OAAD,EAA4C;QAAC,GAAG,WAAW,CAAC,KAAhB;QAAuB,GAAG,WAAW,CAAC,MAAtC;OAA5C;;IACT,IAAC,QAAO,CAAC,MAAM,CAAC,SAAhB,CAA0B,MAA1B;IACA,IAAC,QAAO,CAAC,MAAM,CAAC,MAAhB,CAAuB;MAAC,GAAG,CAAJ;MAAO,GAAG,CAAV;KAAvB,EAAqC,GAArC,EAA0C,CAA1C;WACA,IAAC,SAAD,CAAU,IAAC,QAAX,EAAoB,QAApB,EAA8B,SAAC,GAAD;AAC5B;MAD+B,SAAF,IAAE;MAC/B,IAAC,EAAD,CAAG,iCAAH,CAAqC,CAAC,GAAtC,CAA0C;QAAE,KAAK,SAAS,EAAhB;OAA1C;aACA,IAAC,EAAD,CAAG,6BAAH,CAAiC,CAAC,GAAlC,CAAsC;QAAE,cAAF;OAAtC;IAF4B,CAA9B;EAjBW;;0BAqBb,kBAAiB;AACf;IAAA,KAAiB,IAAC,MAAK,CAAC,MAAP,CAAc,QAAd,EAAwB,aAAxB,EAAuC,eAAvC,CAAjB;AAAA,aAAO,GAAP;;IACA,cAAc;AACd;AAAA;;4BAA8C,OAAO,CAAE,GAAT,CAAa,MAAb;QAC5C,WAAY,QAAO,CAAC,GAAR,CAAY,MAAZ,EAAZ,GAAmC,OAAO,CAAC,GAAR,CAAY,aAAZ,KAA8B;;AADnE;WAEA;EALe;;0BASjB,iBAAgB;AACd;IAAA,MAAc,0BAAa,yBAA3B;AAAA;;IACA,IAAC,YAAW,CAAC,SAAb;IACA,IAAC,kBAAD;IACA,IAAG,MAAM,CAAC,YAAP,IAAwB,CAAI,MAAM,CAAC,YAAY,CAAC,SAAhD,IAA8D,MAAM,CAAC,YAAY,CAAC,WAApB,KAAqC,YAAtG;AACE,aAAO,QAAQ,CAAC,QAAQ,CAAC,aAAlB,CAAgC,cAAhC,EAAgD,IAAC,eAAjD,EAAiE,IAAjE,EADT;;;SAEQ,CAAE,SAAV;;IACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,gBAA1B,EAA4C;MAAA,MAAM,CAAN;KAA5C;IACA,IAAG,CAAC,IAAC,gBAAD,IAAoB,IAAC,UAAtB,KAAqC,CAAI,IAAC,iBAAD,CAAkB,OAAlB,CAA5C;MACE,IAAC,YAAW,CAAC,cAAb;aACA,IAAC,YAAW,CAAC,MAAb,CAAoB,IAApB,EAFF;KAAA;uDAIgB,CAAE,gBAAhB,YAJF;;EARc;;0BAchB,yBAAwB,SAAC,CAAD;WACtB,IAAC,WAAD;EADsB;;0BAGxB,wBAAuB,SAAC,CAAD;AACrB;IAAA,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,eAAd,EAA+B,aAA/B,KAAiD,IAAC,UAArD;MAEE,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,mBAA1B,EAA+C;QAAA,SAAS,IAAT;OAA/C,EAFF;;IAGA,IAAC,YAAW,CAAC,GAAG,CAAC,MAAjB;IACA,IAAC,cAAD,CAAe,IAAC,YAAhB;IACA,IAAC,YAAD,GAAe;IACf,IAAC,iBAAD;IAEA,KAA2H,IAAC,UAA5H;;WAAmB,CAAE,UAArB,CAAgC,eAAhC,EAAiD;UAAA,UAAS,YAAT;UAAuB,SAAS,IAAC,QAAjC;UAA0C,wCAAY,CAAE,GAAV,CAAc,KAAd,UAA9C;SAAjD;OAAA;;IACA,EAAE,MAAF,CAAS,CAAC,OAAV,CAAkB,QAAlB;WACA,CAAC,CAAC,KAAF,CAAQ,CAAC;aAAA;oEAAG,KAAC;MAAJ;IAAA,QAAD,CAAR,EAAyC,KAAK,IAA9C;EAXqB;;0BAavB,cAAa,SAAC,CAAD;IACX,QAAQ,CAAC,KAAK,CAAC,SAAf,CAA4B,CAAC,CAAC,MAAF,KAAY,CAAf,GAAsB,GAAtB,GAA+B,CAAC,CAAC,MAA1D;IACA,IAAG,CAAC,CAAC,MAAF,IAAa,CAAI,IAAC,aAArB;aACE,IAAC,iBAAD,GADF;;EAFW;;0BAKb,mBAAkB;AAChB;IAAA,IAAU,IAAC,UAAX;AAAA;;IACA,IAAU,IAAC,aAAX;AAAA;;IACA,KAAc,EAAE,CAAC,GAAH,CAAO,QAAP,CAAd;AAAA;;IACA,KAAc,QAAO;MAAC,SAAS,iBAAV;MAA6B,OAAO,eAApC;KAAqD,KAAC,MAAK,CAAC,GAAP,CAAW,SAAX,EAA5D,CAAd;AAAA;;IACA,MAAM,qBAAmB,IAAnB,GAA0B,WAAW,CAAC;IAC5C,sDAAiC,CAAE,gBAAnC;MACE,WAAW,CAAC,YAAZ,CAAyB,GAAzB;MACA,QAAQ,CAAC,QAAQ,CAAC,aAAlB,CAAgC,qBAAhC,EAAuD,IAAC,iBAAxD,EAA0E,IAA1E;AACA,aAHF;;IAIA,IAAC,aAAD,GAAgB,QAAQ,CAAC,KAAK,CAAC,IAAf,CAAoB,GAApB,EAAyB;MAAA,MAAM,CAAC,CAAP;MAAU,QAAQ,GAAlB;KAAzB;WAChB,QAAQ,CAAC,KAAK,CAAC,GAAf,CAAmB,IAAC,aAApB,CAAiC,CAAC,EAAlC,CAAqC;MAAC,QAAQ,GAAT;KAArC,EAAoD,KAApD;EAXgB;;0BAalB,aAAY;AACV;IAAA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,iCAA1B,EAA6D;MAAA,UAAU,IAAV;KAA7D;IACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,4BAA1B,EAAwD,EAAxD;IACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,iCAA1B,EAA6D;MAAA,UAAU,KAAV;KAA7D;6CACQ,CAAE,WAAV;EAJU;;0BAMZ,yBAAwB;IACtB,KAAc,IAAC,eAAD,EAAd;AAAA;;AACA,WAAO,OAAO,CAAC,KAAR,CAAc,sEAAd;WAQP,IAAC,iBAAD;EAVsB;;0BAYxB,mBAAkB;AAChB;IAAA,IAA+C,IAAC,UAAhD;AAAA,aAAO,IAAC,UAAS,CAAC,uBAAX,GAAP;;IACA,mBAAmB;MAAA,YAAY,IAAZ;MAAkB,UAAU,IAAC,iBAA7B;;IACnB,IAAiD,IAAC,MAAK,CAAC,MAAP,CAAc,eAAd,EAA+B,aAA/B,CAAjD;MAAA,gBAAgB,CAAC,OAAjB,GAA2B,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,EAA3B;;IACA,IAAC,UAAD,GAAiB,cAAU,gBAAV;IAEjB,kCAAkC,IAAC,UAAS,CAAC;IAC7C,IAAC,UAAS,CAAC,uBAAX,GAAqC;aAAA;QACnC,IAAG,KAAC,UAAS,CAAC,cAAX,IAA6B,EAAhC;UACE,OAAO,CAAC,GAAR,CAAY,iFAAZ;UACA,KAAC,UAAS,CAAC,OAAX;UACA,KAAC,UAAD,GAAa;iBACb,KAAC,iBAAD,GAJF;SAAA;iBAME,+BAA+B,CAAC,KAAhC,CAAsC,KAAC,UAAvC,EANF;;MADmC;IAAA;WAQrC,IAAC,UAAS,CAAC,uBAAX;EAfgB;;0BAiBlB,iBAAgB;AACd;IAAA,IAAe,IAAC,iBAAD,CAAkB,UAAlB,MAAiC,IAAhD;AAAA,aAAO,KAAP;;IACA,IAAgB,IAAC,iBAAD,CAAkB,UAAlB,MAAiC,KAAjD;AAAA,aAAO,MAAP;;IACA,aAAa;IACb,eAAe;IACf,QAAQ,MAAM,CAAC,SAAS,CAAC,mBAAjB,IAAwC;IAChD,mBAAmB;IACnB,oFAAsC,CAAE,kCAA5B,IAA+C;IAC3D,iBAAiB,EAAE,CAAC,GAAH,CAAO,aAAP;IACjB,OAAO,CAAC,KAAR,CAAc,oCAAd,EAAoD,MAAM,CAAC,SAAS,CAAC,mBAArE,EAA0F,aAA1F,2EAAmI,CAAE,iCAArI,EAAsJ,gBAAtJ,EAAwK,IAAC,aAAzK;IACA,uCAA6B,CAAE,iBAA/B;AAAA,aAAO,MAAP;;IACA,sCAAyB,CAAE,cAAX,sCAA4B,CAAE,gBAA9C;AAAA,aAAO,MAAP;;IACA,IAAgB,CAAC,CAAC,OAAO,CAAC,KAA1B;AAAA,aAAO,MAAP;;IACA,IAAgB,EAAE,CAAC,KAAH,KAAa,CAA7B;AAAA,aAAO,MAAP;;IACA,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,QAAd,EAAwB,UAAxB,EAAoC,SAApC,CAAH;AACE,aAAO,MADT;KAAA,MAEK,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,MAAd,KAA0B,cAA7B;MACH,IAAgB,UAAhB;AAAA,eAAO,MAAP;;MACA,IAAgB,QAAQ,CAAxB;AAAA,eAAO,MAAP;;MACA,IAAgB,YAAY,gBAA5B;AAAA,eAAO,MAAP;;MACA,IAAgB,IAAC,aAAD,GAAgB,KAAhC;AAAA,eAAO,MAAP;OAJG;KAAA,MAKA,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,aAAd,KAAiC,cAApC;MACH,IAAgB,UAAhB;AAAA,eAAO,MAAP;;MACA,IAAgB,QAAQ,CAAxB;AAAA,eAAO,MAAP;;MACA,IAAgB,YAAY,gBAA5B;AAAA,eAAO,MAAP;;MACA,IAAgB,IAAC,aAAD,GAAgB,KAAhC;AAAA,eAAO,MAAP;OAJG;KAAA,MAKA,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,aAAd,KAAiC,CAAI,cAAxC;MACH,IAAgB,UAAhB;AAAA,eAAO,MAAP;;MACA,IAAgB,QAAQ,CAAxB;AAAA,eAAO,MAAP;;MACA,IAAgB,aAAa,gBAA7B;AAAA,eAAO,MAAP;;MACA,IAAgB,IAAC,aAAD,GAAgB,KAAhC;AAAA,eAAO,MAAP;OAJG;KAAA,MAKA,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,eAAd,CAAH;MACH,IAAgB,SAAS,YAAzB;AAAA,eAAO,MAAP;;MACA,IAAgB,YAAY,gBAA5B;AAAA,eAAO,MAAP;;MACA,IAAgB,IAAC,aAAD,GAAgB,KAAhC;AAAA,eAAO,MAAP;OAHG;KAAA;MAKH,OAAO,CAAC,IAAR,CAAa,kFAA+E,CAAC,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAAD,CAA/E,GAAmG,GAAhH;MACA,IAAgB,UAAhB;AAAA,eAAO,MAAP;;MACA,IAAgB,QAAQ,CAAxB;AAAA,eAAO,MAAP;;MACA,IAAgB,YAAY,gBAA5B;AAAA,eAAO,MAAP;;MACA,IAAgB,IAAC,aAAD,GAAgB,KAAhC;AAAA,eAAO,MAAP;OATG;;IAUL,OAAO,CAAC,KAAR,CAAc,+DAAd;WACA;EA1Cc;;0BA8ChB,UAAS,SAAC,CAAD;WACP,CAAC,CAAC,cAAF;EADO;;0BAGT,kBAAiB,SAAC,CAAD;IACf,KAAc,IAAC,IAAG,CAAC,QAAL,CAAc,WAAd,CAAd;AAAA;;WACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,kCAA1B,EAA8D,EAA9D;EAFe;;0BAIjB,wBAAuB,SAAC,CAAD;AACrB;IAAA,WAAW,QAAQ,IAAC,MAAT;IACX,IAAG,QAAH;AAEE;AAAA;;YAA2E,CAAI,CAAC,CAAC,UAAU,CAAC,MAAO;UAAnG,CAAC,CAAC,UAAU,CAAC,aAAb,CAA2B,KAA3B;;AAAA,OAFF;;IAGA,IAAC,SAAD,CAAU,CAAC,CAAC,KAAZ,EAAmB,CAAC,CAAC,UAArB;IACA,IAAG,QAAH;MACE,IAAC,cAAa,CAAC,UAAf,CAA0B,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,SAAZ,CAA1B;MACA,IAAC,YAAD,CAAa,CAAC,CAAC,KAAK,CAAC,GAAR,CAAY,OAAZ,CAAb;aACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,iBAA1B,EAA6C,EAA7C,EAHF;;EANqB;;0BAWvB,yBAAwB,SAAC,CAAD;AACtB;IAAA,KAAK,CAAC,CAAC;AACP;AAAA;;MACE,IAAG,KAAK,CAAC,EAAN,KAAY,EAAE,CAAC,EAAlB;AACE;AAAA;;UACE,KAAK,CAAC,UAAW,KAAjB,GAAwB;AAD1B;AAEA,cAHF;;AADF;WAKA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,iBAA1B,EAA6C,EAA7C;EAPsB;;0BASxB,iBAAgB,SAAC,CAAD;WACd,IAAC,aAAD;EADc;;0BAGhB,oBAAmB,SAAC,CAAD;IACjB,IAAU,CAAC,CAAC,QAAF,IAAe,CAAI,CAAC,aAAW,CAAC,CAAC,QAAb,eAAD,CAA7B;AAAA;;IACA,IAAC,iBAAD,GAAoB;IACpB,IAAC,aAAD,GAAgB,QAAQ,CAAC;WACzB,EAAE,MAAF,CAAS,CAAC,KAAV;EAJiB;;0BAMnB,mBAAkB,SAAC,CAAD;IAChB,IAAU,wBAAgB,CAAI,CAAC,aAAW,CAAC,CAAC,QAAb,eAAD,CAA9B;AAAA;;IACA,IAAC,iBAAD,GAAoB;IACpB,IAA4B,IAAC,aAA7B;MAAA,EAAE,IAAC,aAAH,CAAgB,CAAC,KAAjB;;WACA,IAAC,aAAD,GAAgB;EAJA;;0BAMlB,gBAAe;WAAG,IAAC,YAAD;EAAH;;0BAEf,gBAAe,SAAC,CAAD;AACb;;MADc,IAAE;;IAChB,KAAsC,IAAC,MAAK,CAAC,MAAP,CAAc,MAAd,EAAsB,aAAtB,EAAqC,WAArC,EAAkD,QAAlD,EAA4D,eAA5D,EAA6E,UAA7E,EAAyF,SAAzF,CAAtC;MAAA,EAAE,oBAAF,CAAuB,CAAC,IAAxB;;IACA,IAAqC,CAAC,CAAC,SAAvC;MAAA,IAAC,YAAD,CAAa,CAAC,CAAC,IAAF,CAAO,CAAP,EAAU,QAAV,CAAb;;IACA,IAAU,IAAC,YAAX;AAAA;;IACA,IAAC,YAAD,GAAe;IACf,cAAc,CAAK,UAAL,IAAe,IAAC;IAC9B,IAAG,CAAI,IAAC,UAAL,IAAmB,cAAc,KAAK,IAAzC;;WACqB,CAAE,UAArB,CAAgC,aAAhC,EACE;UAAA,UAAU,YAAV;UACA,OAAO,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CADP;UAEA,OAAO,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAFP;UAGA,SAAS,IAAC,QAHV;UAIA,wCAAY,CAAE,GAAV,CAAc,KAAd,UAJJ;SADF;;wDAMmB,CAAE,WAArB,CAAiC,WAAjC,EAA8C,oBAA9C,EAAoE,IAAC,QAArE,EAA8E,IAAC,QAA/E,WAPF;;EANa;;0BAef,cAAa,SAAC,OAAD;AACX;;MADY,UAAQ;;IACpB,IAAU,IAAC,MAAK,CAAC,eAAP,EAAV;AAAA;;IACA,IAAU,IAAC,MAAK,CAAC,MAAP,CAAc,UAAd,KAA8B,IAAC,MAAK,CAAC,GAAP,CAAW,WAAX,CAA9B,IAA0D,CAAI,OAAO,CAAC,MAAhF;AAAA;;IACA,IAAC,aAAD;IACA,UAAU;MAAC,OAAO,IAAC,MAAT;MAAgB,YAAY,IAAC,WAA7B;MAAyC,SAAS,IAAC,QAAnD;MAA4D,0BAA0B,IAAC,yBAAvF;MAAiH,UAAU,IAAC,SAA5H;MAAsI,kBAAkB,IAAC,iBAAzJ;MAA2K,OAAO,IAAC,MAAnL;;IACV,aAAgB,IAAC,MAAK,CAAC,MAAP,CAAc,MAAd,EAAsB,aAAtB,EAAqC,WAArC,EAAkD,QAAlD,EAA4D,eAA5D,EAA6E,UAA7E,EAAyF,SAAzF,CAAH,GAA4G,gBAA5G,GAAkI;IAC/I,IAAmC,IAAC,aAAD,MAAmB,EAAE,CAAC,aAAH,EAAtD;MAAA,aAAa,mBAAb;;IACA,IAAG,IAAC,MAAK,CAAC,MAAP,CAAc,eAAd,CAAH;MACE,aAAa;MACb,OAAO,CAAC,gBAAR,GAA2B,IAAC,iBAAD,CAAkB,iBAAlB,KAAwC,IAAC,iBAAD,CAAkB,QAAlB,EAFrE;;IAGA,IAAoC,MAAM,CAAC,YAAY,CAAC,OAAxD;MAAA,aAAa,oBAAb;;IACA,eAAmB,eAAW,OAAX;IACnB,IAAC,cAAD,CAAe,YAAf;IACA,IAAG,EAAE,CAAC,GAAH,CAAO,WAAP,CAAH;aACE,MAAM,CAAC,OAAP,GAAiB,WAAW,oDAA0B,EAA1B,EAD9B;;EAbW;;0BAgBb,iBAAgB;AACd;IAAA,IAAC,KAAI,CAAC,aAAN;IACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,iBAA1B,EAA6C,EAA7C;IACA,EAAE,oBAAF,EAAwB,IAAC,IAAzB,CAA6B,CAAC,IAA9B;IACA,KAAyI,IAAC,UAA1I;sDAAmB,CAAE,UAArB,CAAgC,mBAAhC,EAAqD;QAAA,UAAU,YAAV;QAAwB,OAAO,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAA/B;QAAmD,OAAO,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAA1D;OAArD;;EAJc;;0BAMhB,iBAAgB,SAAC,CAAD;AACd;IAAA,MAAc,CAAC,CAAC,UAAF,IAAiB,CAAC,CAAC,GAAF,KAAS,IAAC,IAAzC;AAAA;;IACA,IAAC,cAAD,CAAmB,sBAAkB;MAAA,oBAAoB,CAAC,CAAC,kBAAtB;KAAlB,CAAnB;IACA,KAAiJ,IAAC,UAAlJ;sDAAmB,CAAE,UAArB,CAAgC,2BAAhC,EAA6D;QAAA,UAAU,YAAV;QAAwB,OAAO,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAA/B;QAAmD,OAAO,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,CAA1D;OAA7D;;EAHc;;0BAKhB,iBAAgB,SAAC,CAAD;WAAO,IAAC,iBAAD,CAAkB,CAAC,CAAC,QAApB,EAA8B;MAAA,OAAO,CAAC,CAAC,KAAT;MAAgB,OAAO,CAAC,CAAC,KAAzB;MAAgC,QAAQ,CAAC,CAAC,MAA1C;MAAkD,UAAU,CAAC,CAAC,QAA9D;KAA9B;EAAP;;0BAEhB,iBAAgB;WAAG,IAAC,aAAD;EAAH;;0BAEhB,aAAY,SAAC,CAAD;WAAO,EAAE,CAAC,CAAC,QAAJ,CAAa,CAAC,KAAd;EAAP;;0BAEZ,mBAAkB,SAAC,CAAD;AAChB;IAAA,IAAG,EAAE,CAAC,SAAH,EAAH;MACE,OAAO,CAAC,KAAR,CAAc,gCAAd;AACA,aAFF;;IAGA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,8BAA1B,EAA0D,EAA1D;IACA,IAAC,cAAD,CAAe,eAAmB,iBAAa;MAAA,SAAS,IAAC,MAAK,CAAC,GAAP,CAAW,MAAX,KAAsB,IAAC,MAAK,CAAC,EAAtC;MAA0C,UAAU,IAAC,SAArD;MAA+D,kBAAkB,IAAC,iBAAlF;KAAb,CAAlC;IACA,aAAa,IAAC,QAAO,CAAC,UAAT,CAAoB,CAApB,EAAuB,WAAvB,EAAoC,GAApC,EAAyC,CAAzC;IACb,OACE;MAAA,QAAQ,UAAU,CAAC,OAAX,CAAmB,wBAAnB,EAA6C,EAA7C,CAAR;MACA,UAAU,gBAAc,IAAC,QAAf,GAAuB,GAAvB,GAAyB,CAAC,CAAC,CAAC,MAAM,CAAC,OAAT,CAAiB,CAAK,UAAL,CAAY,CAAC,QAAb,EAAjB,CAAD,CAAzB,GAAoE,MAD9E;MAEA,MAAM,aAAW,EAAE,CAAC,EAFpB;MAGA,UAAU,WAHV;;IAIF,YAAY,CAAC,aAAb,GAA6B,gCAA8B,IAAI,CAAC,IAAnC,GAAwC,GAAxC,GAA2C,IAAI,CAAC;IAC7E,MAAM,CAAC,UAAP,GAAoB;IACpB,MAAM,CAAC,aAAP,GAAuB,YAAY,CAAC;WACpC,CAAC,CAAC,IAAF,CAAO,OAAP,EAAgB;MAAA,MAAM,MAAN;MAAc,MAAM,IAApB;MAA0B,SAAS,SAAC,CAAD;qEACjD,YAAY,CAAC;MADoC,CAAnC;KAAhB;EAfgB;;0BAoBlB,aAAY,SAAC,CAAD;AACV;IAAA,IAAU,IAAC,SAAX;AAAA;;IACA,UAAU,IAAC,MAAK,CAAC;IACjB,IAAC,MAAD,GAAS,CAAC,CAAC;IACX,IAAC,MAAK,CAAC,OAAP,GAAiB;IACjB,aAAa,IAAC,WAAU,CAAC,SAAZ,CAAsB,SAAtB;IACb,gEAAsC;IACtC,kBAAkB,IAAC,MAAK,CAAC,MAAM,CAAC,MAAd,KAAwB,IAAC,MAAK,CAAC;IACjD,IAAG,eAAH;MACE,IAAC,sBAAD,GAAyB;MACzB,IAAG,IAAC,6BAAJ;QACE,CAAC,CAAC,KAAF,CAAQ,IAAC,qBAAT;QACA,IAAC,6BAAD,GAAgC,MAFlC;OAFF;KAAA;MAME,IAAC,sBAAD,GAAyB,IAAC,MAAK,CAAC,MAAM,CAAC,OANzC;;AAOA;AAAA;SAAA;sBAAK,sBAAY;MACf,KAAgB,aAAY,CAAC,CAAC,IAAF,CAAO,UAAP,EAAmB,SAAC,CAAD;eAAO,CAAC,CAAC,GAAF,CAAM,MAAN,MAAiB;MAAxB,CAAnB,CAAZ,CAAhB;AAAA;;MACA,KAAgB,SAAQ,WAAW,CAAC,gBAAZ,CAA6B,OAA7B,EAAsC,SAAS,CAAC,GAAV,CAAc,eAAd,CAAtC,CAAR,CAAhB;AAAA;;mBACA,WAAW,CAAC,qBAAZ,CAAkC,KAAlC;AAHF;;EAfU;;0BAqBZ,4BAA2B,SAAC,CAAD;IACzB,IAAC,IAAG,CAAC,QAAL,CAAc,WAAd,CAA0B,CAAC,KAA3B;IACA,IAAyD,IAAC,MAAK,CAAC,MAAP,CAAc,UAAd,CAAzD;MAAA,IAAC,EAAD,CAAG,6BAAH,CAAiC,CAAC,WAAlC,CAA8C,MAA9C;;WACA,IAAC,eAAD;EAHyB;;0BAK3B,0BAAyB,SAAC,CAAD;AACvB;IAAA,KAAc,IAAC,IAAG,CAAC,QAAL,CAAc,WAAd,CAAd;AAAA;;IACA,IAAsD,IAAC,MAAK,CAAC,MAAP,CAAc,UAAd,CAAtD;MAAA,IAAC,EAAD,CAAG,6BAAH,CAAiC,CAAC,QAAlC,CAA2C,MAA3C;;IACA,IAAC,IAAG,CAAC,WAAL,CAAiB,WAAjB;IACA,IAAC,eAAD;IACA,IAAG,IAAC,MAAK,CAAC,MAAM,CAAC,MAAd,KAAwB,IAAC,MAAK,CAAC,WAA/B,IAA+C,oDAA4B,CAAE,iBAAhF;aACE,CAAC,CAAC,KAAF,CAAQ,IAAC,qBAAT,EAA+B,GAA/B,EADF;KAAA;aAGE,IAAC,6BAAD,GAAgC,KAHlC;;EALuB;;0BAUzB,uBAAsB;AACpB;IAAA,IAAU,IAAC,UAAX;AAAA;;IACA,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,gBAA1B,EAA4C;MAAA,OAAO,CAAP;KAA5C;IACA,IAAU,IAAC,MAAK,CAAC,eAAP,EAAV;AAAA;;IACA,IAAG,IAAC,YAAW,CAAC,kBAAb,OAAqC,SAAxC;MACE,cAAc;eAAG,QAAQ,CAAC,QAAQ,CAAC,OAAlB,CAA0B,oBAA1B,EAAgD;UAAA,WAAW,IAAX;SAAhD;MAAH;MACd,IAAC,QAAO,CAAC,YAAT,CAAsB,IAAC,MAAK,CAAC,MAA7B,EAAqC,IAAC,MAAtC;MACA,IAAG,IAAC,MAAK,CAAC,GAAP,CAAW,YAAX,CAAH;eACE,IAAC,QAAO,CAAC,kBAAT,CAA4B,WAA5B,EADF;OAAA;eAGE,cAHF;OAHF;;EAJoB;;0BAYtB,UAAS;AACP;;SAAY,CAAE,OAAd;;;UACQ,CAAE,OAAV;;;UACI,CAAE,OAAN;;;UACY,CAAE,OAAd;;;UACc,CAAE,OAAhB;;;UACa,CAAE,OAAf;;;UACU,CAAE,OAAZ;;IACA,IAAG,eAAe,IAAC,aAAnB;MAEE,QAAQ,CAAC,KAAK,CAAC,GAAf,CAAmB,YAAnB,CAAgC,CAAC,EAAjC,CAAoC;QAAC,QAAQ,GAAT;OAApC,EAAmD,IAAnD,CAAwD,CAAC,IAAzD,CAA8D;eAAG,YAAY,CAAC,IAAb;MAAH,CAA9D,EAFF;;IAGA,EAAE,MAAF,CAAS,CAAC,GAAV,CAAc,QAAd,EAAwB,IAAC,eAAzB;IACA,OAAO,MAAM,CAAC;;UACV,CAAE,OAAN;;IAEA,OAAO,MAAM,CAAC;IACd,IAAyB,UAAzB;;QAAA,OAAO,CAAC;OAAR;;;UACmB,CAAE,mBAArB;;WACA;EAlBO;;0BAoBT,sBAAqB,SAAC,CAAD;WACnB,IAAC,yBAAD,GAA4B;EADT;;0BAGrB,kBAAiB,SAAC,CAAD;AACf;IAAA,oEAA0C;IAC1C,2DAAmC;IACnC,OAAO,CAAC,CAAC,IAAI,CAAC,eAAP,EAAyB;IAChC,IAAG,QAAS,CAAI,SAAU,MAA1B;;YAEe,CAAE,OAAf;;MACA,IAAC,aAAD,GAAoB,sBAAkB;QAAC,YAAY,IAAC,WAAd;QAA0B,OAAO,IAAC,MAAlC;QAAyC,SAAS,IAAC,QAAnD;QAA4D,QAAQ,IAApE;QAAuE,SAAS,IAAC,QAAjF;QAA0F,mBAAmB,IAA7G;OAAlB;aACpB,IAAC,aAAY,CAAC,IAAd,GAJF;;EAJe;;;;GAvsB0B","file":"public/javascripts/app/views/play/level/PlayLevelView.js","sourcesContent":["RootView = require 'views/core/RootView'\ntemplate = require 'templates/play/play-level-view'\n{me} = require 'core/auth'\nThangType = require 'models/ThangType'\nutils = require 'core/utils'\nstorage = require 'core/storage'\n{createAetherOptions} = require 'lib/aether_utils'\n\n# tools\nSurface = require 'lib/surface/Surface'\nGod = require 'lib/God'\nGoalManager = require 'lib/world/GoalManager'\nScriptManager = require 'lib/scripts/ScriptManager'\nLevelBus = require 'lib/LevelBus'\nLevelLoader = require 'lib/LevelLoader'\nLevelSession = require 'models/LevelSession'\nLevel = require 'models/Level'\nLevelComponent = require 'models/LevelComponent'\nArticle = require 'models/Article'\nCamera = require 'lib/surface/Camera'\nAudioPlayer = require 'lib/AudioPlayer'\nSimulator = require 'lib/simulator/Simulator'\nGameUIState = require 'models/GameUIState'\n\n# subviews\nLevelLoadingView = require './LevelLoadingView'\nProblemAlertView = require './tome/ProblemAlertView'\nTomeView = require './tome/TomeView'\nChatView = require './LevelChatView'\nHUDView = require './LevelHUDView'\nLevelDialogueView = require './LevelDialogueView'\nControlBarView = require './ControlBarView'\nLevelPlaybackView = require './LevelPlaybackView'\nGoalsView = require './LevelGoalsView'\nLevelFlagsView = require './LevelFlagsView'\nGoldView = require './LevelGoldView'\nDuelStatsView = require './DuelStatsView'\nVictoryModal = require './modal/VictoryModal'\nHeroVictoryModal = require './modal/HeroVictoryModal'\nCourseVictoryModal = require './modal/CourseVictoryModal'\nPicoCTFVictoryModal = require './modal/PicoCTFVictoryModal'\nInfiniteLoopModal = require './modal/InfiniteLoopModal'\nLevelSetupManager = require 'lib/LevelSetupManager'\nContactModal = require 'views/core/ContactModal'\nHintsView = require './HintsView'\nHintsState = require './HintsState'\nWebSurfaceView = require './WebSurfaceView'\nSpellPaletteView = require './tome/SpellPaletteView'\n\nrequire 'game-libraries'\n\nPROFILE_ME = false\n\nmodule.exports = class PlayLevelView extends RootView\n  id: 'level-view'\n  template: template\n  cache: false\n  shortcutsEnabled: true\n  isEditorPreview: false\n\n  subscriptions:\n    'level:set-volume': 'onSetVolume'\n    'level:show-victory': 'onShowVictory'\n    'level:restart': 'onRestartLevel'\n    'level:highlight-dom': 'onHighlightDOM'\n    'level:end-highlight-dom': 'onEndHighlight'\n    'level:focus-dom': 'onFocusDom'\n    'level:disable-controls': 'onDisableControls'\n    'level:enable-controls': 'onEnableControls'\n    'god:world-load-progress-changed': 'onWorldLoadProgressChanged'\n    'god:new-world-created': 'onNewWorld'\n    'god:streaming-world-updated': 'onNewWorld'\n    'god:infinite-loop': 'onInfiniteLoop'\n    'level:reload-from-data': 'onLevelReloadFromData'\n    'level:reload-thang-type': 'onLevelReloadThangType'\n    'level:started': 'onLevelStarted'\n    'level:loading-view-unveiling': 'onLoadingViewUnveiling'\n    'level:loading-view-unveiled': 'onLoadingViewUnveiled'\n    'level:loaded': 'onLevelLoaded'\n    'level:session-loaded': 'onSessionLoaded'\n    'playback:real-time-playback-started': 'onRealTimePlaybackStarted'\n    'playback:real-time-playback-ended': 'onRealTimePlaybackEnded'\n    'ipad:memory-warning': 'onIPadMemoryWarning'\n    'store:item-purchased': 'onItemPurchased'\n\n  events:\n    'click #level-done-button': 'onDonePressed'\n    'click #stop-real-time-playback-button': -> Backbone.Mediator.publish 'playback:stop-real-time-playback', {}\n    'click #fullscreen-editor-background-screen': (e) -> Backbone.Mediator.publish 'tome:toggle-maximize', {}\n    'click .contact-link': 'onContactClicked'\n\n  shortcuts:\n    'ctrl+s': 'onCtrlS'\n    'esc': 'onEscapePressed'\n\n  # Initial Setup #############################################################\n\n  constructor: (options, @levelID) ->\n    console.profile?() if PROFILE_ME\n    super options\n\n    @courseID = options.courseID or @getQueryVariable 'course'\n    @courseInstanceID = options.courseInstanceID or @getQueryVariable 'course-instance'\n\n    @isEditorPreview = @getQueryVariable 'dev'\n    @sessionID = @getQueryVariable 'session'\n    @observing = @getQueryVariable 'observing'\n\n    @opponentSessionID = @getQueryVariable('opponent')\n    @opponentSessionID ?= @options.opponent\n    @gameUIState = new GameUIState()\n\n    $('flying-focus').remove() #Causes problems, so yank it out for play view.\n    $(window).on 'resize', @onWindowResize\n\n    application.tracker?.enableInspectletJS(@levelID)\n\n    if @isEditorPreview\n      @supermodel.shouldSaveBackups = (model) ->  # Make sure to load possibly changed things from localStorage.\n        model.constructor.className in ['Level', 'LevelComponent', 'LevelSystem', 'ThangType']\n      f = => @load() unless @levelLoader  # Wait to see if it's just given to us through setLevel.\n      setTimeout f, 100\n    else\n      @load()\n      application.tracker?.trackEvent 'Started Level Load', category: 'Play Level', level: @levelID, label: @levelID unless @observing\n\n  setLevel: (@level, givenSupermodel) ->\n    @supermodel.models = givenSupermodel.models\n    @supermodel.collections = givenSupermodel.collections\n    @supermodel.shouldSaveBackups = givenSupermodel.shouldSaveBackups\n\n    serializedLevel = @level.serialize {@supermodel, @session, @otherSession, headless: false, sessionless: false}\n    @god?.setLevel serializedLevel\n    if @world\n      @world.loadFromLevel serializedLevel, false\n    else\n      @load()\n\n  load: ->\n    @loadStartTime = new Date()\n    levelLoaderOptions = { @supermodel, @levelID, @sessionID, @opponentSessionID, team: @getQueryVariable('team'), @observing, @courseID, @courseInstanceID }\n    if me.isSessionless()\n      levelLoaderOptions.fakeSessionConfig = {}\n    @levelLoader = new LevelLoader levelLoaderOptions\n    @listenToOnce @levelLoader, 'world-necessities-loaded', @onWorldNecessitiesLoaded\n    @listenTo @levelLoader, 'world-necessity-load-failed', @onWorldNecessityLoadFailed\n\n  onLevelLoaded: (e) ->\n    return if @destroyed\n    if (me.isStudent() or me.isTeacher()) and not @courseID and not e.level.isType('course-ladder')\n      return _.defer -> application.router.redirectHome()\n\n    unless e.level.isType('web-dev')\n      @god = new God({\n        @gameUIState\n        indefiniteLength: e.level.isType('game-dev')\n      })\n    @setupGod() if @waitingToSetUpGod\n\n  trackLevelLoadEnd: ->\n    return if @isEditorPreview\n    @loadEndTime = new Date()\n    @loadDuration = @loadEndTime - @loadStartTime\n    console.debug \"Level unveiled after #{(@loadDuration / 1000).toFixed(2)}s\"\n    unless @observing\n      application.tracker?.trackEvent 'Finished Level Load', category: 'Play Level', label: @levelID, level: @levelID, loadDuration: @loadDuration\n      application.tracker?.trackTiming @loadDuration, 'Level Load Time', @levelID, @levelID\n\n  isCourseMode: -> @courseID and @courseInstanceID\n\n  showAds: ->\n    return false # No ads for now.\n    if application.isProduction() && !me.isPremium() && !me.isTeacher() && !window.serverConfig.picoCTF && !@isCourseMode()\n      return me.getCampaignAdsGroup() is 'leaderboard-ads'\n    false\n\n  # CocoView overridden methods ###############################################\n\n  getRenderData: ->\n    c = super()\n    c.world = @world\n    c\n\n  toggleSpellPalette: ->\n    @$el.toggleClass 'no-api'\n    $(window).trigger 'resize'\n\n  afterRender: ->\n    super()\n    window.onPlayLevelViewLoaded? @  # still a hack\n    @insertSubView @loadingView = new LevelLoadingView autoUnveil: @options.autoUnveil or @observing, level: @levelLoader?.level ? @level, session: @levelLoader?.session ? @session  # May not have @level loaded yet\n    @$el.find('#level-done-button').hide()\n    $('body').addClass('is-playing')\n    $('body').bind('touchmove', false) if @isIPadApp()\n\n  afterInsert: ->\n    super()\n\n  # Partially Loaded Setup ####################################################\n\n  onWorldNecessitiesLoaded: ->\n    # Called when we have enough to build the world, but not everything is loaded\n    @grabLevelLoaderData()\n    team = @getQueryVariable('team') ?  @session.get('team') ? @world?.teamForPlayer(0) ? 'humans'\n    @loadOpponentTeam(team)\n    @setupGod()\n    @setTeam team\n    @initGoalManager()\n    @insertSubviews()\n    @initVolume()\n    @register()\n    @controlBar.setBus(@bus)\n    @initScriptManager()\n\n  onWorldNecessityLoadFailed: (resource) ->\n    @loadingView.onLoadError(resource)\n\n  grabLevelLoaderData: ->\n    @session = @levelLoader.session\n    @level = @levelLoader.level\n    if @level.isType('web-dev')\n      @$el.addClass 'web-dev'  # Hide some of the elements we won't be using\n      return\n    @world = @levelLoader.world\n    if @level.isType('game-dev')\n      @$el.addClass 'game-dev'\n      @howToPlayText = utils.i18n(@level.attributes, 'studentPlayInstructions')\n      @howToPlayText ?= $.i18n.t('play_game_dev_level.default_student_instructions')\n      @howToPlayText = marked(@howToPlayText, { sanitize: true })\n      @renderSelectors('#how-to-play-game-dev-panel')\n    @$el.addClass 'hero' if @level.isType('hero', 'hero-ladder', 'hero-coop', 'course', 'course-ladder', 'game-dev')  # TODO: figure out what this does and comment it\n    @$el.addClass 'flags' if _.any(@world.thangs, (t) -> (t.programmableProperties and 'findFlags' in t.programmableProperties) or t.inventory?.flag) or @level.get('slug') is 'sky-span'\n    # TODO: Update terminology to always be opponentSession or otherSession\n    # TODO: E.g. if it's always opponent right now, then variable names should be opponentSession until we have coop play\n    @otherSession = @levelLoader.opponentSession\n    unless @level.isType('game-dev')\n      @worldLoadFakeResources = []  # first element (0) is 1%, last (99) is 100%\n      for percent in [1 .. 100]\n        @worldLoadFakeResources.push @supermodel.addSomethingResource 1\n    @renderSelectors '#stop-real-time-playback-button'\n\n  onWorldLoadProgressChanged: (e) ->\n    return unless e.god is @god\n    return unless @worldLoadFakeResources\n    @lastWorldLoadPercent ?= 0\n    worldLoadPercent = Math.floor 100 * e.progress\n    for percent in [@lastWorldLoadPercent + 1 .. worldLoadPercent] by 1\n      @worldLoadFakeResources[percent - 1].markLoaded()\n    @lastWorldLoadPercent = worldLoadPercent\n    @worldFakeLoadResources = null if worldLoadPercent is 100  # Done, don't need to watch progress any more.\n\n  loadOpponentTeam: (myTeam) ->\n    opponentSpells = []\n    for spellTeam, spells of @session.get('teamSpells') ? @otherSession?.get('teamSpells') ? {}\n      continue if spellTeam is myTeam or not myTeam\n      opponentSpells = opponentSpells.concat spells\n    if (not @session.get('teamSpells')) and @otherSession?.get('teamSpells')\n      @session.set('teamSpells', @otherSession.get('teamSpells'))\n    opponentCode = @otherSession?.get('code') or {}\n    myCode = @session.get('code') or {}\n    for spell in opponentSpells\n      [thang, spell] = spell.split '/'\n      c = opponentCode[thang]?[spell]\n      myCode[thang] ?= {}\n      if c then myCode[thang][spell] = c else delete myCode[thang][spell]\n    @session.set('code', myCode)\n\n  setupGod: ->\n    return if @level.isType('web-dev')\n    return @waitingToSetUpGod = true unless @god\n    @waitingToSetUpGod = undefined\n    @god.setLevel @level.serialize {@supermodel, @session, @otherSession, headless: false, sessionless: false}\n    @god.setLevelSessionIDs if @otherSession then [@session.id, @otherSession.id] else [@session.id]\n    @god.setWorldClassMap @world.classMap\n\n  setTeam: (team) ->\n    team = team?.team unless _.isString team\n    team ?= 'humans'\n    me.team = team\n    @session.set 'team', team\n    Backbone.Mediator.publish 'level:team-set', team: team  # Needed for scripts\n    @team = team\n\n  initGoalManager: ->\n    @goalManager = new GoalManager(@world, @level.get('goals'), @team)\n    @god?.setGoalManager @goalManager\n\n  updateGoals: (goals) ->\n    @level.set 'goals', goals\n    @goalManager.destroy()\n    @initGoalManager()\n\n  updateSpellPalette: (thang, spell) ->\n    return unless thang and @spellPaletteView?.thang isnt thang and (thang.programmableProperties or thang.apiProperties or thang.programmableHTMLProperties)\n    useHero = /hero/.test(spell.getSource()) or not /(self[\\.\\:]|this\\.|\\@)/.test(spell.getSource())\n    @spellPaletteView = @insertSubView new SpellPaletteView { thang, @supermodel, programmable: spell?.canRead(), language: spell?.language ? @session.get('codeLanguage'), session: @session, level: @level, courseID: @courseID, courseInstanceID: @courseInstanceID, useHero }\n    #@spellPaletteView.toggleControls {}, spell.view.controlsEnabled if spell?.view   # TODO: know when palette should have been disabled but didn't exist\n\n\n  insertSubviews: ->\n    @hintsState = new HintsState({ hidden: true }, { @session, @level, @supermodel })\n    @insertSubView @tome = new TomeView { @levelID, @session, @otherSession, playLevelView: @, thangs: @world?.thangs ? [], @supermodel, @level, @observing, @courseID, @courseInstanceID, @god, @hintsState }\n    @insertSubView new LevelPlaybackView session: @session, level: @level unless @level.isType('web-dev')\n    @insertSubView new GoalsView {level: @level}\n    @insertSubView new LevelFlagsView levelID: @levelID, world: @world if @$el.hasClass 'flags'\n    @insertSubView new GoldView {} unless @level.get('slug') in ['wakka-maul'] unless @level.isType('web-dev')\n    @insertSubView new HUDView {level: @level} unless @level.isType('web-dev')\n    @insertSubView new LevelDialogueView {level: @level, sessionID: @session.id}\n    @insertSubView new ChatView levelID: @levelID, sessionID: @session.id, session: @session\n    @insertSubView new ProblemAlertView session: @session, level: @level, supermodel: @supermodel\n    @insertSubView new DuelStatsView level: @level, session: @session, otherSession: @otherSession, supermodel: @supermodel, thangs: @world.thangs if @level.isType('hero-ladder', 'course-ladder')\n    @insertSubView @controlBar = new ControlBarView {worldName: utils.i18n(@level.attributes, 'name'), session: @session, level: @level, supermodel: @supermodel, courseID: @courseID, courseInstanceID: @courseInstanceID}\n    @insertSubView @hintsView = new HintsView({ @session, @level, @hintsState }), @$('.hints-view')\n    @insertSubView @webSurface = new WebSurfaceView {level: @level, @goalManager} if @level.isType('web-dev')\n    #_.delay (=> Backbone.Mediator.publish('level:set-debug', debug: true)), 5000 if @isIPadApp()   # if me.displayName() is 'Nick'\n\n  initVolume: ->\n    volume = me.get('volume')\n    volume = 1.0 unless volume?\n    Backbone.Mediator.publish 'level:set-volume', volume: volume\n\n  initScriptManager: ->\n    return if @level.isType('web-dev')\n    @scriptManager = new ScriptManager({scripts: @world.scripts or [], view: @, session: @session, levelID: @level.get('slug')})\n    @scriptManager.loadFromSession()\n\n  register: ->\n    @bus = LevelBus.get(@levelID, @session.id)\n    @bus.setSession(@session)\n    @bus.setSpells @tome.spells\n    #@bus.connect() if @session.get('multiplayer')  # TODO: session's multiplayer flag removed; connect bus another way if we care about it\n\n  # Load Completed Setup ######################################################\n\n  onSessionLoaded: (e) ->\n    return if @session\n    Backbone.Mediator.publish \"ipad:language-chosen\", language: e.session.get('codeLanguage') ? \"python\"\n    # Just the level and session have been loaded by the level loader\n    if e.level.get('slug') is 'zero-sum'\n      sorcerer = '52fd1524c7e6cf99160e7bc9'\n      if e.session.get('creator') is '532dbc73a622924444b68ed9'  # Wizard Dude gets his own avatar\n        sorcerer = '53e126a4e06b897606d38bef'\n      e.session.set 'heroConfig', {\"thangType\":sorcerer,\"inventory\":{\"misc-0\":\"53e2396a53457600003e3f0f\",\"programming-book\":\"546e266e9df4a17d0d449be5\",\"minion\":\"54eb5dbc49fa2d5c905ddf56\",\"feet\":\"53e214f153457600003e3eab\",\"right-hand\":\"54eab7f52b7506e891ca7202\",\"left-hand\":\"5463758f3839c6e02811d30f\",\"wrists\":\"54693797a2b1f53ce79443e9\",\"gloves\":\"5469425ca2b1f53ce7944421\",\"torso\":\"546d4a549df4a17d0d449a97\",\"neck\":\"54693274a2b1f53ce79443c9\",\"eyes\":\"546941fda2b1f53ce794441d\",\"head\":\"546d4ca19df4a17d0d449abf\"}}\n    # TODO: Remove post-KR\n    else if e.level.get('slug') is 'the-gauntlet-kr'\n      lightseeker = '583d2cca6ffa3e65d170f29f'\n      e.session.set 'heroConfig', {\"thangType\":lightseeker,\"inventory\":{\n        \"feet\":\"53e237bf53457600003e3f05\",\n        \"head\":\"546d38269df4a17d0d4499ff\",\n        \"eyes\":\"53e238df53457600003e3f0b\",\n        \"torso\":\"53e22eac53457600003e3efc\",\n        \"right-hand\":\"53e218d853457600003e3ebe\",\n        \"programming-book\":\"53e4108204c00d4607a89f78\"\n      }}\n    else if e.level.get('slug') is 'woodland-cleaver-kr'\n      lightseeker = '583d2cca6ffa3e65d170f29f'\n      e.session.set 'heroConfig', {\"thangType\":lightseeker,\"inventory\":{\n        \"eyes\": \"53e238df53457600003e3f0b\",\n        \"head\": \"546d38269df4a17d0d4499ff\",\n        \"torso\": \"545d3f0b2d03e700001b5a5d\",\n        \"right-hand\": \"544d7d1f8494308424f564a3\",\n        \"wrists\": \"53e2396a53457600003e3f0f\",\n        \"programming-book\": \"546e25d99df4a17d0d449be1\",\n        \"left-hand\": \"544c310ae0017993fce214bf\"\n      }}\n    else if e.level.get('slug') is 'crossroads-kr'\n      lightseeker = '583d2cca6ffa3e65d170f29f'\n      e.session.set 'heroConfig', {\"thangType\":lightseeker,\"inventory\":{\n        \"wrists\": \"53e2396a53457600003e3f0f\",\n        \"eyes\": \"53e2167653457600003e3eb3\",\n        \"feet\": \"546d4d589df4a17d0d449ac9\",\n        \"left-hand\": \"544d7bb88494308424f56493\",\n        \"right-hand\": \"54694ba3a2b1f53ce794444d\",\n        \"waist\": \"5437002a7beba4a82024a97d\",\n        \"programming-book\": \"546e25d99df4a17d0d449be1\",\n        \"gloves\": \"5469425ca2b1f53ce7944421\",\n        \"head\": \"546d390b9df4a17d0d449a0b\",\n        \"torso\": \"546aaf1b3777d6186329285e\",\n        \"neck\": \"54693140a2b1f53ce79443bc\"\n      }}\n    else if e.level.get('slug') in ['ace-of-coders', 'elemental-wars']\n      goliath = '55e1a6e876cb0948c96af9f8'\n      e.session.set 'heroConfig', {\"thangType\":goliath,\"inventory\":{\"eyes\":\"53eb99f41a100989a40ce46e\",\"neck\":\"54693274a2b1f53ce79443c9\",\"wrists\":\"54693797a2b1f53ce79443e9\",\"feet\":\"546d4d8e9df4a17d0d449acd\",\"minion\":\"54eb5bf649fa2d5c905ddf4a\",\"programming-book\":\"557871261ff17fef5abee3ee\"}}\n    else if e.level.get('slug') is 'the-battle-of-sky-span'\n      wizard = '52fc1460b2b91c0d5a7b6af3'\n      e.session.set 'heroConfig', {\"thangType\":wizard,\"inventory\":{}}\n    else if e.level.get('slug') is 'assembly-speed'\n      raider = '55527eb0b8abf4ba1fe9a107'\n      e.session.set 'heroConfig', {\"thangType\":raider,\"inventory\":{}}\n    else if e.level.isType('hero', 'hero-ladder', 'hero-coop') and not _.size e.session.get('heroConfig')?.inventory ? {}\n      @setupManager?.destroy()\n      @setupManager = new LevelSetupManager({supermodel: @supermodel, level: e.level, levelID: @levelID, parent: @, session: e.session, courseID: @courseID, courseInstanceID: @courseInstanceID})\n      @setupManager.open()\n\n  onLoaded: ->\n    _.defer => @onLevelLoaderLoaded()\n\n  onLevelLoaderLoaded: ->\n    # Everything is now loaded\n    return unless @levelLoader.progress() is 1  # double check, since closing the guide may trigger this early\n\n    # Save latest level played.\n    if not @observing and not (@levelLoader.level.isType('ladder', 'ladder-tutorial'))\n      me.set('lastLevel', @levelID)\n      me.save()\n      application.tracker?.identify()\n    @saveRecentMatch() if @otherSession\n    @levelLoader.destroy()\n    @levelLoader = null\n    if @level.isType('web-dev')\n      Backbone.Mediator.publish 'level:started', {}\n    else\n      @initSurface()\n\n  saveRecentMatch: ->\n    allRecentlyPlayedMatches = storage.load('recently-played-matches') ? {}\n    recentlyPlayedMatches = allRecentlyPlayedMatches[@levelID] ? []\n    allRecentlyPlayedMatches[@levelID] = recentlyPlayedMatches\n    recentlyPlayedMatches.unshift yourTeam: me.team, otherSessionID: @otherSession.id, opponentName: @otherSession.get('creatorName') unless _.find recentlyPlayedMatches, otherSessionID: @otherSession.id\n    recentlyPlayedMatches.splice(8)\n    storage.save 'recently-played-matches', allRecentlyPlayedMatches\n\n  initSurface: ->\n    webGLSurface = $('canvas#webgl-surface', @$el)\n    normalSurface = $('canvas#normal-surface', @$el)\n    surfaceOptions = {\n      thangTypes: @supermodel.getModels(ThangType)\n      @observing\n      playerNames: @findPlayerNames()\n      levelType: @level.get('type', true)\n      stayVisible: @showAds()\n      @gameUIState\n      @level # TODO: change from levelType to level\n    }\n    @surface = new Surface(@world, normalSurface, webGLSurface, surfaceOptions)\n    worldBounds = @world.getBounds()\n    bounds = [{x: worldBounds.left, y: worldBounds.top}, {x: worldBounds.right, y: worldBounds.bottom}]\n    @surface.camera.setBounds(bounds)\n    @surface.camera.zoomTo({x: 0, y: 0}, 0.1, 0)\n    @listenTo @surface, 'resize', ({ height }) ->\n      @$('#stop-real-time-playback-button').css({ top: height - 30 })\n      @$('#how-to-play-game-dev-panel').css({ height })\n\n  findPlayerNames: ->\n    return {} unless @level.isType('ladder', 'hero-ladder', 'course-ladder')\n    playerNames = {}\n    for session in [@session, @otherSession] when session?.get('team')\n      playerNames[session.get('team')] = session.get('creatorName') or 'Anonymous'\n    playerNames\n\n  # Once Surface is Loaded ####################################################\n\n  onLevelStarted: ->\n    return unless @surface? or @webSurface?\n    @loadingView.showReady()\n    @trackLevelLoadEnd()\n    if window.currentModal and not window.currentModal.destroyed and window.currentModal.constructor isnt VictoryModal\n      return Backbone.Mediator.subscribeOnce 'modal:closed', @onLevelStarted, @\n    @surface?.showLevel()\n    Backbone.Mediator.publish 'level:set-time', time: 0\n    if (@isEditorPreview or @observing) and not @getQueryVariable('intro')\n      @loadingView.startUnveiling()\n      @loadingView.unveil true\n    else\n      @scriptManager?.initializeCamera()\n\n  onLoadingViewUnveiling: (e) ->\n    @selectHero()\n\n  onLoadingViewUnveiled: (e) ->\n    if @level.isType('course-ladder', 'hero-ladder') or @observing\n      # We used to autoplay by default, but now we only do it if the level says to in the introduction script.\n      Backbone.Mediator.publish 'level:set-playing', playing: true\n    @loadingView.$el.remove()\n    @removeSubView @loadingView\n    @loadingView = null\n    @playAmbientSound()\n    # TODO: Is it possible to create a Mongoose ObjectId for 'ls', instead of the string returned from get()?\n    application.tracker?.trackEvent 'Started Level', category:'Play Level', levelID: @levelID, ls: @session?.get('_id') unless @observing\n    $(window).trigger 'resize'\n    _.delay (=> @perhapsStartSimulating?()), 10 * 1000\n\n  onSetVolume: (e) ->\n    createjs.Sound.setVolume(if e.volume is 1 then 0.6 else e.volume)  # Quieter for now until individual sound FX controls work again.\n    if e.volume and not @ambientSound\n      @playAmbientSound()\n\n  playAmbientSound: ->\n    return if @destroyed\n    return if @ambientSound\n    return unless me.get 'volume'\n    return unless file = {Dungeon: 'ambient-dungeon', Grass: 'ambient-grass'}[@level.get('terrain')]\n    src = \"/file/interface/#{file}#{AudioPlayer.ext}\"\n    unless AudioPlayer.getStatus(src)?.loaded\n      AudioPlayer.preloadSound src\n      Backbone.Mediator.subscribeOnce 'audio-player:loaded', @playAmbientSound, @\n      return\n    @ambientSound = createjs.Sound.play src, loop: -1, volume: 0.1\n    createjs.Tween.get(@ambientSound).to({volume: 1.0}, 10000)\n\n  selectHero: ->\n    Backbone.Mediator.publish 'level:suppress-selection-sounds', suppress: true\n    Backbone.Mediator.publish 'tome:select-primary-sprite', {}\n    Backbone.Mediator.publish 'level:suppress-selection-sounds', suppress: false\n    @surface?.focusOnHero()\n\n  perhapsStartSimulating: ->\n    return unless @shouldSimulate()\n    return console.error \"Should not auto-simulate until we fix how these languages are loaded\"\n    # TODO: how can we not require these as part of /play bundle?\n    ##require \"vendor/aether-#{codeLanguage}\" for codeLanguage in ['javascript', 'python', 'coffeescript', 'lua', 'java']\n    #require 'vendor/aether-javascript'\n    #require 'vendor/aether-python'\n    #require 'vendor/aether-coffeescript'\n    #require 'vendor/aether-lua'\n    #require 'vendor/aether-java'\n    @simulateNextGame()\n\n  simulateNextGame: ->\n    return @simulator.fetchAndSimulateOneGame() if @simulator\n    simulatorOptions = background: true, leagueID: @courseInstanceID\n    simulatorOptions.levelID = @level.get('slug') if @level.isType('course-ladder', 'hero-ladder')\n    @simulator = new Simulator simulatorOptions\n    # Crude method of mitigating Simulator memory leak issues\n    fetchAndSimulateOneGameOriginal = @simulator.fetchAndSimulateOneGame\n    @simulator.fetchAndSimulateOneGame = =>\n      if @simulator.simulatedByYou >= 10\n        console.log '------------------- Destroying Simulator and making a new one -----------------'\n        @simulator.destroy()\n        @simulator = null\n        @simulateNextGame()\n      else\n        fetchAndSimulateOneGameOriginal.apply @simulator\n    @simulator.fetchAndSimulateOneGame()\n\n  shouldSimulate: ->\n    return true if @getQueryVariable('simulate') is true\n    return false if @getQueryVariable('simulate') is false\n    stillBuggy = true  # Keep this true while we still haven't fixed the zombie worker problem when simulating the more difficult levels on Chrome\n    defaultCores = 2\n    cores = window.navigator.hardwareConcurrency or defaultCores  # Available on Chrome/Opera, soon Safari\n    defaultHeapLimit = 793000000\n    heapLimit = window.performance?.memory?.jsHeapSizeLimit or defaultHeapLimit  # Only available on Chrome, basically just says 32- vs. 64-bit\n    gamesSimulated = me.get('simulatedBy')\n    console.debug \"Should we start simulating? Cores:\", window.navigator.hardwareConcurrency, \"Heap limit:\", window.performance?.memory?.jsHeapSizeLimit, \"Load duration:\", @loadDuration\n    return false unless $.browser?.desktop\n    return false if $.browser?.msie or $.browser?.msedge\n    return false if $.browser.linux\n    return false if me.level() < 8\n    if @level.isType('course', 'game-dev', 'web-dev')\n      return false\n    else if @level.isType('hero') and gamesSimulated\n      return false if stillBuggy\n      return false if cores < 8\n      return false if heapLimit < defaultHeapLimit\n      return false if @loadDuration > 10000\n    else if @level.isType('hero-ladder') and gamesSimulated\n      return false if stillBuggy\n      return false if cores < 4\n      return false if heapLimit < defaultHeapLimit\n      return false if @loadDuration > 15000\n    else if @level.isType('hero-ladder') and not gamesSimulated\n      return false if stillBuggy\n      return false if cores < 8\n      return false if heapLimit <= defaultHeapLimit\n      return false if @loadDuration > 20000\n    else if @level.isType('course-ladder')\n      return false if cores <= defaultCores\n      return false if heapLimit < defaultHeapLimit\n      return false if @loadDuration > 18000\n    else\n      console.warn \"Unwritten level type simulation heuristics; fill these in for new level type #{@level.get('type')}?\"\n      return false if stillBuggy\n      return false if cores < 8\n      return false if heapLimit < defaultHeapLimit\n      return false if @loadDuration > 10000\n    console.debug \"We should have the power. Begin background ladder simulation.\"\n    true\n\n  # callbacks\n\n  onCtrlS: (e) ->\n    e.preventDefault()\n\n  onEscapePressed: (e) ->\n    return unless @$el.hasClass 'real-time'\n    Backbone.Mediator.publish 'playback:stop-real-time-playback', {}\n\n  onLevelReloadFromData: (e) ->\n    isReload = Boolean @world\n    if isReload\n      # Make sure to share any models we loaded that the parent didn't, like hero equipment, in case the parent relodaed\n      e.supermodel.registerModel model for url, model of @supermodel.models when not e.supermodel.models[url]\n    @setLevel e.level, e.supermodel\n    if isReload\n      @scriptManager.setScripts(e.level.get('scripts'))\n      @updateGoals e.level.get('goals')\n      Backbone.Mediator.publish 'tome:cast-spell', {}  # a bit hacky\n\n  onLevelReloadThangType: (e) ->\n    tt = e.thangType\n    for url, model of @supermodel.models\n      if model.id is tt.id\n        for key, val of tt.attributes\n          model.attributes[key] = val\n        break\n    Backbone.Mediator.publish 'tome:cast-spell', {}\n\n  onWindowResize: (e) =>\n    @endHighlight()\n\n  onDisableControls: (e) ->\n    return if e.controls and not ('level' in e.controls)\n    @shortcutsEnabled = false\n    @wasFocusedOn = document.activeElement\n    $('body').focus()\n\n  onEnableControls: (e) ->\n    return if e.controls? and not ('level' in e.controls)\n    @shortcutsEnabled = true\n    $(@wasFocusedOn).focus() if @wasFocusedOn\n    @wasFocusedOn = null\n\n  onDonePressed: -> @showVictory()\n\n  onShowVictory: (e={}) ->\n    $('#level-done-button').show() unless @level.isType('hero', 'hero-ladder', 'hero-coop', 'course', 'course-ladder', 'game-dev', 'web-dev')\n    @showVictory(_.pick(e, 'manual')) if e.showModal\n    return if @victorySeen\n    @victorySeen = true\n    victoryTime = (new Date()) - @loadEndTime\n    if not @observing and victoryTime > 10 * 1000   # Don't track it if we're reloading an already-beaten level\n      application.tracker?.trackEvent 'Saw Victory',\n        category: 'Play Level'\n        level: @level.get('name')\n        label: @level.get('name')\n        levelID: @levelID\n        ls: @session?.get('_id')\n      application.tracker?.trackTiming victoryTime, 'Level Victory Time', @levelID, @levelID\n\n  showVictory: (options={}) ->\n    return if @level.hasLocalChanges()  # Don't award achievements when beating level changed in level editor\n    return if @level.isType('game-dev') and @level.get('shareable') and not options.manual\n    @endHighlight()\n    options = {level: @level, supermodel: @supermodel, session: @session, hasReceivedMemoryWarning: @hasReceivedMemoryWarning, courseID: @courseID, courseInstanceID: @courseInstanceID, world: @world}\n    ModalClass = if @level.isType('hero', 'hero-ladder', 'hero-coop', 'course', 'course-ladder', 'game-dev', 'web-dev') then HeroVictoryModal else VictoryModal\n    ModalClass = CourseVictoryModal if @isCourseMode() or me.isSessionless()\n    if @level.isType('course-ladder')\n      ModalClass = CourseVictoryModal\n      options.courseInstanceID = @getQueryVariable('course-instance') or @getQueryVariable('league')\n    ModalClass = PicoCTFVictoryModal if window.serverConfig.picoCTF\n    victoryModal = new ModalClass(options)\n    @openModalView(victoryModal)\n    if me.get('anonymous')\n      window.nextURL = '/play/' + (@level.get('campaign') ? '')  # Signup will go here on completion instead of reloading.\n\n  onRestartLevel: ->\n    @tome.reloadAllCode()\n    Backbone.Mediator.publish 'level:restarted', {}\n    $('#level-done-button', @$el).hide()\n    application.tracker?.trackEvent 'Confirmed Restart', category: 'Play Level', level: @level.get('name'), label: @level.get('name') unless @observing\n\n  onInfiniteLoop: (e) ->\n    return unless e.firstWorld and e.god is @god\n    @openModalView new InfiniteLoopModal nonUserCodeProblem: e.nonUserCodeProblem\n    application.tracker?.trackEvent 'Saw Initial Infinite Loop', category: 'Play Level', level: @level.get('name'), label: @level.get('name') unless @observing\n\n  onHighlightDOM: (e) -> @highlightElement e.selector, delay: e.delay, sides: e.sides, offset: e.offset, rotation: e.rotation\n\n  onEndHighlight: -> @endHighlight()\n\n  onFocusDom: (e) -> $(e.selector).focus()\n\n  onContactClicked: (e) ->\n    if me.isStudent()\n      console.error(\"Student clicked contact modal.\")\n      return\n    Backbone.Mediator.publish 'level:contact-button-pressed', {}\n    @openModalView contactModal = new ContactModal levelID: @level.get('slug') or @level.id, courseID: @courseID, courseInstanceID: @courseInstanceID\n    screenshot = @surface.screenshot(1, 'image/png', 1.0, 1)\n    body =\n      b64png: screenshot.replace 'data:image/png;base64,', ''\n      filename: \"screenshot-#{@levelID}-#{_.string.slugify((new Date()).toString())}.png\"\n      path: \"db/user/#{me.id}\"\n      mimetype: 'image/png'\n    contactModal.screenshotURL = \"http://codecombat.com/file/#{body.path}/#{body.filename}\"\n    window.screenshot = screenshot\n    window.screenshotURL = contactModal.screenshotURL\n    $.ajax '/file', type: 'POST', data: body, success: (e) ->\n      contactModal.updateScreenshot?()\n\n  # Dynamic sound loading\n\n  onNewWorld: (e) ->\n    return if @headless\n    scripts = @world.scripts  # Since these worlds don't have scripts, preserve them.\n    @world = e.world\n    @world.scripts = scripts\n    thangTypes = @supermodel.getModels(ThangType)\n    startFrame = @lastWorldFramesLoaded ? 0\n    finishedLoading = @world.frames.length is @world.totalFrames\n    if finishedLoading\n      @lastWorldFramesLoaded = 0\n      if @waitingForSubmissionComplete\n        _.defer @onSubmissionComplete  # Give it a frame to make sure we have the latest goals\n        @waitingForSubmissionComplete = false\n    else\n      @lastWorldFramesLoaded = @world.frames.length\n    for [spriteName, message] in @world.thangDialogueSounds startFrame\n      continue unless thangType = _.find thangTypes, (m) -> m.get('name') is spriteName\n      continue unless sound = AudioPlayer.soundForDialogue message, thangType.get('soundTriggers')\n      AudioPlayer.preloadSoundReference sound\n\n  # Real-time playback\n  onRealTimePlaybackStarted: (e) ->\n    @$el.addClass('real-time').focus()\n    @$('#how-to-play-game-dev-panel').removeClass('hide') if @level.isType('game-dev')\n    @onWindowResize()\n\n  onRealTimePlaybackEnded: (e) ->\n    return unless @$el.hasClass 'real-time'\n    @$('#how-to-play-game-dev-panel').addClass('hide') if @level.isType('game-dev')\n    @$el.removeClass 'real-time'\n    @onWindowResize()\n    if @world.frames.length is @world.totalFrames and not @surface.countdownScreen?.showing\n      _.delay @onSubmissionComplete, 750  # Wait for transition to end.\n    else\n      @waitingForSubmissionComplete = true\n\n  onSubmissionComplete: =>\n    return if @destroyed\n    Backbone.Mediator.publish 'level:set-time', ratio: 1\n    return if @level.hasLocalChanges()  # Don't award achievements when beating level changed in level editor\n    if @goalManager.checkOverallStatus() is 'success'\n      showModalFn = -> Backbone.Mediator.publish 'level:show-victory', showModal: true\n      @session.recordScores @world.scores, @level\n      if @level.get 'replayable'\n        @session.increaseDifficulty showModalFn\n      else\n        showModalFn()\n\n  destroy: ->\n    @levelLoader?.destroy()\n    @surface?.destroy()\n    @god?.destroy()\n    @goalManager?.destroy()\n    @scriptManager?.destroy()\n    @setupManager?.destroy()\n    @simulator?.destroy()\n    if ambientSound = @ambientSound\n      # Doesn't seem to work; stops immediately.\n      createjs.Tween.get(ambientSound).to({volume: 0.0}, 1500).call -> ambientSound.stop()\n    $(window).off 'resize', @onWindowResize\n    delete window.world # not sure where this is set, but this is one way to clean it up\n    @bus?.destroy()\n    #@instance.save() unless @instance.loading\n    delete window.nextURL\n    console.profileEnd?() if PROFILE_ME\n    application.tracker?.disableInspectletJS()\n    super()\n\n  onIPadMemoryWarning: (e) ->\n    @hasReceivedMemoryWarning = true\n\n  onItemPurchased: (e) ->\n    heroConfig = @session.get('heroConfig') ? {}\n    inventory = heroConfig.inventory ? {}\n    slot = e.item.getAllowedSlots()[0]\n    if slot and not inventory[slot]\n      # Open up the inventory modal so they can equip the new item\n      @setupManager?.destroy()\n      @setupManager = new LevelSetupManager({supermodel: @supermodel, level: @level, levelID: @levelID, parent: @, session: @session, hadEverChosenHero: true})\n      @setupManager.open()\n"]}