{"version":3,"sources":["app/templates/account/israel-signup-view.jade","app/views/account/IsraelSignupView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnJA;AAAA;;ACAA;EAAA;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,sCAAR;;AACX,QAAQ,QAAQ,YAAR;;AACR,SAAS,QAAQ,aAAR;;AACT,QAAQ,QAAQ,YAAR;;AACR,OAAO,QAAQ,aAAR;;AACP,QAAQ,QAAQ,cAAR;;AAEF;;;;;;;;;GAAmB;;AAEzB,aACE;EAAA,MAAM,QAAN;EACA,YAAY,CAAC,CAAC,IAAF,CAAO,IAAI,CAAC,MAAM,CAAC,UAAnB,EAA+B,MAA/B,EAAuC,UAAvC,CADZ;EAEA,UAAU,CAAC,MAAD,EAAS,UAAT,CAFV;;;AAKF,MAAM,CAAC,OAAP,GAAuB;;;;;;;6BACrB,KAAI;;6BACJ,WAAU;;6BAEV,SACE;IAAA,eAAe,cAAf;IACA,4BAA4B,cAD5B;IAEA,gCAAgC,k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","file":"public/javascripts/app/views/account/IsraelSignupView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),me = locals_.me,serverConfig = locals_.serverConfig,view = locals_.view,loading = locals_.loading,fatalError = locals_.fatalError,queryParams = locals_.queryParams,name = locals_.name,password = locals_.password,formError = locals_.formError;var accountLinks_mixin = function(){\nvar block = this.block, attributes = this.attributes || {}, escaped = this.escaped || {};\nbuf.push(\"<li><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\"), 'data-i18n':(\"nav.profile\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li><li><a href=\\\"/account/settings\\\" data-i18n=\\\"play.settings\\\"></a></li>\");\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/payments\\\" data-i18n=\\\"account.payments\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()) || me.hasSubscription())\n{\nbuf.push(\"<li><a href=\\\"/account/subscription\\\" data-i18n=\\\"account.subscription\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/prepaid\\\" data-i18n=\\\"account.prepaid_codes\\\"></a></li>\");\n}\nbuf.push(\"<li><a id=\\\"logout-button\\\" data-i18n=\\\"login.log_out\\\"></a></li>\");\n};\nbuf.push(\"<div class=\\\"style-flat\\\"><nav id=\\\"main-nav\\\" class=\\\"navbar navbar-default\\\"><div class=\\\"container-fluid container\\\"><div class=\\\"row\\\"><div class=\\\"col-md-12\\\"><div class=\\\"navbar-header\\\"><button data-toggle=\\\"collapse\\\" data-target=\\\"#navbar-collapse\\\" aria-expanded=\\\"false\\\" class=\\\"navbar-toggle collapsed\\\"><span data-i18n=\\\"nav.toggle_nav\\\" class=\\\"sr-only\\\"></span><span class=\\\"icon-bar\\\"></span><span class=\\\"icon-bar\\\"></span><span class=\\\"icon-bar\\\"></span></button><a href=\\\"/\\\" class=\\\"navbar-brand\\\">\");\nif ( serverConfig.codeNinjas)\n{\nbuf.push(\"<img id=\\\"logo-img\\\" src=\\\"/images/pages/base/logo.png\\\" class=\\\"code-ninjas-powered-by\\\"/><img src=\\\"/images/pages/base/code-ninjas-logo-right.png\\\" class=\\\"code-ninjas-logo\\\"/>\");\n}\nelse\n{\nbuf.push(\"<img id=\\\"logo-img\\\" src=\\\"/images/pages/base/logo.png\\\"/>\");\n}\nbuf.push(\"<span class=\\\"glyphicon glyphicon-home\\\"></span></a></div><div id=\\\"navbar-collapse\\\" class=\\\"collapse navbar-collapse\\\"><ul class=\\\"nav navbar-nav\\\"><li><a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a></li>\");\nif ( me.isStudent())\n{\nbuf.push(\"<li><a href=\\\"/students\\\" data-i18n=\\\"nav.my_courses\\\"></a></li>\");\n}\nif ( !me.isAnonymous() && me.isTeacher())\n{\nbuf.push(\"<li><a href=\\\"/teachers/classes\\\" data-i18n=\\\"nav.my_classrooms\\\"></a></li>\");\n}\nif ( !me.isAnonymous() && !me.isStudent() && !me.isTeacher())\n{\nbuf.push(\"<li><a href=\\\"/play\\\" data-i18n=\\\"common.play\\\"></a></li><li><a\" + (jade.attrs({ 'href':(view.forumLink()), 'data-i18n':(\"nav.forum\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li>\");\n}\nbuf.push(\"</ul>\");\nif ( me.isAnonymous())\n{\nbuf.push(\"<ul class=\\\"nav navbar-nav\\\"><li><a id=\\\"create-account-link\\\" data-i18n=\\\"login.sign_up\\\" class=\\\"signup-button\\\"></a></li><li><a id=\\\"login-link\\\" data-i18n=\\\"login.log_in\\\" class=\\\"login-button\\\"></a></li></ul>\");\n}\nelse\n{\nbuf.push(\"<ul class=\\\"nav navbar-nav hidden-md hidden-lg\\\"><li class=\\\"disabled\\\"><a><img\" + (jade.attrs({ 'src':(me.getPhotoURL()), \"class\": [('img-circle'),('img-circle-small'),('m-r-1'),((me.isTeacher() ? 'border-navy' : ''))] }, {\"class\":true,\"src\":true})) + \"/><span>\" + (jade.escape(null == (jade.interp = me.displayName()) ? \"\" : jade.interp)) + \"</span></a></li>\");\naccountLinks_mixin();\nbuf.push(\"</ul><ul class=\\\"nav navbar-nav\\\"><li class=\\\"dropdown hidden-xs hidden-sm\\\"><a href=\\\"#\\\" data-toggle=\\\"dropdown\\\" role=\\\"button\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"false\\\" class=\\\"dropdown-toggle\\\"><img\" + (jade.attrs({ 'src':(me.getPhotoURL()), \"class\": [('img-circle'),('img-circle-small'),('m-r-1'),((me.isTeacher() ? 'border-navy' : ''))] }, {\"class\":true,\"src\":true})) + \"/><span data-i18n=\\\"nav.my_account\\\"></span></a><ul class=\\\"dropdown-menu\\\"><li class=\\\"user-dropdown-header text-center\\\"><span class=\\\"user-level\\\">\" + (jade.escape(null == (jade.interp = me.level()) ? \"\" : jade.interp)) + \"</span><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\") }, {\"href\":true})) + \"><img\" + (jade.attrs({ 'src':(me.getPhotoURL()), \"class\": [('img-circle'),((me.isTeacher() ? 'border-navy' : ''))] }, {\"class\":true,\"src\":true})) + \"/></a><h5>\" + (jade.escape(null == (jade.interp = me.broadName()) ? \"\" : jade.interp)) + \"</h5></li>\");\naccountLinks_mixin();\nbuf.push(\"</ul></li></ul>\");\n}\nbuf.push(\"<ul class=\\\"nav navbar-nav\\\"><li><div id=\\\"language-dropdown-wrapper\\\"><select class=\\\"language-dropdown form-control\\\"></select></div></li></ul></div></div></div></div></nav><div id=\\\"site-content-area\\\"><div class=\\\"container\\\"><h1 class=\\\"m-t-3 m-b-2 text-center\\\">Create Account</h1>\");\nif ( loading)\n{\nbuf.push(\"<h5 class=\\\"text-center\\\">Loading</h5>\");\n}\nelse if ( fatalError)\n{\nbuf.push(\"<div class=\\\"alert alert-danger text-center\\\">\");\nif ( fatalError === 'signed-in')\n{\nbuf.push(\"<!-- You already have an account--><h3>יש לך כבר חשבון</h3><!-- Play CodeCombat!--><a href=\\\"/play\\\">שחק CodeCombat!</a>\");\n}\nelse if ( fatalError === 'missing-input')\n{\nbuf.push(\"<!-- Not enough information was provided--><h3>חסר מידע</h3><!-- Need at least \\\"israelId\\\" included in GET parameters.--><p>לפחות קוד זיהוי ישראלי -  israelId חייב להיכלל בפרמטרים של בקשת ה GET</p>\");\n}\nelse if ( fatalError === 'email-exists')\n{\nbuf.push(\"<!-- Your email is already in use--><h3>דוא\\\"ל זה כבר נמצא בשימוש  \\\"</h3><a data-i18n=\\\"login.log_in\\\" class=\\\"login-button\\\"></a>\");\n}\nelse\n{\nbuf.push(\"<!-- Error--><h3>שגיאה</h3><p>\" + (jade.escape(null == (jade.interp = fatalError) ? \"\" : jade.interp)) + \"</p>\");\n}\nbuf.push(\"</div>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"row\\\"><div class=\\\"col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2\\\"><table class=\\\"table table-condensed\\\"><tr><!-- Israel Id--><th>קוד זיהוי ישראלי</th><td>\" + (jade.escape(null == (jade.interp = queryParams.israelId) ? \"\" : jade.interp)) + \"</td></tr>\");\nif ( queryParams.email)\n{\nbuf.push(\"<tr><!-- Email--><th>אמייל</th><td>\" + (jade.escape(null == (jade.interp = queryParams.email) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nif ( queryParams.firstName)\n{\nbuf.push(\"<tr><!-- First Name--><th>שם פרטי</th><td>\" + (jade.escape(null == (jade.interp = queryParams.firstName) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nif ( queryParams.lastName)\n{\nbuf.push(\"<tr><!-- Last Name--><th>שם משפחה</th><td>\" + (jade.escape(null == (jade.interp = queryParams.lastName) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nif ( queryParams.school)\n{\nbuf.push(\"<tr><!-- School--><th>בית ספר</th><td>\" + (jade.escape(null == (jade.interp = queryParams.school) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nif ( queryParams.city)\n{\nbuf.push(\"<tr><!-- City--><th>עיר</th><td>\" + (jade.escape(null == (jade.interp = queryParams.city) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nif ( queryParams.district)\n{\nbuf.push(\"<tr><!-- District--><th>מחוז</th><td>\" + (jade.escape(null == (jade.interp = queryParams.district) ? \"\" : jade.interp)) + \"</td></tr>\");\n}\nbuf.push(\"</table><form><div class=\\\"form-group\\\"><label for=\\\"username-input\\\" data-i18n=\\\"general.username\\\" class=\\\"control-label\\\"></label><input\" + (jade.attrs({ 'name':(\"name\"), 'value':(name), \"class\": [('form-control'),('input-lg')] }, {\"name\":true,\"value\":true})) + \"/></div><div class=\\\"form-group\\\"><label for=\\\"password-input\\\" data-i18n=\\\"general.password\\\" class=\\\"control-label\\\"></label><input\" + (jade.attrs({ 'name':(\"password\"), 'type':(\"password\"), 'value':(password), \"class\": [('form-control'),('input-lg')] }, {\"name\":true,\"type\":true,\"value\":true})) + \"/></div>\");\nif ( formError)\n{\nbuf.push(\"<div class=\\\"alert alert-danger text-center\\\">\" + (jade.escape(null == (jade.interp = formError) ? \"\" : jade.interp)) + \"</div>\");\n}\nbuf.push(\"<button id=\\\"create-account-btn\\\" type=\\\"submit\\\" data-i18n=\\\"login.sign_up\\\" class=\\\"btn btn-lg btn-block btn-navy\\\"></button></form></div></div>\");\n}\nbuf.push(\"</div></div><div class=\\\"container-fluid\\\"><div id=\\\"footer\\\" class=\\\"small\\\"><div class=\\\"container\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong>CodeCombat</strong></li><li><a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a></li><li><a href=\\\"/about#jobs\\\" data-i18n=\\\"nav.jobs\\\"></a></li><li><a href=\\\"http://blog.codecombat.com/\\\" data-i18n=\\\"nav.blog\\\"></a></li><li><a href=\\\"/legal\\\" data-i18n=\\\"nav.legal\\\"></a></li><li><a href=\\\"/privacy\\\" data-i18n=\\\"nav.privacy\\\"></a></li></ul></div>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong data-i18n=\\\"nav.schools\\\"></strong></li><li><a href=\\\"/teachers/resources/faq\\\" data-i18n=\\\"teacher.educator_faq\\\"></a></li><li><a href=\\\"/teachers/classes\\\" data-i18n=\\\"nav.my_classrooms\\\"></a></li><li><a href=\\\"/teachers/resources\\\" data-i18n=\\\"nav.resource_hub\\\"></a></li><li><a href=\\\"/teachers/demo\\\" data-i18n=\\\"new_home.request_demo\\\"></a></li></ul></div>\");\n}\nbuf.push(\"<div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong data-i18n=\\\"nav.get_involved\\\"></strong></li><li><a href=\\\"/community\\\" data-i18n=\\\"nav.community\\\"></a></li><li><a href=\\\"/contribute\\\" data-i18n=\\\"nav.contribute\\\"></a></li>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<li><a\" + (jade.attrs({ 'href':(view.forumLink()), 'data-i18n':(\"nav.forum\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li>\");\n}\nbuf.push(\"<li><a href=\\\"/play/ladder\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a></li><li><a href=\\\"https://github.com/codecombat/codecombat\\\" data-i18n=\\\"nav.open_source\\\"></a></li></ul></div><div class=\\\"col-sm-3\\\"><ul class=\\\"list-unstyled\\\"><li><strong data-i18n=\\\"nav.support\\\"></strong></li>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<li><a tabindex=\\\"-1\\\" data-i18n=\\\"nav.contact\\\" class=\\\"contact-modal\\\"></a></li>\");\n}\nbuf.push(\"<li><a href=\\\"https://www.facebook.com/codecombat\\\" data-i18n=\\\"nav.facebook\\\"></a></li><li><a href=\\\"https://twitter.com/codecombat\\\" data-i18n=\\\"nav.twitter\\\"></a></li></ul></div></div></div></div><div id=\\\"final-footer\\\" class=\\\"small text-center\\\">Copyright ©2016 CodeCombat. All Rights Reserved.<br class=\\\"hidden-lg hidden-md\\\"/><img src=\\\"/images/pages/base/logo.png\\\" alt=\\\"CodeCombat\\\"/><br class=\\\"hidden-lg hidden-md\\\"/>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<span data-i18n=\\\"nav.help_pref\\\" class=\\\"spr\\\"></span>\");\nvar supportEmail = (me.get('preferredLanguage', true) || 'en-US').split('-')[0] == 'nl' ? 'klantenservice@codecombat.nl' : 'team@codecombat.com';\nbuf.push(\"<a\" + (jade.attrs({ 'href':(\"mailto:\" + supportEmail) }, {\"href\":true})) + \">\" + (jade.escape(null == (jade.interp = supportEmail) ? \"\" : jade.interp)) + \"</a><span data-i18n=\\\"nav.help_suff\\\" class=\\\"spl\\\"></span>\");\n}\nbuf.push(\"</div></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\ntemplate = require 'templates/account/israel-signup-view'\nforms = require 'core/forms'\nerrors = require 'core/errors'\nutils = require 'core/utils'\nUser = require 'models/User'\nState = require 'models/State'\n\nclass AbortError extends Error\n\nformSchema =\n  type: 'object'\n  properties: _.pick(User.schema.properties, 'name', 'password')\n  required: ['name', 'password']\n\n\nmodule.exports = class IsraelSignupView extends RootView\n  id: 'israel-signup-view'\n  template: template\n  \n  events:\n    'submit form': 'onSubmitForm'\n    'input input[name=\"name\"]': 'onChangeName'\n    'input input[name=\"password\"]': 'onChangePassword'\n    \n  initialize: ->\n    @state = new State({\n      fatalError: null\n      # Possible errors:\n      #   'signed-in': They are logged in\n      #   'missing-input': Required query parameters are not provided\n      #   'email-exists': Given email exists in our system\n      #   Any other string will be shown directly to user\n      \n      formError: null\n      loading: true\n      submitting: false\n      queryParams: _.pick(utils.getQueryVariables(),\n        'israelId'\n        'firstName'\n        'lastName'\n        'email'\n        'school'\n        'city'\n        'state'\n        'district'\n      )\n      name: ''\n      password: ''\n    })\n    \n    { israelId, email } = @state.get('queryParams')\n    \n    # sanity checks\n    if not me.isAnonymous()\n      @state.set({fatalError: 'signed-in', loading: false})\n    \n    else if not israelId\n      @state.set({fatalError: 'missing-input', loading: false})\n    \n    else if email and not forms.validateEmail(email)\n      @state.set({fatalError: 'invalid-email', loading: false})\n      \n    else if not email\n      @state.set({loading: false})\n      \n    else\n      User.checkEmailExists(email)\n      .then ({exists}) =>\n        @state.set({loading: false})\n        if exists\n          @state.set({fatalError: 'email-exists'})\n          \n      .catch =>\n        @state.set({fatalError: $.i18n.t('loading_error.unknown'), loading: false})\n        \n    @listenTo(@state, 'change', _.debounce(@render))\n\n  getRenderData: ->\n    c = super()\n    return _.extend({}, @state.attributes, c)\n    \n  onChangeName: (e) ->\n    # sync form info with state, but do not re-render\n    @state.set({name: $(e.currentTarget).val()}, {silent: true})\n    \n  onChangePassword: (e) ->\n    @state.set({password: $(e.currentTarget).val()}, {silent: true})\n\n  displayFormSubmitting: ->\n    @$('#create-account-btn').text($.i18n.t('signup.creating')).attr('disabled', true)\n    @$('input').attr('disabled', true)\n\n  displayFormStandingBy: ->\n    @$('#create-account-btn').text($.i18n.t('login.sign_up')).attr('disabled', false)\n    @$('input').attr('disabled', false)\n    \n  onSubmitForm: (e) ->\n    \n    # validate form with schema\n    e.preventDefault()\n    forms.clearFormAlerts(@$el)\n    @state.set('formError', null)\n    data = forms.formToObject(e.currentTarget)\n    res = tv4.validateMultiple data, formSchema\n    if not res.valid\n      forms.applyErrorsToForm(@$('form'), res.errors)\n      return\n\n    # check for name conflicts\n    queryParams = @state.get('queryParams')\n    @displayFormSubmitting()\n    User.checkNameConflicts(data.name)\n    .then ({ suggestedName, conflicts }) =>\n      nameField = @$('input[name=\"name\"]')\n      if conflicts\n        suggestedNameText = $.i18n.t('signup.name_taken').replace('{{suggestedName}}', suggestedName)\n        forms.setErrorToField(nameField, suggestedNameText)\n        throw AbortError\n      \n      # Save new user settings, particularly properties handed in\n      school = _.pick(queryParams, 'state', 'city', 'district')\n      school.name = queryParams.school if queryParams.school\n      me.set(_.pick(queryParams, 'firstName', 'lastName', 'israelId'))\n      me.set({school})\n      return me.save()\n        \n    .then =>\n      # sign up\n      return me.signupWithPassword(\n        @state.get('name'),\n        queryParams.email or '',\n        @state.get('password')\n      )\n      \n    .then =>\n      # successful signup\n      application.router.navigate('/play', { trigger: true })\n      \n    .catch (e) =>\n      # if we threw the AbortError, the error was handled\n      @displayFormStandingBy()\n      if e is AbortError\n        return\n      else\n        # Otherwise, show a generic error\n        console.error 'IsraelSignupView form submission Promise error:', e\n        @state.set('formError', e.responseJSON?.message or e.message or 'Unknown Error')\n"]}