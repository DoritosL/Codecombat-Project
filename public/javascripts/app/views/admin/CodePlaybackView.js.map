{"version":3,"sources":["app/views/admin/CodePlaybackView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/admin/CodePlaybackView.js","sourcesContent":["CocoView = require 'views/core/CocoView'\n\nCodeLog = require 'models/CodeLog'\nace = require 'ace'\nutils = require 'core/utils'\n\ntemplate = require 'templates/admin/codeplayback-view'\n\nmodule.exports = class CodePlaybackView extends CocoView\n  id: 'codeplayback-view'\n  template: template\n  controlsEnabled: true\n  events:\n    'click #play-button': 'onPlayClicked'\n    'input #slider': 'onSliderInput'\n    'click #pause-button': 'onPauseClicked'\n    'click .speed-button': 'onSpeedButtonClicked'\n\n  constructor: (options) ->\n    super()\n    @spade = new Spade()\n    @options = options\n    @options.decompressedLog = LZString.decompressFromUTF16(@options.rawLog)\n    return unless @options.decompressedLog?\n    @options.events = @spade.expand(JSON.parse(@options.decompressedLog))\n    @maxTime = @options.events[@options.events.length - 1].timestamp\n    #@spade.play(@options.events, $('#codearea').context)\n\n  afterRender: ->\n    return unless @options.events?\n    @ace = ace.edit('acearea')\n    @ace.$blockScrolling = Infinity\n    @ace.setValue(@options.events[0].difContent)\n    @$el.find('#start-time').text('0s')\n    @$el.find('#end-time').text((@maxTime / 1000) + 's')\n    for ev in @options.events\n      div = $('<div></div>')\n      div.addClass('event')\n      div.css('left', \"calc(#{(ev.timestamp / @maxTime) * 100}% + 7px - #{15 * ev.timestamp / @maxTime}px)\")\n      @$el.find('#slider-container').prepend(div)\n\n  updateSlider: =>\n    @$el.find('#slider')[0].value = (@spade.elapsedTime / @maxTime) * 100\n    @$el.find('#start-time').text((@spade.elapsedTime / 1000).toFixed(0) + 's')\n    if @spade.elapsedTime >= @maxTime\n      @clearPlayback()\n\n  onPlayClicked: (e) ->\n    @clearPlayback()\n    @spade.play(@options.events, @ace, @$el.find('#slider')[0].value / 100)\n    @interval = setInterval(@updateSlider, 1)\n\n  onSpeedButtonClicked: (e) ->\n    @spade.speed = $(e.target).data('speed')\n    $(e.target).siblings().removeClass 'clicked'\n    $(e.target).addClass 'clicked'\n\n  onSliderInput: (e) ->\n    @clearPlayback()\n    @$el.find('#start-time').text(((@$el.find('#slider')[0].value / 100 * @maxTime) / 1000).toFixed(0) + 's')\n    render = @spade.renderTime(@options.events, @ace, @$el.find('#slider')[0].value / 100)\n    @ace.setValue(render.result)\n    if render.selFIndex? and render.selEIndex?\n      @ace.selection.moveCursorToPosition(render.selFIndex)\n      @ace.selection.setSelectionAnchor(render.selEIndex.row, render.selEIndex.column)\n\n\n  clearPlayback: ->\n    clearInterval(@interval) if @interval?\n    @interval = undefined\n    clearInterval(@spade.playback) if @spade.playback?\n    @spade.playback = undefined\n\n  onPauseClicked: (e) ->\n    @clearPlayback()\n\n  destroy: ->\n    @clearPlayback()\n    super()\n"]}