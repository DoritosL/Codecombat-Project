{"version":3,"sources":["app/templates/editor/poll/poll-edit-view.jade","app/views/editor/poll/PollEditView.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/views/editor/poll/PollEditView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),features = locals_.features,me = locals_.me,view = locals_.view,usesSocialMedia = locals_.usesSocialMedia,isIE = locals_.isIE,fbRef = locals_.fbRef;buf.push(\"<div id=\\\"site-nav\\\"><a href=\\\"/\\\"><img id=\\\"nav-logo\\\" src=\\\"/images/pages/base/logo.png\\\" title=\\\"CodeCombat - Learn how to code by playing a game\\\" alt=\\\"CodeCombat\\\"/></a><div id=\\\"site-nav-links\\\"><a href=\\\"/\\\"><img id=\\\"small-nav-logo\\\" src=\\\"/images/pages/base/logo.png\\\" title=\\\"CodeCombat - Learn how to code by playing a game\\\" alt=\\\"CodeCombat\\\"/></a><a href=\\\"/\\\"><span class=\\\"glyphicon glyphicon-home\\\"></span></a>\");\nif ( !features.playViewsOnly)\n{\nbuf.push(\"<a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a>\");\nif ( me.isStudent())\n{\nbuf.push(\"<a href=\\\"/students\\\" data-i18n=\\\"nav.my_courses\\\"></a>\");\n}\nif ( me.isTeacher())\n{\nbuf.push(\"<a href=\\\"/teachers/classes\\\" data-i18n=\\\"nav.my_classrooms\\\"></a>\");\n}\nif ( !me.isAnonymous() && !me.isStudent() && !me.isTeacher())\n{\nbuf.push(\"<a href=\\\"/play\\\" data-i18n=\\\"common.play\\\"></a><a\" + (jade.attrs({ 'href':(view.forumLink()), 'data-i18n':(\"nav.forum\") }, {\"href\":true,\"data-i18n\":true})) + \"></a>\");\n}\nbuf.push(\"<a href=\\\"/community\\\" data-i18n=\\\"nav.community\\\"></a>\");\nif ( me.get('anonymous') === false)\n{\nbuf.push(\"<span class=\\\"dropdown\\\"><button href=\\\"#\\\" data-toggle=\\\"dropdown\\\" class=\\\"btn btn-sm header-font dropdown-toggle\\\">\");\nif ( me.get('photoURL'))\n{\nbuf.push(\"<img\" + (jade.attrs({ 'src':(me.getPhotoURL(18)), 'alt':(\"\"), \"class\": [('account-settings-image')] }, {\"src\":true,\"alt\":true})) + \"/>\");\n}\nelse\n{\nbuf.push(\"<i class=\\\"glyphicon glyphicon-user\\\"></i>\");\n}\nbuf.push(\"<span data-i18n=\\\"nav.account\\\" href=\\\"/account\\\" class=\\\"spl spr\\\"></span><span class=\\\"caret\\\"></span></button><ul role=\\\"menu\\\" class=\\\"dropdown-menu\\\"><li class=\\\"user-dropdown-header\\\"><span class=\\\"user-level\\\">\" + (jade.escape(null == (jade.interp = me.level()) ? \"\" : jade.interp)) + \"</span><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\") }, {\"href\":true})) + \"><div\" + (jade.attrs({ 'style':(\"background-image: url(\" + (me.getPhotoURL()) + \")\"), \"class\": [('img-circle')] }, {\"style\":true})) + \"></div></a><h3>\" + (jade.escape(null == (jade.interp = me.broadName()) ? \"\" : jade.interp)) + \"</h3></li><li><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\"), 'data-i18n':(\"nav.profile\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li><li><a href=\\\"/account/settings\\\" data-i18n=\\\"play.settings\\\"></a></li>\");\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/payments\\\" data-i18n=\\\"account.payments\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()) || me.hasSubscription())\n{\nbuf.push(\"<li><a href=\\\"/account/subscription\\\" data-i18n=\\\"account.subscription\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/prepaid\\\" data-i18n=\\\"account.prepaid_codes\\\"></a></li>\");\n}\nbuf.push(\"<li><a id=\\\"logout-button\\\" data-i18n=\\\"login.log_out\\\"></a></li></ul></span>\");\n}\nelse\n{\nbuf.push(\"<button data-i18n=\\\"login.sign_up\\\" class=\\\"btn btn-sm btn-primary header-font signup-button\\\"></button><button data-i18n=\\\"login.log_in\\\" class=\\\"btn btn-sm btn-default header-font login-button\\\"></button>\");\n}\n}\nbuf.push(\"<select class=\\\"language-dropdown form-control\\\"></select></div></div><div id=\\\"site-content-area\\\">\");\nvar authorized = me.isAdmin();\nif ( authorized)\n{\nbuf.push(\"<ol class=\\\"breadcrumb\\\"><li><a href=\\\"/editor\\\" data-i18n=\\\"editor.main_title\\\">CodeCombat Editors</a></li><li><a href=\\\"/editor/poll\\\" data-i18n=\\\"editor.poll_title\\\">Poll Editor</a></li><li class=\\\"active\\\">\" + (jade.escape((jade.interp = view.poll.attributes.name) == null ? '' : jade.interp)) + \"</li></ol><button\" + (jade.attrs({ 'data-i18n':(\"common.delete\"), 'disabled':(!me.isAdmin()), 'id':('delete-button'), \"class\": [('poll-tool-button'),('btn'),('btn-primary')] }, {\"data-i18n\":true,\"disabled\":true})) + \">Delete</button><button\" + (jade.attrs({ 'data-i18n':(\"common.save\"), 'disabled':(!me.isAdmin()), 'id':('save-button'), \"class\": [('poll-tool-button'),('btn'),('btn-primary')] }, {\"data-i18n\":true,\"disabled\":true})) + \">Save</button><h3 data-i18n=\\\"poll.edit_poll_title\\\">Edit Poll<span>: \\\"\" + (jade.escape((jade.interp = view.poll.attributes.name) == null ? '' : jade.interp)) + \"\\\"</span></h3><div id=\\\"poll-treema\\\"></div><div id=\\\"poll-view\\\" class=\\\"clearfix\\\"></div><h3 data-i18n=\\\"resources.patches\\\">Patches</h3><div class=\\\"patches-view\\\"></div><hr/>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"alert alert-danger\\\"><span>Admin only. Turn around.</span></div>\");\n}\nbuf.push(\"</div><div class=\\\"achievement-corner\\\"></div><div id=\\\"site-footer\\\"><img id=\\\"footer-background\\\" src=\\\"/images/pages/base/nav_background.png\\\"/><div\" + (jade.attrs({ 'id':('footer-links'), \"class\": [(features.playViewsOnly ? 'hide' : '')] }, {\"class\":true})) + \"><a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<a tabindex=\\\"-1\\\" data-i18n=\\\"nav.contact\\\" class=\\\"contact-modal\\\"></a>\");\n}\nbuf.push(\"<a href=\\\"http://blog.codecombat.com/\\\" data-i18n=\\\"nav.blog\\\"></a><a href=\\\"https://jobs.lever.co/codecombat\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.careers\\\"></a><a href=\\\"/legal\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.legal\\\"></a><a href=\\\"/privacy\\\" tabindex=\\\"-1\\\" data-i18n=\\\"legal.privacy_title\\\"></a><a href=\\\"/contribute\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.contribute\\\"></a>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<a href=\\\"/play/ladder\\\" tabindex=\\\"-1\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a>\");\n}\nif ( me.isAdmin())\n{\nbuf.push(\"<a href=\\\"/admin\\\">Admin</a>\");\n}\nif ( usesSocialMedia)\n{\nbuf.push(\"<div class=\\\"share-buttons\\\">\");\nif ( !isIE)\n{\nbuf.push(\"<div data-href=\\\"http://codecombat.com\\\" data-size=\\\"medium\\\" class=\\\"g-plusone\\\"></div>\");\n}\nbuf.push(\"<div\" + (jade.attrs({ 'data-href':(\"https://www.facebook.com/codecombat\"), 'data-send':(\"false\"), 'data-layout':(\"button_count\"), 'data-width':(\"350\"), 'data-show-faces':(\"true\"), 'data-ref':(\"coco_footer_\" + (fbRef) + \"\"), \"class\": [('fb-like')] }, {\"data-href\":true,\"data-send\":true,\"data-layout\":true,\"data-width\":true,\"data-show-faces\":true,\"data-ref\":true})) + \"></div>\");\nif ( !isIE)\n{\nbuf.push(\"<a href=\\\"https://twitter.com/CodeCombat\\\" data-show-count=\\\"true\\\" data-show-screen-name=\\\"false\\\" data-dnt=\\\"true\\\" data-align=\\\"right\\\" data-i18n=\\\"nav.twitter_follow\\\" class=\\\"twitter-follow-button\\\"></a><iframe src=\\\"https://ghbtns.com/github-btn.html?user=codecombat&amp;repo=codecombat&amp;type=watch&amp;count=true\\\" allowtransparency=\\\"true\\\" frameborder=\\\"0\\\" scrolling=\\\"0\\\" width=\\\"110\\\" height=\\\"20\\\" class=\\\"github-star-button\\\"></iframe>\");\n}\nbuf.push(\"</div>\");\n}\nbuf.push(\"</div><div id=\\\"footer-credits\\\"><span><span>© All Rights Reserved</span><br/><span>CodeCombat 2015</span></span><img id=\\\"footer-logo\\\" src=\\\"/images/pages/base/logo.png\\\" alt=\\\"CodeCombat\\\"/><span><span>Site Design by</span><br/><a href=\\\"http://www.fullyillustrated.com/\\\">Fully Illustrated</a></span><!--a.firebase-bade(href=\\\"https://www.firebase.com/\\\")  // Not using right now--><!--  img(src=\\\"/images/pages/base/firebase.png\\\", alt=\\\"Powered by Firebase\\\")--></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\ntemplate = require 'templates/editor/poll/poll-edit-view'\nPoll = require 'models/Poll'\nUserPollsRecord = require 'models/UserPollsRecord'\nPollModal = require 'views/play/modal/PollModal'\nConfirmModal = require 'views/core/ConfirmModal'\nPatchesView = require 'views/editor/PatchesView'\nerrors = require 'core/errors'\napp = require 'core/application'\n\nrequire 'game-libraries'\n\nmodule.exports = class PollEditView extends RootView\n  id: 'editor-poll-edit-view'\n  template: template\n\n  events:\n    'click #save-button': 'savePoll'\n    'click #delete-button': 'confirmDeletion'\n\n  constructor: (options, @pollID) ->\n    super options\n    @loadPoll()\n    @loadUserPollsRecord()\n    @pushChangesToPreview = _.throttle(@pushChangesToPreview, 500)\n\n  loadPoll: ->\n    @poll = new Poll _id: @pollID\n    @poll.saveBackups = true\n    @supermodel.loadModel @poll\n\n  loadUserPollsRecord: ->\n    url = \"/db/user.polls.record/-/user/#{me.id}\"\n    @userPollsRecord = new UserPollsRecord().setURL url\n    onRecordSync = ->\n      return if @destroyed\n      @userPollsRecord.url = -> '/db/user.polls.record/' + @id\n    @listenToOnce @userPollsRecord, 'sync', onRecordSync\n    @userPollsRecord = @supermodel.loadModel(@userPollsRecord).model\n    onRecordSync.call @ if @userPollsRecord.loaded\n\n  onLoaded: ->\n    super()\n    @buildTreema()\n    @listenTo @poll, 'change', =>\n      @poll.updateI18NCoverage()\n      @treema.set('/', @poll.attributes)\n\n  buildTreema: ->\n    return if @treema? or (not @poll.loaded) or (not me.isAdmin())\n    data = $.extend(true, {}, @poll.attributes)\n    options =\n      data: data\n      filePath: \"db/poll/#{@poll.get('_id')}\"\n      schema: Poll.schema\n      readOnly: me.get('anonymous')\n      callbacks:\n        change: => @pushChangesToPreview() unless @hush\n    @treema = @$el.find('#poll-treema').treema(options)\n    @treema.build()\n    @treema.childrenTreemas.answers?.open 1\n    @pushChangesToPreview()\n\n  afterRender: ->\n    super()\n    return unless @supermodel.finished()\n    @pushChangesToPreview()\n    @patchesView = @insertSubView(new PatchesView(@poll), @$el.find('.patches-view'))\n    @patchesView.load()\n\n  pushChangesToPreview: =>\n    return unless @treema\n    @$el.find('#poll-view').empty()\n    for key, value of @treema.data\n      @poll.set key, value\n    @pollModal?.destroy()\n    @pollModal = new PollModal supermodel: @supermodel, poll: @poll, userPollsRecord: @userPollsRecord\n    @pollModal.render()\n    $('#poll-view').empty().append @pollModal.el\n    #pollModal.afterInsert()  # This blurs the active input; don't do it\n    @pollModal.$el.removeClass('modal fade').show()\n    @pollModal.on 'vote-updated', =>\n      @hush = true\n      @treema.set '/answers', @pollModal.poll.get('answers')\n      @hush = false\n\n  savePoll: (e) ->\n    @treema.endExistingEdits()\n    for key, value of @treema.data\n      @poll.set(key, value)\n\n    res = @poll.save()\n\n    res.error (collection, response, options) =>\n      console.error response\n\n    res.success =>\n      url = \"/editor/poll/#{@poll.get('slug') or @poll.id}\"\n      document.location.href = url\n\n  confirmDeletion: ->\n    renderData =\n      title: 'Are you really sure?'\n      body: 'This will completely delete the poll, potentially breaking a lot of stuff you don\\'t want breaking. Are you entirely sure?'\n      decline: 'Not really'\n      confirm: 'Definitely'\n\n    confirmModal = new ConfirmModal renderData\n    confirmModal.on 'confirm', @deletePoll\n    @openModalView confirmModal\n\n  deletePoll: =>\n    console.debug 'deleting'\n    $.ajax\n      type: 'DELETE'\n      success: ->\n        noty\n          timeout: 5000\n          text: 'Aaaand it\\'s gone.'\n          type: 'success'\n          layout: 'topCenter'\n        _.delay ->\n          app.router.navigate '/editor/poll', trigger: true\n        , 500\n      error: (jqXHR, status, error) ->\n        console.error jqXHR\n        timeout: 5000\n        text: \"Deleting poll failed with error code #{jqXHR.status}\"\n        type: 'error'\n        layout: 'topCenter'\n      url: \"/db/poll/#{@poll.id}\"\n"]}