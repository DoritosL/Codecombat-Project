{"version":3,"sources":["app/views/editor/level/components/NewLevelComponentModal.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,YAAY,QAAQ,sBAAR;;AACZ,WAAW,QAAQ,sCAAR;;AACX,iBAAiB,QAAQ,uBAAR;;AACjB,QAAQ,QAAQ,YAAR;;AACP,KAAM,QAAQ,WAAR,EAAN;;AAED,MAAM,CAAC,OAAP,GAAuB;;;mCACrB,KAAI;;mCACJ,WAAU;;mCACV,UAAS;;mCACT,oBAAmB;;mCAEnB,SACE;IAAA,qCAAqC,uBAArC;IACA,eAAe,uBADf;;;EAGW,gCAAC,OAAD;IACX,wDAAM,OAAN;IACA,IAAC,QAAD,GAAW,cAAc,CAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,MAAD;EAFvC;;mCAIb,wBAAuB,SAAC,CAAD;AACrB;IAAA,CAAC,CAAC,cAAF;IACA,SAAS,IAAC,IAAG,CAAC,IAAL,CAAU,yBAAV,CAAoC,CAAC,GAArC;IACT,OAAO,IAAC,IAAG,CAAC,IAAL,CAAU,uBAAV,CAAkC,CAAC,GAAnC;IACP,YAAgB;IAChB,SAAS,CAAC,GAAV,CAAc,QAAd,EAAwB,MAAxB;IACA,SAAS,CAAC,GAAV,CAAc,MAAd,EAAsB,IAAtB;IACA,SAAS,CAAC,GAAV,CAAc,MAAd,EAAsB,SAAS,CAAC,GAAV,CAAc,MAAd,EAAsB,IAAtB,CAA2B,CAAC,OAA5B,CAAoC,cAApC,EAAoD,IAApD,CAAtB;IACA,SAAS,CAAC,GAAV,CAAc,aAAd,EAA6B;MAAC;QAAC,QAAQ,OAAT;QAAkB,QAAQ,EAAE,CAAC,EAA7B;OAAD;KAA7B;IACA,MAAM,SAAS,CAAC,IAAV,CAAe,IAAf,EAAqB;MAAC,MAAM,MAAP;KAArB;IACN,KAAc,GAAd;AAAA;;IAEA,IAAC,YAAD;IACA,GAAG,CAAC,KAAJ,CAAU;aAAA;QACR,KAAC,YAAD;QACA,OAAO,CAAC,GAAR,CAAY,aAAZ,EAA2B,IAAI,CAAC,KAAL,CAAW,GAAG,CAAC,YAAf,CAA3B;eACA,KAAK,CAAC,iBAAN,CAAwB,KAAC,IAAzB,EAA8B,IAAI,CAAC,KAAL,CAAW,GAAG,CAAC,YAAf,CAA9B;MAHQ;IAAA,QAAV;WAIA,GAAG,CAAC,OAAJ,CAAY;aAAA;QACV,KAAC,WAAU,CAAC,aAAZ,CAA0B,SAA1B;eACA,KAAC,KAAD;MAFU;IAAA,QAAZ;EAjBqB;;;;GAd6B","file":"public/javascripts/app/views/editor/level/components/NewLevelComponentModal.js","sourcesContent":["ModalView = require 'views/core/ModalView'\ntemplate = require 'templates/editor/level/component/new'\nLevelComponent = require 'models/LevelComponent'\nforms = require 'core/forms'\n{me} = require 'core/auth'\n\nmodule.exports = class NewLevelComponentModal extends ModalView\n  id: 'editor-level-component-new-modal'\n  template: template\n  instant: false\n  modalWidthPercent: 60\n\n  events:\n    'click #new-level-component-submit': 'makeNewLevelComponent'\n    'submit form': 'makeNewLevelComponent'\n\n  constructor: (options) ->\n    super options\n    @systems = LevelComponent.schema.properties.system.enum\n\n  makeNewLevelComponent: (e) ->\n    e.preventDefault()\n    system = @$el.find('#level-component-system').val()\n    name = @$el.find('#level-component-name').val()\n    component = new LevelComponent()\n    component.set 'system', system\n    component.set 'name', name\n    component.set 'code', component.get('code', true).replace(/AttacksSelf/g, name)\n    component.set 'permissions', [{access: 'owner', target: me.id}]  # Private until saved in a published Level\n    res = component.save(null, {type: 'POST'})  # Override PUT so we can trigger postFirstVersion logic\n    return unless res\n\n    @showLoading()\n    res.error =>\n      @hideLoading()\n      console.log 'Got errors:', JSON.parse(res.responseText)\n      forms.applyErrorsToForm(@$el, JSON.parse(res.responseText))\n    res.success =>\n      @supermodel.registerModel component\n      @hide()\n"]}