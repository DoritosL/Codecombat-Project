{"version":3,"sources":["app/views/editor/level/modals/NewAchievementModal.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,gBAAgB,QAAQ,kCAAR;;AAChB,WAAW,QAAQ,8CAAR;;AACX,QAAQ,QAAQ,YAAR;;AACR,cAAc,QAAQ,oBAAR;;AAEd,MAAM,CAAC,OAAP,GAAuB;;;gCACrB,KAAI;;gCACJ,WAAU;;gCACV,QAAO;;gCAEP,SACE;IAAA,oCAAoC,wBAApC;;;EAEW,6BAAC,OAAD;IACX,qDAAM,OAAN;IACA,IAAC,MAAD,GAAS,OAAO,CAAC;EAFN;;gCAIb,yBAAwB,SAAC,CAAD;AACtB;IAAA,OAAO,CAAC,CAAC,MAAM,CAAC,OAAT,CAAiB,IAAC,IAAG,CAAC,IAAL,CAAU,OAAV,CAAkB,CAAC,GAAnB,EAAjB;IACP,MAAM,yBAAuB;WAC7B,MAAM,CAAC,IAAP,CAAY,GAAZ,EAAiB,QAAjB;EAHsB;;gCAKxB,cAAa;AACX;IAAA,UAAU,IAAC,IAAG,CAAC,IAAL,CAAU,6BAAV;IACV;;AAAiB;WAAA;;qBAAA,EAAE,KAAF,CAAQ,CAAC,GAAT;AAAA;;;IACjB,QAAQ;AACR;;AACE,cAAO,EAAP;AAAA,aACO,uBADP;UAEI,KAAM,kBAAN,GAA0B;AADvB;AADP;UAII,KAAM,uBAAoB,EAApB,GAAuB,SAAvB,CAAN,GAAyC;AAJ7C;AADF;IAMA,KAAM,kBAAN,GAA0B,IAAC,MAAK,CAAC,GAAP,CAAW,UAAX;WAC1B;EAXW;;gCAab,eAAc;AACZ;IAAA,cAAc,IAAI;IAClB,OAAO,IAAC,IAAG,CAAC,IAAL,CAAU,OAAV,CAAkB,CAAC,GAAnB;IACP,cAAc,IAAC,IAAG,CAAC,IAAL,CAAU,cAAV,CAAyB,CAAC,GAA1B;IACd,QAAQ,IAAC,YAAD;IAER,WAAW,CAAC,GAAZ,CAAgB,MAAhB,EAAwB,IAAxB;IACA,WAAW,CAAC,GAAZ,CAAgB,aAAhB,EAA+B,WAA/B;IACA,WAAW,CAAC,GAAZ,CAAgB,OAAhB,EAAyB,KAAzB;IACA,WAAW,CAAC,GAAZ,CAAgB,YAAhB,EAA8B,gBAA9B;IACA,WAAW,CAAC,GAAZ,CAAgB,WAAhB,EAA6B,SAA7B;IACA,WAAW,CAAC,GAAZ,CAAgB,SAAhB,EAA2B,IAAC,MAAK,CAAC,GAAP,CAAW,UAAX,CAA3B;WAEA;EAbY;;;;GA9BmC","file":"public/javascripts/app/views/editor/level/modals/NewAchievementModal.js","sourcesContent":["NewModelModal = require 'views/editor/modal/NewModelModal'\ntemplate = require 'templates/editor/level/modal/new-achievement'\nforms = require 'core/forms'\nAchievement = require 'models/Achievement'\n\nmodule.exports = class NewAchievementModal extends NewModelModal\n  id: 'new-achievement-modal'\n  template: template\n  plain: false\n\n  events:\n    'click #save-new-achievement-link': 'onAchievementSubmitted'\n\n  constructor: (options) ->\n    super options\n    @level = options.level\n\n  onAchievementSubmitted: (e) ->\n    slug = _.string.slugify @$el.find('#name').val()\n    url = \"/editor/achievement/#{slug}\"\n    window.open url, '_blank'\n\n  createQuery: ->\n    checked = @$el.find('[name=queryOptions]:checked')\n    checkedValues = ($(check).val() for check in checked)\n    query = {}\n    for id in checkedValues\n      switch id\n        when 'misc-level-completion'\n          query['state.complete'] = true\n        else\n          query[\"state.goalStates.#{id}.status\"] = 'success'\n    query['level.original'] = @level.get 'original'\n    query\n\n  makeNewModel: ->\n    achievement = new Achievement\n    name = @$el.find('#name').val()\n    description = @$el.find('#description').val()\n    query = @createQuery()\n\n    achievement.set 'name', name\n    achievement.set 'description', description\n    achievement.set 'query', query\n    achievement.set 'collection', 'level.sessions'\n    achievement.set 'userField', 'creator'\n    achievement.set 'related', @level.get('original')\n\n    achievement\n"]}