{"version":3,"sources":["app/models/Level.coffee"],"names":[],"mappings":"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","file":"public/javascripts/app/models/Level.js","sourcesContent":["CocoModel = require './CocoModel'\nLevelComponent = require './LevelComponent'\nLevelSystem = require './LevelSystem'\nThangType = require './ThangType'\n\nmodule.exports = class Level extends CocoModel\n  @className: 'Level'\n  @schema: require 'schemas/models/level'\n  @levels:\n    'dungeons-of-kithgard': '5411cb3769152f1707be029c'\n    'defense-of-plainswood': '541b67f71ccc8eaae19f3c62'\n  urlRoot: '/db/level'\n  editableByArtisans: true\n\n  serialize: (options) ->\n    {supermodel, session, otherSession, @headless, @sessionless, cached=false} = options\n    o = @denormalize supermodel, session, otherSession # hot spot to optimize\n\n    # Figure out Components\n    o.levelComponents = if cached then @getCachedLevelComponents(supermodel) else $.extend true, [], (lc.attributes for lc in supermodel.getModels LevelComponent)\n    @sortThangComponents o.thangs, o.levelComponents, 'Level Thang'\n    @fillInDefaultComponentConfiguration o.thangs, o.levelComponents # hot spot to optimize\n\n    # Figure out Systems\n    systemModels = $.extend true, [], (ls.attributes for ls in supermodel.getModels LevelSystem)\n    o.systems = @sortSystems o.systems, systemModels\n    @fillInDefaultSystemConfiguration o.systems\n\n    # Figure out ThangTypes' Components\n    tmap = {}\n    tmap[t.thangType] = true for t in o.thangs ? []\n    sessionHeroes = [session?.get('heroConfig')?.thangType, otherSession?.get('heroConfig')?.thangType]\n    o.thangTypes = []\n    for tt in supermodel.getModels ThangType\n      if tmap[tt.get('original')] or\n        (tt.get('kind') isnt 'Hero' and tt.get('kind')? and tt.get('components') and not tt.notInLevel) or\n        (tt.get('kind') is 'Hero' and (@isType('course', 'course-ladder', 'game-dev') or tt.get('original') in sessionHeroes))\n          o.thangTypes.push (original: tt.get('original'), name: tt.get('name'), components: $.extend(true, [], tt.get('components')), kind: tt.get('kind'))\n    @sortThangComponents o.thangTypes, o.levelComponents, 'ThangType'\n    @fillInDefaultComponentConfiguration o.thangTypes, o.levelComponents\n\n    o.picoCTFProblem = @picoCTFProblem if @picoCTFProblem\n\n    o\n\n  cachedLevelComponents: null\n\n  getCachedLevelComponents: (supermodel) ->\n    @cachedLevelComponents ?= {}\n    levelComponents = supermodel.getModels LevelComponent\n    newLevelComponents = []\n    for levelComponent in levelComponents\n      if levelComponent.hasLocalChanges()\n        newLevelComponents.push $.extend(true, {}, levelComponent.attributes)\n        continue\n      @cachedLevelComponents[levelComponent.id] ?= @cachedLevelComponents[levelComponent.id] = $.extend(true, {}, levelComponent.attributes)\n      newLevelComponents.push(@cachedLevelComponents[levelComponent.id])\n    newLevelComponents\n\n  denormalize: (supermodel, session, otherSession) ->\n    o = $.extend true, {}, @attributes\n    if o.thangs and @isType('hero', 'hero-ladder', 'hero-coop', 'course', 'course-ladder', 'game-dev', 'web-dev')\n      thangTypesWithComponents = (tt for tt in supermodel.getModels(ThangType) when tt.get('components')?)\n      thangTypesByOriginal = _.indexBy thangTypesWithComponents, (tt) -> tt.get('original')  # Optimization\n      for levelThang in o.thangs\n        @denormalizeThang(levelThang, supermodel, session, otherSession, thangTypesByOriginal)\n    o\n\n  denormalizeThang: (levelThang, supermodel, session, otherSession, thangTypesByOriginal) ->\n    levelThang.components ?= []\n    isHero = /Hero Placeholder/.test(levelThang.id) and @isType('hero', 'hero-ladder', 'hero-coop')\n    if isHero and otherSession\n      # If it's a hero and there's another session, find the right session for it.\n      # If there is no other session (playing against default code, or on single player), clone all placeholders.\n      # TODO: actually look at the teams on these Thangs to determine which session should go with which placeholder.\n      if levelThang.id is 'Hero Placeholder 1' and session.get('team') is 'humans'\n        session = otherSession\n      else if levelThang.id is 'Hero Placeholder' and session.get('team') is 'ogres'\n        session = otherSession\n\n    # Empty out placeholder Components and store their values if we're the hero placeholder.\n    if isHero\n      placeholders = {}\n      placeholdersUsed = {}\n      placeholderThangType = thangTypesByOriginal[levelThang.thangType]\n      unless placeholderThangType\n        console.error \"Couldn't find placeholder ThangType for the hero!\"\n        isHero = false\n      else\n        for defaultPlaceholderComponent in placeholderThangType.get('components')\n          placeholders[defaultPlaceholderComponent.original] = defaultPlaceholderComponent\n        for thangComponent in levelThang.components\n          placeholders[thangComponent.original] = thangComponent\n        levelThang.components = []  # We have stored the placeholder values, so we can inherit everything else.\n        heroThangType = session?.get('heroConfig')?.thangType\n        levelThang.thangType = heroThangType if heroThangType\n\n    thangType = thangTypesByOriginal[levelThang.thangType]\n\n    configs = {}\n    for thangComponent in levelThang.components\n      configs[thangComponent.original] = thangComponent\n\n    for defaultThangComponent in thangType?.get('components') or []\n      if levelThangComponent = configs[defaultThangComponent.original]\n        # Take the ThangType default Components and merge level-specific Component config into it\n        copy = $.extend true, {}, defaultThangComponent.config\n        levelThangComponent.config = _.merge copy, levelThangComponent.config\n\n      else\n        # Just add the Component as is\n        levelThangComponent = $.extend true, {}, defaultThangComponent\n        levelThang.components.push levelThangComponent\n\n      if isHero and placeholderComponent = placeholders[defaultThangComponent.original]\n        placeholdersUsed[placeholderComponent.original] = true\n        placeholderConfig = placeholderComponent.config ? {}\n        levelThangComponent.config ?= {}\n        config = levelThangComponent.config\n        if placeholderConfig.pos  # Pull in Physical pos x and y\n          config.pos ?= {}\n          config.pos.x = placeholderConfig.pos.x\n          config.pos.y = placeholderConfig.pos.y\n          config.rotation = placeholderConfig.rotation\n        else if placeholderConfig.team  # Pull in Allied team\n          config.team = placeholderConfig.team\n        else if placeholderConfig.significantProperty  # For levels where we cheat on what counts as an enemy\n          config.significantProperty = placeholderConfig.significantProperty\n        else if placeholderConfig.programmableMethods\n          # Take the ThangType default Programmable and merge level-specific Component config into it\n          copy = $.extend true, {}, placeholderConfig\n          programmableProperties = config?.programmableProperties ? []\n          copy.programmableProperties = _.union programmableProperties, copy.programmableProperties ? []\n          levelThangComponent.config = config = _.merge copy, config\n        else if placeholderConfig.extraHUDProperties\n          config.extraHUDProperties = _.union(config.extraHUDProperties ? [], placeholderConfig.extraHUDProperties)\n        else if placeholderConfig.voiceRange  # Pull in voiceRange\n          config.voiceRange = placeholderConfig.voiceRange\n          config.cooldown = placeholderConfig.cooldown\n\n    if isHero\n      if equips = _.find levelThang.components, {original: LevelComponent.EquipsID}\n        inventory = session?.get('heroConfig')?.inventory\n        equips.config ?= {}\n        equips.config.inventory = $.extend true, {}, inventory if inventory\n      for original, placeholderComponent of placeholders when not placeholdersUsed[original]\n        levelThang.components.push placeholderComponent\n\n    # Load the user's chosen hero AFTER getting stats from default char\n    if /Hero Placeholder/.test(levelThang.id) and @isType('course') and not @headless and not @sessionless and not window.serverConfig.picoCTF\n      heroThangType = me.get('heroConfig')?.thangType or ThangType.heroes.captain\n      levelThang.thangType = heroThangType if heroThangType\n\n  sortSystems: (levelSystems, systemModels) ->\n    [sorted, originalsSeen] = [[], {}]\n    visit = (system) ->\n      return if system.original of originalsSeen\n      systemModel = _.find systemModels, {original: system.original}\n      return console.error 'Couldn\\'t find model for original', system.original, 'from', systemModels unless systemModel\n      for d in systemModel.dependencies or []\n        system2 = _.find levelSystems, {original: d.original}\n        visit system2\n      #console.log 'sorted systems adding', systemModel.name\n      sorted.push {model: systemModel, config: $.extend true, {}, system.config}\n      originalsSeen[system.original] = true\n    visit system for system in levelSystems ? []\n    sorted\n\n  sortThangComponents: (thangs, levelComponents, parentType) ->\n    # Here we have to sort the Components by their dependencies.\n    # It's a bit tricky though, because we don't have either soft dependencies or priority levels.\n    # Example: Programmable must come last, since it has to override any Component-provided methods that any other Component might have created. Can't enumerate all soft dependencies.\n    # Example: Plans needs to come after everything except Programmable, since other Components that add plannable methods need to have done so by the time Plans is attached.\n    # Example: Collides doesn't depend on Allied, but if both exist, Collides must come after Allied. Soft dependency example. Can't just figure out a proper priority to take care of it.\n    # Example: Moves doesn't depend on Acts, but if both exist, Moves must come after Acts. Another soft dependency example.\n    # Decision? Just special case the sort logic in here until we have more examples than these two and decide how best to handle most of the cases then, since we don't really know the whole of the problem yet.\n    # TODO: anything that depends on Programmable will break right now.\n\n    originalsToComponents = _.indexBy levelComponents, 'original'  # Optimization for speed\n    alliedComponent = _.find levelComponents, name: 'Allied'\n    actsComponent = _.find levelComponents, name: 'Acts'\n\n    for thang in thangs ? []\n      originalsToThangComponents = _.indexBy thang.components, 'original'\n      sorted = []\n      visit = (c, namesToIgnore) ->\n        return if c in sorted\n        lc = originalsToComponents[c.original]\n        console.error thang.id or thang.name, 'couldn\\'t find lc for', c, 'of', levelComponents unless lc\n        return unless lc\n        return if namesToIgnore and lc.name in namesToIgnore\n        if lc.name is 'Plans'\n          # Plans always comes second-to-last, behind Programmable\n          visit c2, [lc.name, 'Programmable'] for c2 in thang.components\n        else if lc.name is 'Programmable'\n          # Programmable always comes last\n          visit c2, [lc.name] for c2 in thang.components\n        else\n          for d in lc.dependencies or []\n            c2 = originalsToThangComponents[d.original]\n            unless c2\n              dependent = originalsToComponents[d.original]\n              dependent = dependent?.name or d.original\n              console.error parentType, thang.id or thang.name, 'does not have dependent Component', dependent, 'from', lc.name\n            visit c2 if c2\n          if lc.name is 'Collides' and alliedComponent\n            if allied = originalsToThangComponents[alliedComponent.original]\n              visit allied\n          if lc.name is 'Moves' and actsComponent\n            if acts = originalsToThangComponents[actsComponent.original]\n              visit acts\n        #console.log thang.id, 'sorted comps adding', lc.name\n        sorted.push c\n      for comp in thang.components\n        visit comp\n      thang.components = sorted\n\n  fillInDefaultComponentConfiguration: (thangs, levelComponents) ->\n    # This is slow, so I inserted some optimizations to speed it up by caching the eventual defaults of commonly-used Components.\n    @defaultComponentConfigurations ?= {}\n    cached = 0\n    missed = 0\n    cachedConfigs = 0\n    for thang in thangs ? []\n      for component in thang.components or []\n        isPhysical = component.original is LevelComponent.PhysicalID\n        if not isPhysical and defaultConfiguration = _.find @defaultComponentConfigurations[component.original], ((d) -> _.isEqual component, d.originalComponent)\n          component.config = defaultConfiguration.defaultedConfig\n          ++cached\n          continue\n        continue unless lc = _.find levelComponents, {original: component.original}\n        unless isPhysical\n          originalComponent = $.extend true, {}, component\n        component.config ?= {}\n        TreemaUtils.populateDefaults(component.config, lc.configSchema ? {}, tv4)\n        @lastType = 'component'\n        @lastOriginal = component.original\n        unless isPhysical\n          @defaultComponentConfigurations[component.original] ?= []\n          @defaultComponentConfigurations[component.original].push originalComponent: originalComponent, defaultedConfig: component.config\n          ++cachedConfigs\n        ++missed\n    #console.log 'cached', cached, 'missed', missed\n\n  fillInDefaultSystemConfiguration: (levelSystems) ->\n    for system in levelSystems ? []\n      system.config ?= {}\n      TreemaUtils.populateDefaults(system.config, system.model.configSchema, tv4)\n      @lastType = 'system'\n      @lastOriginal = system.model.name\n\n  dimensions: ->\n    width = 0\n    height = 0\n    for thang in @get('thangs') or []\n      for component in thang.components\n        c = component.config\n        continue unless c?\n        width = c.width if c.width? and c.width > width\n        height = c.height if c.height? and c.height > height\n    return {width: width, height: height}\n\n  isLadder: ->\n    return @get('type')?.indexOf('ladder') > -1\n\n  isProject: ->\n    return @get('shareable') is 'project'\n\n  isType: (types...) ->\n    return @get('type', true) in types\n\n  fetchNextForCourse: ({ levelOriginalID, courseInstanceID, courseID, sessionID }, options={}) ->\n    if courseInstanceID\n      options.url = \"/db/course_instance/#{courseInstanceID}/levels/#{levelOriginalID}/sessions/#{sessionID}/next\"\n    else\n      options.url = \"/db/course/#{courseID}/levels/#{levelOriginalID}/next\"\n    @fetch(options)\n\n  getSolutions: ->\n    return [] unless hero = _.find (@get(\"thangs\") ? []), id: 'Hero Placeholder'\n    return [] unless plan = _.find(hero.components ? [], (x) -> x.config?.programmableMethods?.plan)?.config.programmableMethods.plan\n    solutions = _.cloneDeep plan.solutions ? []\n    for solution in solutions\n      try\n        solution.source = _.template(solution.source)(plan.context)\n      catch e\n        console.error \"Problem with template and solution comments for\", @get('slug'), e\n    solutions\n\n  getSampleCode: ->\n    return {} unless hero = _.find (@get(\"thangs\") ? []), id: 'Hero Placeholder'\n    return {} unless plan = _.find(hero.components ? [], (x) -> x.config?.programmableMethods?.plan)?.config.programmableMethods.plan\n    sampleCode = _.cloneDeep plan.languages ? {}\n    sampleCode.javascript = plan.source\n    for language, code of sampleCode\n      try\n        sampleCode[language] = _.template(code)(plan.context)\n      catch e\n        console.error \"Problem with template and solution comments for\", @get('slug'), e\n    sampleCode\n"]}